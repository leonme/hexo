[{"title":"加快git传输速度","url":"http://www.leonma.cn/2016/11/10/加快git传输速度-1/","content":""},{"title":"加快git传输速度","url":"http://www.leonma.cn/2016/11/10/加快git传输速度/","content":"<h1 id=\"加快git传输速度\"><a href=\"#加快git传输速度\" class=\"headerlink\" title=\"加快git传输速度\"></a>加快git传输速度</h1><p><img src=\"http://www.thebeijinger.com/files/u93526/greatfirewall1_616.jpg\" alt=\"\"></p>\n<p>​    最近遇到了个比较棘手的事情。公司是外企，在公司github同步代码下载速度达到1.5-2.3M/S，但是每到家同步github的代码下载速度只有2-4kb/s，拉一套源码就几个小时的事情。</p>\n<p>​    实在无法忍受这龟速，就自己办理的一个8M网速的宽带，10号以后自动提速到12M，，可是拉代码速度依旧只有70-160kb/s。</p>\n<p>​    这下简直无法忍受，只好自己想办法。<br>方法很简单，就是用代理，用chrome+linux+goagent组合<br>折腾了半个小时，马上就能访问<a href=\"http://developer.android.com这个网站了，\" target=\"_blank\" rel=\"external\">http://developer.android.com这个网站了，</a></p>\n<p>在此吐槽一下中国网警们，不知道你们屏蔽这个网站是何用意？？？？<br>但是很github访问依旧慢，慢，慢，拉代码依旧需要很久很久。<br>于是去设置下github 代理。SO：<br>正文来了：</p>\n<p>通过配置git的代理可以加速git上传和下载<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">git config --global https.proxy=socks5://127.0.0.1:1080</div><div class=\"line\">git config --global http.proxy=socks5://127.0.0.1:1080</div></pre></td></tr></table></figure></p>\n<p>端口号要根据ss的端口做相应调整，有同样困扰的小伙伴不妨试一试！</p>\n"},{"title":"npm更换国内源","url":"http://www.leonma.cn/2016/11/10/npm更换国内源/","content":"<h1 id=\"npm更换国内源\"><a href=\"#npm更换国内源\" class=\"headerlink\" title=\"npm更换国内源\"></a>npm更换国内源</h1><blockquote>\n<p>通过更换国内源来加速npm下载安装模块的速度</p>\n</blockquote>\n<p> <img src=\"http://www.thebeijinger.com/files/u93526/greatfirewall1_616.jpg\" alt=\"\"></p>\n<p>我曾一度苦恼于npm的下载速度实在是太慢，有时还会连接失败。原因众所周知，不再多数。</p>\n<p>解决办法：更换npm的源到国内源，速度快的飞起。<br>废话不多说，设置淘宝源：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm config set registry https://registry.npm.taobao.org </div><div class=\"line\">npm info underscore （如果上面配置正确这个命令会有字符串response）</div></pre></td></tr></table></figure>\n<p>如果出现错误：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm info retry will retry, error on last attempt: Error: CERT_UNTRUSTED</div></pre></td></tr></table></figure></p>\n<p>这是因为ssl验证问题，我们取消ssl验证:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">npm config set strict-ssl false</div></pre></td></tr></table></figure></p>\n<p>享受刷屏的快感吧</p>\n"},{"title":"结合WebSocket编写WebGL综合场景示例","url":"http://www.leonma.cn/2016/11/07/page71/","content":"<p>#结合WebSocket编写WebGL综合场景示例<br>在WebGL场景中导入多个Babylon骨骼模型，在局域网用WebSocket实现多用户交互控制。<br>首先是场景截图：<br><img src=\"http://images2015.cnblogs.com/blog/657116/201611/657116-20161104092432330-1844981251.png\" alt=\"picture\"><br>上图在场景中导入一个Babylon骨骼模型，使用asdw、空格、鼠标控制加速度移动，在移动时播放骨骼动画。<br><img src=\"http://images2015.cnblogs.com/blog/657116/201611/657116-20161104092921783-1111568630.png\" alt=\"picture\"><br>上图在场景中加入更多的骨骼模型（兔子），兔子感知到人类接近后会加速远离人类。<br><img src=\"http://images2015.cnblogs.com/blog/657116/201611/657116-20161104093417315-1396209353.png\" alt=\"picture\"><br>上图，一个局域网中的新玩家进入场景，（他们头上的数字是WebSocket分配的session id），兔子们受到0和1的叠加影响。<br>&nbsp;<br>具体实现：</p>\n<h2 id=\"一、工程结构：\"><a href=\"#一、工程结构：\" class=\"headerlink\" title=\"一、工程结构：\"></a>一、工程结构：</h2><p>&nbsp;前台WebStorm工程：<br><img src=\"http://images2015.cnblogs.com/blog/657116/201611/657116-20161104094056596-1505476394.png\" alt=\"picture\"><br>其中map.jpg是地形高度图，tree.jpg不是树而是地面泥土的纹理。。。<br>LIB文件夹里是引用的第三方库（babylon.max.js是2.4版），MYLIB文件夹里是我自己编写或整理修改的库，PAGE里是专用于此网页的脚本文件<br>　　其中FileText.js是js前台文件处理库（这里只用到了其中的产生日期字符串函数）<br>　　MoveWeb.js是加速度计算库<br>　　Sdyq.js里是对物体对象的定义和操作监听<br>　　Player.js里是继承了物体对象的玩家对象和动物对象的定义<br>　　utils是一些其他工具<br>　　View是页面控制库<br>MODEL文件夹里是人物和兔子的骨骼模型文件。<br>后台MyEclipse工程：<br><img src=\"http://images2015.cnblogs.com/blog/657116/201611/657116-20161104094910408-100628683.png\" alt=\"picture\"><br>使用JDK1.7，因为Tomcat v8.0里包含了WebSocket所用的库，所以不需要引入额外jar包，只写了一个类。</p>\n<h2 id=\"二、基本场景构建和骨骼模型导入：\"><a href=\"#二、基本场景构建和骨骼模型导入：\" class=\"headerlink\" title=\"二、基本场景构建和骨骼模型导入：\"></a>二、基本场景构建和骨骼模型导入：</h2><p>html页面文件：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>使用websocket联网进行数据传递，这个节点应该既可以做主机也可以加入他人的主机<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"all_base\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position:fixed;top:0px;left: 0px;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"div_canvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"float: left;width: 75%;border: 1px solid\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"renderCanvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 100%;height: 100%\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"div_log\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"float: left;border: 1px solid;overflow-y: scroll\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"div_bottom\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"float: left;width: 100%;height: 100px;padding-top: 10px;padding-left: 10px\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 200px\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"str_ip\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"localhost\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"str_name\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btn_create\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"createScene()\"</span> <span class=\"attr\">disabled</span>=<span class=\"string\">true</span>&gt;</span>启动场景<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btn_connect\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"Connect()\"</span> &gt;</span>websocket连接<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btn_close\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"Close()\"</span> <span class=\"attr\">disabled</span>=<span class=\"string\">true</span>&gt;</span>关闭连接<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">\"str_id\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display: inline-block\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 400px\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"str_message\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btn_send\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"Send()\"</span>&gt;</span>发送<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/LIB/babylon.max.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/MYLIB/View.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/LIB/jquery-1.11.3.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/MYLIB/FileText.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/MYLIB/Sdyq.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/MYLIB/player.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/MYLIB/MoveWeb.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/MYLIB/utils.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/PAGE/scene_link.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"../JS/PAGE/WebSocket.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\">    <span class=\"keyword\">var</span> username=<span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"built_in\">window</span>.onload=BeforeLog;</div><div class=\"line\">    <span class=\"built_in\">window</span>.onresize=Resize_Pllsselect;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">BeforeLog</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        Resize_Pllsselect();</div><div class=\"line\">        <span class=\"comment\">//DrawYzm();</span></div><div class=\"line\">        <span class=\"comment\">//createScene();</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">var</span> str_log=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"div_log\"</span>);</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Resize_Pllsselect</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> size=window_size();</div><div class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"all_base\"</span>).style.height=(size.height+<span class=\"string\">\"px\"</span>);</div><div class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"all_base\"</span>).style.width=(size.width+<span class=\"string\">\"px\"</span>);</div><div class=\"line\">        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"div_canvas\"</span>).style.height=(size.height<span class=\"number\">-100</span>+<span class=\"string\">\"px\"</span>);</div><div class=\"line\">        str_log.style.height=(size.height<span class=\"number\">-100</span>+<span class=\"string\">\"px\"</span>);</div><div class=\"line\">        str_log.style.width=((size.width/<span class=\"number\">4</span>)<span class=\"number\">-4</span>+<span class=\"string\">\"px\"</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(engine!=<span class=\"literal\">undefined</span>)</div><div class=\"line\">        &#123;</div><div class=\"line\">            engine.resize();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> state=<span class=\"string\">\"offline\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> arr_myplayers=[];</div><div class=\"line\">    <span class=\"keyword\">var</span> arr_webplayers=[];</div><div class=\"line\">    <span class=\"keyword\">var</span> arr_animals=[];</div><div class=\"line\">    <span class=\"keyword\">var</span> arr_tempobj=[];<span class=\"comment\">//暂存对象初始化信息</span></div><div class=\"line\">    <span class=\"keyword\">var</span> tempobj;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"renderCanvas\"</span>);</div><div class=\"line\">    <span class=\"keyword\">var</span> ms0=<span class=\"number\">0</span>;<span class=\"comment\">//上一时刻毫秒数</span></div><div class=\"line\">    <span class=\"keyword\">var</span> mst=<span class=\"number\">0</span>;<span class=\"comment\">//下一时刻毫秒数</span></div><div class=\"line\">    <span class=\"keyword\">var</span> schange=<span class=\"number\">0</span>;<span class=\"comment\">//秒差</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> skybox,</div><div class=\"line\">            scene,</div><div class=\"line\">            sceneCharger = <span class=\"literal\">false</span>,</div><div class=\"line\">            meshOctree,</div><div class=\"line\">            cameraArcRotative = [],<span class=\"comment\">//弧形旋转相机列表</span></div><div class=\"line\">            octree;</div><div class=\"line\">    <span class=\"keyword\">var</span> engine;</div><div class=\"line\">    <span class=\"keyword\">var</span> shadowGenerator ;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>View Code其中包含对页面尺寸大小变化的响应和一些全局变量的定义<br>scene_link.js文件中包含场景的构建和模型导入：</p>\n<h3 id=\"1、在createScene-方法的开头部分建立了一个基本的PlayGround场景：\"><a href=\"#1、在createScene-方法的开头部分建立了一个基本的PlayGround场景：\" class=\"headerlink\" title=\"1、在createScene()方法的开头部分建立了一个基本的PlayGround场景：\"></a>1、在createScene()方法的开头部分建立了一个基本的PlayGround场景：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\">engine = <span class=\"keyword\">new</span> BABYLON.Engine(canvas, <span class=\"literal\">true</span>);</div><div class=\"line\">    engine.displayLoadingUI();</div><div class=\"line\">    scene = <span class=\"keyword\">new</span> BABYLON.Scene(engine);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//在场景中启用碰撞检测</span></div><div class=\"line\">    scene.collisionsEnabled = <span class=\"literal\">true</span>;</div><div class=\"line\">    <span class=\"comment\">//scene.workerCollisions = true;//启动webworker进程处理碰撞，确实可以有效使用多核运算，加大帧数！！</span></div><div class=\"line\">    <span class=\"comment\">//但是worker是异步运算的，其数据传输策略会导致movewithcollition执行顺序与期望的顺序不符</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//定向光照</span></div><div class=\"line\">    <span class=\"keyword\">var</span> LightDirectional = <span class=\"keyword\">new</span> BABYLON.DirectionalLight(<span class=\"string\">\"dir01\"</span>, <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">-2</span>, <span class=\"number\">-4</span>, <span class=\"number\">2</span>), scene);</div><div class=\"line\">    LightDirectional.diffuse = <span class=\"keyword\">new</span> BABYLON.Color3(<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>);<span class=\"comment\">//散射颜色</span></div><div class=\"line\">    LightDirectional.specular = <span class=\"keyword\">new</span> BABYLON.Color3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);<span class=\"comment\">//镜面反射颜色</span></div><div class=\"line\">    LightDirectional.position = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">250</span>, <span class=\"number\">400</span>, <span class=\"number\">0</span>);</div><div class=\"line\">    LightDirectional.intensity = <span class=\"number\">1.8</span>;<span class=\"comment\">//强度</span></div><div class=\"line\">    shadowGenerator = <span class=\"keyword\">new</span> BABYLON.ShadowGenerator(<span class=\"number\">1024</span>, LightDirectional);<span class=\"comment\">//为该光源建立阴影生成器，用在submesh上时一直在报错，不知道为了什么</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//弧形旋转相机</span></div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>] = <span class=\"keyword\">new</span> BABYLON.ArcRotateCamera(<span class=\"string\">\"CameraBaseRotate\"</span>, -<span class=\"built_in\">Math</span>.PI/<span class=\"number\">2</span>, <span class=\"built_in\">Math</span>.PI/<span class=\"number\">2.2</span>, <span class=\"number\">12</span>, <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">5.0</span>, <span class=\"number\">0</span>), scene);</div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>].wheelPrecision = <span class=\"number\">15</span>;<span class=\"comment\">//鼠标滚轮？</span></div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>].lowerRadiusLimit = <span class=\"number\">2</span>;</div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>].upperRadiusLimit = <span class=\"number\">22</span>;</div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>].minZ = <span class=\"number\">0</span>;</div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>].minX = <span class=\"number\">4096</span>;</div><div class=\"line\">    scene.activeCamera = cameraArcRotative[<span class=\"number\">0</span>];</div><div class=\"line\">    cameraArcRotative[<span class=\"number\">0</span>].attachControl(canvas);<span class=\"comment\">//控制关联</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//地面</span></div><div class=\"line\">    <span class=\"comment\">//name,url,width,height,subdivisions,minheight,maxheight,updateble,onready,scene</span></div><div class=\"line\">    ground = BABYLON.Mesh.CreateGroundFromHeightMap(<span class=\"string\">\"ground\"</span>, <span class=\"string\">\"../IMAGE/map.jpg\"</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span>, <span class=\"number\">100</span>, <span class=\"number\">0</span>, <span class=\"number\">60</span>, scene, <span class=\"literal\">true</span>);<span class=\"comment\">//地面类型的网格</span></div><div class=\"line\">    <span class=\"keyword\">var</span> groundMaterial = <span class=\"keyword\">new</span> BABYLON.StandardMaterial(<span class=\"string\">\"groundMat\"</span>, scene);<span class=\"comment\">//泥土材质</span></div><div class=\"line\">    groundMaterial.diffuseTexture = <span class=\"keyword\">new</span> BABYLON.Texture(<span class=\"string\">\"../IMAGE/tree.png\"</span>, scene);<span class=\"comment\">//地面的纹理贴图</span></div><div class=\"line\">    groundMaterial.diffuseTexture.uScale = <span class=\"number\">50.0</span>;<span class=\"comment\">//纹理重复效果</span></div><div class=\"line\">    groundMaterial.diffuseTexture.vScale = <span class=\"number\">50.0</span>;</div><div class=\"line\">    ground.material = groundMaterial;</div><div class=\"line\">    ground.checkCollisions = <span class=\"literal\">true</span>;<span class=\"comment\">//检测碰撞</span></div><div class=\"line\">    ground.receiveShadows = <span class=\"literal\">true</span>;<span class=\"comment\">//接收影子</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//墙</span></div><div class=\"line\">    <span class=\"keyword\">var</span> Mur = BABYLON.Mesh.CreateBox(<span class=\"string\">\"Mur\"</span>, <span class=\"number\">1</span>, scene);</div><div class=\"line\">    Mur.scaling = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">15</span>, <span class=\"number\">6</span>, <span class=\"number\">1</span>);</div><div class=\"line\">    Mur.position.y = <span class=\"number\">20</span>;</div><div class=\"line\">    Mur.position.z = <span class=\"number\">20</span>;</div><div class=\"line\">    Mur.checkCollisions = <span class=\"literal\">true</span>;</div></pre></td></tr></table></figure>\n<p>其中各个方法的具体用法可以参考官方的基础教程</p>\n<h3 id=\"2、接下来是在场景中导入第一个人物的骨骼模型：\"><a href=\"#2、接下来是在场景中导入第一个人物的骨骼模型：\" class=\"headerlink\" title=\"2、接下来是在场景中导入第一个人物的骨骼模型：\"></a>2、接下来是在场景中导入第一个人物的骨骼模型：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//角色导入，加载哪个mesh、文件目录、文件名、加入场景、回调函数</span></div><div class=\"line\">    BABYLON.SceneLoader.ImportMesh(<span class=\"string\">\"\"</span>, <span class=\"string\">\"../MODEL/him/\"</span>, <span class=\"string\">\"him.babylon\"</span>, scene, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">newMeshes, particleSystems, skeletons</span>)</span></div><div class=\"line\">    &#123;<span class=\"comment\">//载入完成的回调函数</span></div><div class=\"line\">        <span class=\"keyword\">var</span> Tom=<span class=\"keyword\">new</span> Player;</div><div class=\"line\">        <span class=\"keyword\">var</span> obj_p=&#123;&#125;;<span class=\"comment\">//初始化参数对象</span></div><div class=\"line\">        obj_p.mesh=newMeshes[<span class=\"number\">0</span>];<span class=\"comment\">//网格数据</span></div><div class=\"line\">        obj_p.scaling=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0.05</span>, <span class=\"number\">0.05</span>, <span class=\"number\">0.05</span>);<span class=\"comment\">//缩放</span></div><div class=\"line\">        obj_p.position=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">-5.168</span>, <span class=\"number\">30.392</span>, <span class=\"number\">-7.463</span>);<span class=\"comment\">//位置</span></div><div class=\"line\">        obj_p.rotation=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">3.9</span>, <span class=\"number\">0</span>);<span class=\"comment\">// 旋转</span></div><div class=\"line\">        obj_p.checkCollisions=<span class=\"literal\">true</span>;<span class=\"comment\">//使用默认的碰撞检测</span></div><div class=\"line\">        obj_p.ellipsoid=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0.5</span>, <span class=\"number\">1</span>, <span class=\"number\">0.5</span>);<span class=\"comment\">//碰撞检测椭球</span></div><div class=\"line\">        obj_p.ellipsoidOffset=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">0</span>);<span class=\"comment\">//碰撞检测椭球位移</span></div><div class=\"line\">        obj_p.skeletonsPlayer=skeletons;</div><div class=\"line\">        obj_p.methodofmove=<span class=\"string\">\"controlwitha\"</span>;</div><div class=\"line\">        obj_p.name=username;</div><div class=\"line\">        obj_p.id=id;</div><div class=\"line\">        obj_p.p1=<span class=\"string\">\"\"</span>;</div><div class=\"line\">        obj_p.p2=<span class=\"string\">\"../MODEL/him/\"</span>;</div><div class=\"line\">        obj_p.p3=<span class=\"string\">\"him.babylon\"</span>;</div><div class=\"line\">        <span class=\"keyword\">var</span> len=newMeshes.length;<span class=\"comment\">//对于复杂的模型来说newMeshes的其他部分也必须保存下来</span></div><div class=\"line\">        <span class=\"keyword\">var</span> arr=[];</div><div class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>;i&lt;len;i++)</div><div class=\"line\">        &#123;</div><div class=\"line\">            arr.push(newMeshes[i]);</div><div class=\"line\">        &#125;</div><div class=\"line\">        obj_p.submeshs=arr;</div><div class=\"line\"></div><div class=\"line\">        Tom.init(</div><div class=\"line\">            obj_p</div><div class=\"line\">        );</div><div class=\"line\">        arr_myplayers[username]=Tom;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>(state==<span class=\"string\">\"online\"</span>)</div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> arr=[];</div><div class=\"line\">            arr.push(<span class=\"string\">\"addnewplayer\"</span>);</div><div class=\"line\">            arr.push(Tom.mesh.scaling.x);</div><div class=\"line\">            arr.push(Tom.mesh.scaling.y);</div><div class=\"line\">            arr.push(Tom.mesh.scaling.z);</div><div class=\"line\">            arr.push(Tom.mesh.position.x);</div><div class=\"line\">            arr.push(Tom.mesh.position.y);</div><div class=\"line\">            arr.push(Tom.mesh.position.z);</div><div class=\"line\">            arr.push(Tom.mesh.rotation.x);</div><div class=\"line\">            arr.push(Tom.mesh.rotation.y);</div><div class=\"line\">            arr.push(Tom.mesh.rotation.z);</div><div class=\"line\">            arr.push(Tom.p1);</div><div class=\"line\">            arr.push(Tom.p2);</div><div class=\"line\">            arr.push(Tom.p3);</div><div class=\"line\">            arr.push(Tom.meshname);</div><div class=\"line\">            <span class=\"keyword\">var</span> dt=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(dt.getTime()+<span class=\"string\">\"send addnewplayer\"</span>+id);</div><div class=\"line\">            doSend(arr.join(<span class=\"string\">\"@\"</span>));</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        cameraArcRotative[<span class=\"number\">0</span>].alpha = -<span class=\"built_in\">parseFloat</span>(arr_myplayers[username].mesh.rotation.y) - <span class=\"number\">4.69</span>;<span class=\"comment\">//初始化相机角度</span></div><div class=\"line\"></div><div class=\"line\">    &#125;);</div></pre></td></tr></table></figure>\n<p>   其中BABYLON.SceneLoader.ImportMesh是一个异步的把服务器端场景文件导入本地内存的方法，第一个参数表示导入场景文件中的哪一个Mesh，为空表示都导入（一个场景文件里可能包含多个模型，但该示例中的场景文件里只有一个模型，所以也叫做模型文件），第二个参数是文件所在的相对路径，第三个参数是文件名，第四个参数是文件加入的场景，第五个参数是导入完成后的回调函数。<br>　　回调函数的newMeshes参数是所有导入的Mesh组成的数组，skeletons参数是所有导入的骨骼动画数组。事实上一个模型可能由多个mesh组合而成，比如示例中的him模型的newMeshes[0]只是一个空壳，newMeshes[1]到newMeshes[5]才是模型各个部分的实际Mesh，后五个Mesh是newMeshes[0]的“submesh”，newMeshes[0]是后五个Mesh的parent，在理想情况下这些Mesh之间的关系和Mesh与骨骼动画（skeleton）之间的关系由Babylon引擎自动管理。<br>　　在回调函数中，定义Tom为一个Player“类”对象，第五行定义的obj_p对象是Player对象的初始化参数对象，Player.init()方法定义在player.js文件中：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//玩家对象</span></div><div class=\"line\">Player=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    sdyq.object.call(<span class=\"keyword\">this</span>);</div><div class=\"line\">&#125;</div><div class=\"line\">Player.prototype=<span class=\"keyword\">new</span> sdyq.object();</div><div class=\"line\">Player.prototype.init=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">param</span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    param = param || &#123;&#125;;</div><div class=\"line\">    sdyq.object.prototype.init.call(<span class=\"keyword\">this</span>,param);<span class=\"comment\">//继承原型的方法</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.flag_standonground=<span class=\"number\">0</span>;<span class=\"comment\">//是否接触地面</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.keys=&#123;w:<span class=\"number\">0</span>,s:<span class=\"number\">0</span>,a:<span class=\"number\">0</span>,d:<span class=\"number\">0</span>,space:<span class=\"number\">0</span>,ctrl:<span class=\"number\">0</span>,shift:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//按键是否保持按下，考虑到多客户端并行，那么势必每个player都有自己的keys！！</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.flag_runfast=<span class=\"number\">1</span>;<span class=\"comment\">//加快速度</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.name=param.name;</div><div class=\"line\">    <span class=\"keyword\">this</span>.id=param.id;</div><div class=\"line\">    <span class=\"keyword\">this</span>.p1=param.p1;</div><div class=\"line\">    <span class=\"keyword\">this</span>.p2=param.p2;</div><div class=\"line\">    <span class=\"keyword\">this</span>.p3=param.p3;</div></pre></td></tr></table></figure></p>\n<p>　　可以看到Player对象继承自sdyq.object对象，Player对象的原型是sdyq.object对象，在Player对象的init方法中，先初始化属于原型的属性，再初始化自己这个“类”新添加的属性。<br>　　sdyq.object对象的定义在Sdyq.js文件中：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//物体本身的属性和初始化</span></div><div class=\"line\">sdyq=&#123;&#125;;<span class=\"comment\">//3D引擎</span></div><div class=\"line\">sdyq.object=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">&#123;<span class=\"comment\">//在地面上加速度运动的物体</span></div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\">sdyq.object.prototype.init = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">param</span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.keys=&#123;w:<span class=\"number\">0</span>,s:<span class=\"number\">0</span>,a:<span class=\"number\">0</span>,d:<span class=\"number\">0</span>,space:<span class=\"number\">0</span>,ctrl:<span class=\"number\">0</span>,shift:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//按键是否保持按下</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.witha0=&#123;forward:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>,up:<span class=\"number\">-9.82</span>&#125;;<span class=\"comment\">//非键盘控制产生的加速度</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.witha=&#123;forward:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>,up:<span class=\"number\">-9.82</span>&#125;;<span class=\"comment\">//环境加速度，包括地面阻力和重力，现在还没有风力</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.witha2=&#123;forward:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>,up:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//键盘控制加速度与物体本身加速度和非键盘控制产生的加速度合并后的最终加速度</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.v0=&#123;forward:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>,up:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//上一时刻的速度</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.vt=&#123;forward:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>,up:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//下一时刻的速度</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.vm=&#123;forward:<span class=\"number\">15</span>,backwards:<span class=\"number\">5</span>,left:<span class=\"number\">5</span>,right:<span class=\"number\">5</span>,up:<span class=\"number\">100</span>,down:<span class=\"number\">100</span>&#125;;<span class=\"comment\">//各个方向的最大速度</span></div><div class=\"line\">    <span class=\"comment\">//this.flag_song=0;//是否接触地面</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.flag_runfast=<span class=\"number\">1</span>;<span class=\"comment\">//加快速度</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.ry0=<span class=\"number\">0</span>;<span class=\"comment\">//上一时刻的y轴转角</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.ryt=<span class=\"number\">0</span>;<span class=\"comment\">//下一时刻的y轴转角</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.rychange=<span class=\"number\">0</span>;<span class=\"comment\">//y轴转角差</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.mchange=&#123;forward:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>,up:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//物体自身坐标系上的位移</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.vmove=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>);<span class=\"comment\">//世界坐标系中每一时刻的位移和量</span></div><div class=\"line\">    <span class=\"keyword\">this</span>.py0=<span class=\"number\">0</span>;<span class=\"comment\">//记录上一时刻的y轴位置，和下一时刻比较确定物体有没有继续向下运动！！</span></div><div class=\"line\"></div><div class=\"line\">    param = param || &#123;&#125;;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh=param.mesh;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh.scaling=param.scaling;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh.position=param.position;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh.rotation=param.rotation;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh.checkCollisions=param.checkCollisions;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh.ellipsoid=param.ellipsoid;</div><div class=\"line\">    <span class=\"keyword\">this</span>.mesh.ellipsoidOffset=param.ellipsoidOffset;</div><div class=\"line\">    <span class=\"keyword\">this</span>.meshname=<span class=\"keyword\">this</span>.mesh.name;</div><div class=\"line\">    <span class=\"keyword\">this</span>.skeletonsPlayer=param.skeletonsPlayer||[];</div><div class=\"line\">    <span class=\"keyword\">this</span>.submeshs=param.submeshs;</div><div class=\"line\">    <span class=\"keyword\">this</span>.ry0=param.mesh.rotation.y;</div><div class=\"line\">    <span class=\"keyword\">this</span>.py0=param.mesh.position.y;</div><div class=\"line\">    <span class=\"keyword\">this</span>.countstop=<span class=\"number\">0</span>;<span class=\"comment\">//记录物体静止了几次，如果物体一直静止就停止发送运动信息</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">this</span>.PlayAnnimation = <span class=\"literal\">false</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">this</span>.methodofmove=param.methodofmove||<span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">switch</span>(<span class=\"keyword\">this</span>.methodofmove)</div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"controlwitha\"</span>:</div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">\"keydown\"</span>, onKeyDown, <span class=\"literal\">false</span>);<span class=\"comment\">//按键按下</span></div><div class=\"line\">            <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">\"keyup\"</span>, onKeyUp, <span class=\"literal\">false</span>);<span class=\"comment\">//按键抬起</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">default</span> :</div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>　　sdyq.object对象的初始化方法中包含了对mesh姿态的详细设定、对键盘操作的监听设定和适用于加速度运动的各项参数设定，各种加速度运动的物体都可以用sdyq.object对象来扩展产生。<br>　　在Player对象的初始化方法中还为每个玩家添加了id显示（头上的那个数字）：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//在玩家头上显示名字，clone时这个也会被clone过去，要处理一下！！！！</span></div><div class=\"line\">    <span class=\"keyword\">var</span> lab_texture=<span class=\"keyword\">new</span> BABYLON.Texture.CreateFromBase64String(texttoimg2(<span class=\"keyword\">this</span>.id),<span class=\"string\">\"datatexture\"</span>+<span class=\"keyword\">this</span>.id,scene);<span class=\"comment\">//使用canvas纹理！！</span></div><div class=\"line\">    <span class=\"keyword\">var</span> materialSphere1 = <span class=\"keyword\">new</span> BABYLON.StandardMaterial(<span class=\"string\">\"texture1\"</span>+<span class=\"keyword\">this</span>.id, scene);</div><div class=\"line\">    materialSphere1.diffuseTexture = lab_texture;</div><div class=\"line\">    <span class=\"keyword\">var</span> plane = BABYLON.Mesh.CreatePlane(<span class=\"string\">\"plane\"</span>+<span class=\"keyword\">this</span>.id, <span class=\"number\">2.0</span>, scene, <span class=\"literal\">false</span>, BABYLON.Mesh.FRONTSIDE);</div><div class=\"line\">    <span class=\"comment\">//You can also set the mesh side orientation with the values : BABYLON.Mesh.FRONTSIDE (default), BABYLON.Mesh.BACKSIDE or BABYLON.Mesh.DOUBLESIDE</span></div><div class=\"line\">    materialSphere1.diffuseTexture.hasAlpha = <span class=\"literal\">true</span>;<span class=\"comment\">//应用纹理的透明度</span></div><div class=\"line\"></div><div class=\"line\">    plane.position=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>,<span class=\"number\">75</span>,<span class=\"number\">0</span>);<span class=\"comment\">//其父元素应用过0.05之缩放，故而这里位移量要*20</span></div><div class=\"line\">    plane.rotation.y = <span class=\"built_in\">Math</span>.PI;</div><div class=\"line\">    plane.scaling.x=<span class=\"number\">20</span>;</div><div class=\"line\">    plane.scaling.y=<span class=\"number\">4</span>;</div><div class=\"line\">    plane.parent=<span class=\"keyword\">this</span>.mesh;</div><div class=\"line\"></div><div class=\"line\">    plane.material=materialSphere1;</div><div class=\"line\">    <span class=\"keyword\">this</span>.lab=plane;</div></pre></td></tr></table></figure></p>\n<p>　　在这里使用了canvas现场产生纹理（术语叫“程序贴图”），其中texttoimg2（）方法的定义在utils.js文件中：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//把文字转变为图片jpeg</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">texttoimg</span>(<span class=\"params\">str</span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> c=<span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</div><div class=\"line\">    c.height=<span class=\"number\">20</span>;</div><div class=\"line\">    c.width=<span class=\"number\">100</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> context = c.getContext(<span class=\"string\">'2d'</span>);</div><div class=\"line\">    context.font=<span class=\"string\">\"normal 15px sans-serif\"</span>;</div><div class=\"line\">    context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</div><div class=\"line\">    context.fillStyle=<span class=\"string\">\"rgb(255,255,255)\"</span>;</div><div class=\"line\">    context.fillRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,canvas.width,canvas.height);</div><div class=\"line\">    context.fillStyle = <span class=\"string\">\"rgb(0,0,0)\"</span>;</div><div class=\"line\">    context.textBaseline = <span class=\"string\">'top'</span>;</div><div class=\"line\">    context.fillText(str,(c.width-str.length*<span class=\"number\">15</span>)/<span class=\"number\">2</span>,<span class=\"number\">0</span>, c.width*<span class=\"number\">0.9</span>);</div><div class=\"line\">    <span class=\"keyword\">var</span> str_src=c.toDataURL(<span class=\"string\">\"image/jpeg\"</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> str_src;</div><div class=\"line\">    <span class=\"comment\">//return c;</span></div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//把文字转变为图片PNG</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">texttoimg2</span>(<span class=\"params\">str</span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> c=<span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"canvas\"</span>);</div><div class=\"line\">    c.height=<span class=\"number\">20</span>;</div><div class=\"line\">    c.width=<span class=\"number\">100</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> context = c.getContext(<span class=\"string\">'2d'</span>);</div><div class=\"line\">    context.font=<span class=\"string\">\"normal 20px sans-serif\"</span>;</div><div class=\"line\">    context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</div><div class=\"line\">    <span class=\"comment\">//context.fillStyle=\"rgb(255,255,255)\";</span></div><div class=\"line\">    <span class=\"comment\">//context.fillRect(0,0,canvas.width,canvas.height);</span></div><div class=\"line\">    context.fillStyle = <span class=\"string\">\"rgb(255,255,255)\"</span>;</div><div class=\"line\">    context.textBaseline = <span class=\"string\">'middle'</span>;<span class=\"comment\">//</span></div><div class=\"line\">    context.fillText(str,(c.width-str.length*<span class=\"number\">20</span>)/<span class=\"number\">2</span>,<span class=\"number\">10</span>, c.width*<span class=\"number\">0.9</span>);</div><div class=\"line\">    <span class=\"keyword\">var</span> str_src=c.toDataURL(<span class=\"string\">\"image/png\"</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> str_src;</div><div class=\"line\">    <span class=\"comment\">//return c;</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>　　该代码综合网上多个教程修改而来，其中生成jpeg的难点在于canvas默认生成四通道图像，而jpeg在去除透明度通道时会自动将透明度通道变成黑色，于是jpeg一片漆黑，解决方法是先画一个不透明的白色矩形背景，挡住所有透明通道，再在白色背景上画图。<br>　　在模型导入完毕后把Tom设为玩家列表对象arr_myplayers的一个属性，如果当前玩家处于在线状态，则还要把其加载状态同步给其他玩家，具体同步方式稍后介绍。<br>　　最后把玩家的相机定位到玩家模型的身后，做第三方跟随视角状。</p>\n<h2 id=\"三、加速度运动控制\"><a href=\"#三、加速度运动控制\" class=\"headerlink\" title=\"三、加速度运动控制\"></a>三、加速度运动控制</h2><p>在scene_link.js文件的中部可以看到scene.registerBeforeRender()方法，这个方法的作用是在每次渲染前调用作为它的参数的方法，我们通过这个方法在每次渲染前对物体的下一步运动情况进行计算：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\">scene.registerBeforeRender(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">    &#123;<span class=\"comment\">//每次渲染前</span></div><div class=\"line\">        <span class=\"keyword\">if</span>(scene.isReady() &amp;amp;&amp;amp; arr_myplayers)</div><div class=\"line\">        &#123;<span class=\"comment\">//场景加载完毕</span></div><div class=\"line\">            <span class=\"keyword\">if</span>(sceneCharger == <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">                engine.hideLoadingUI();<span class=\"comment\">//隐藏载入ui</span></div><div class=\"line\">                sceneCharger = <span class=\"literal\">true</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span>(ms0==<span class=\"number\">0</span>)</div><div class=\"line\">            &#123;<span class=\"comment\">//最开始，等一帧</span></div><div class=\"line\">                ms0=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();<span class=\"comment\">//设置初始时间</span></div><div class=\"line\">                schange=<span class=\"number\">0</span>;<span class=\"comment\">//初始化时间差</span></div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">else</span></div><div class=\"line\">            &#123;</div><div class=\"line\">                mst = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();<span class=\"comment\">//下一时刻</span></div><div class=\"line\">                schange = (mst - ms0) / <span class=\"number\">1000</span>;</div><div class=\"line\">                ms0=mst;<span class=\"comment\">//时间越过</span></div><div class=\"line\">                <span class=\"comment\">//对于这段时间内的每一个物体</span></div><div class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> arr_myplayers)<span class=\"comment\">//该客户端所控制的物体</span></div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"keyword\">var</span> obj = arr_myplayers[key];</div><div class=\"line\">                    <span class=\"keyword\">switch</span>(obj.methodofmove)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        <span class=\"keyword\">case</span> <span class=\"string\">\"controlwitha\"</span>:</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            movewitha(obj);</div><div class=\"line\">                            <span class=\"comment\">//这里加上dosend！！！！，原地不动也发送吗？</span></div><div class=\"line\">                            <span class=\"keyword\">if</span> (state == <span class=\"string\">\"online\"</span>)</div><div class=\"line\">                            &#123;</div><div class=\"line\">                                <span class=\"keyword\">if</span>(obj.vmove.x==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.vmove.y==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.vmove.z==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.rychange==<span class=\"number\">0</span>)</div><div class=\"line\">                                &#123;<span class=\"comment\">//如果位置和姿态不变</span></div><div class=\"line\">                                    <span class=\"keyword\">if</span>(obj.countstop&gt;<span class=\"number\">0</span>)</div><div class=\"line\">                                    &#123;<span class=\"comment\">//一直静止则不发送运动信息</span></div><div class=\"line\"></div><div class=\"line\">                                    &#125;</div><div class=\"line\">                                    <span class=\"keyword\">else</span></div><div class=\"line\">                                    &#123;</div><div class=\"line\">                                        obj.countstop+=<span class=\"number\">1</span>;</div><div class=\"line\">                                        <span class=\"comment\">//当前位置，当前角度，当前移动，当前姿态变化</span></div><div class=\"line\">                                        <span class=\"keyword\">var</span> arr = [];</div><div class=\"line\">                                        arr.push(<span class=\"string\">\"updatemesh\"</span>);</div><div class=\"line\">                                        arr.push(obj.mesh.position.x);</div><div class=\"line\">                                        arr.push(obj.mesh.position.y);</div><div class=\"line\">                                        arr.push(obj.mesh.position.z);</div><div class=\"line\">                                        arr.push(obj.mesh.rotation.x);</div><div class=\"line\">                                        arr.push(obj.mesh.rotation.y);</div><div class=\"line\">                                        arr.push(obj.mesh.rotation.z);</div><div class=\"line\">                                        arr.push(obj.vmove.x);</div><div class=\"line\">                                        arr.push(obj.vmove.y);</div><div class=\"line\">                                        arr.push(obj.vmove.z);</div><div class=\"line\">                                        arr.push(obj.rychange);</div><div class=\"line\">                                        doSend(arr.join(<span class=\"string\">\"@\"</span>));</div><div class=\"line\">                                    &#125;</div><div class=\"line\">                                &#125;</div><div class=\"line\">                                <span class=\"keyword\">else</span></div><div class=\"line\">                                &#123;</div><div class=\"line\">                                    obj.countstop=<span class=\"number\">0</span>;</div><div class=\"line\">                                    <span class=\"comment\">//当前位置，当前角度，当前移动，当前姿态变化</span></div><div class=\"line\">                                    <span class=\"keyword\">var</span> arr = [];</div><div class=\"line\">                                    arr.push(<span class=\"string\">\"updatemesh\"</span>);</div><div class=\"line\">                                    arr.push(obj.mesh.position.x);</div><div class=\"line\">                                    arr.push(obj.mesh.position.y);</div><div class=\"line\">                                    arr.push(obj.mesh.position.z);</div><div class=\"line\">                                    arr.push(obj.mesh.rotation.x);</div><div class=\"line\">                                    arr.push(obj.mesh.rotation.y);</div><div class=\"line\">                                    arr.push(obj.mesh.rotation.z);</div><div class=\"line\">                                    arr.push(obj.vmove.x);</div><div class=\"line\">                                    arr.push(obj.vmove.y);</div><div class=\"line\">                                    arr.push(obj.vmove.z);</div><div class=\"line\">                                    arr.push(obj.rychange);</div><div class=\"line\">                                    doSend(arr.join(<span class=\"string\">\"@\"</span>));</div><div class=\"line\">                                &#125;</div><div class=\"line\">                            &#125;</div><div class=\"line\"></div><div class=\"line\">                            <span class=\"keyword\">if</span>((obj.vmove.x!=<span class=\"number\">0</span>||obj.vmove.y!=<span class=\"number\">0</span>||obj.vmove.z!=<span class=\"number\">0</span>||obj.rychange!=<span class=\"number\">0</span>)&amp;amp;&amp;amp;obj.PlayAnnimation==<span class=\"literal\">false</span>)</div><div class=\"line\">                            &#123;<span class=\"comment\">//如果开始运动，启动骨骼动画</span></div><div class=\"line\">                                obj.PlayAnnimation=<span class=\"literal\">true</span>;</div><div class=\"line\">                                obj.beginSP(<span class=\"number\">0</span>);</div><div class=\"line\">                            &#125;</div><div class=\"line\">                            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(obj.vmove.x==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.vmove.y==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.vmove.z==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.rychange==<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.PlayAnnimation==<span class=\"literal\">true</span>)</div><div class=\"line\">                            &#123;<span class=\"comment\">//如果运动结束，关闭骨骼动画</span></div><div class=\"line\">                                obj.PlayAnnimation=<span class=\"literal\">false</span>;</div><div class=\"line\">                                scene.stopAnimation(obj.skeletonsPlayer[<span class=\"number\">0</span>]);</div><div class=\"line\">                            &#125;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">default</span> :</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">。。。</div></pre></td></tr></table></figure>\n<p>　　这里的意思是说如果玩家列表里的玩家的运动方式(methodofmove)是”controlwitha”，则使用movewitha(obj)方法计算其在这一时间段中的运动，当然，如果编写出了其他的运动方法也可以类似的扩展进来。<br>　　movewitha(obj)方法定义在MoveWeb.js文件中：</p>\n<h3 id=\"1、初速度投影\"><a href=\"#1、初速度投影\" class=\"headerlink\" title=\"1、初速度投影\"></a>1、初速度投影</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">movewitha</span>(<span class=\"params\">obj</span>)//地面上带有加速度的运动，必须站在地上才能加速，与宇宙空间中的喷气式加速度相比较</span></div><div class=\"line\">&#123;</div><div class=\"line\">    obj.ryt=obj.mesh.rotation.y;</div><div class=\"line\">    obj.rychange=<span class=\"built_in\">parseFloat</span>(obj.ryt - obj.ry0);</div><div class=\"line\">    obj.ry0=obj.ryt;</div><div class=\"line\">    <span class=\"comment\">//将上一时刻的速度投影到下一时刻的坐标里</span></div><div class=\"line\">    <span class=\"keyword\">var</span> v0t = &#123;forward: <span class=\"number\">0</span>, left: <span class=\"number\">0</span>, up: <span class=\"number\">0</span>&#125;;</div><div class=\"line\">    v0t.forward = obj.v0.forward * <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.cos(obj.rychange)) + (-obj.v0.left * <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.sin(obj.rychange)));</div><div class=\"line\">    v0t.left = (obj.v0.forward * <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.sin(obj.rychange))) + (obj.v0.left * <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.cos(obj.rychange)));</div><div class=\"line\">    v0t.up = obj.v0.up;</div><div class=\"line\">    obj.v0 = v0t;</div></pre></td></tr></table></figure>\n<p>　　物体在这一小段时间内可能绕y轴转过了一定角度，所以要把物体在上一时刻的自身坐标系速度投影到经过变化之后的自身坐标系中。</p>\n<h3 id=\"2、计算水平加速度，与水平位移\"><a href=\"#2、计算水平加速度，与水平位移\" class=\"headerlink\" title=\"2、计算水平加速度，与水平位移\"></a>2、计算水平加速度，与水平位移</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//计算水平加速度</span></div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.flag_standonground==<span class=\"number\">1</span>)<span class=\"comment\">//在地面上才能使用水平加速度</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"comment\">//移动速度产生的阻力，只考虑地面阻力，不考虑空气阻力</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (obj.v0.forward == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha.forward = <span class=\"number\">0</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.v0.forward &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha.forward = <span class=\"number\">-0.5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            obj.witha.forward = <span class=\"number\">0.5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (obj.v0.left == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha.left = <span class=\"number\">0</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.v0.left &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha.left = <span class=\"number\">-0.5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            obj.witha.left = <span class=\"number\">0.5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//最终加速度由环境加速度和物体自身加速度叠加而成</span></div><div class=\"line\">        obj.witha2.forward = obj.witha.forward+obj.witha0.forward;</div><div class=\"line\">        obj.witha2.left = obj.witha.left+obj.witha0.left;</div><div class=\"line\">        <span class=\"comment\">//根据键盘操作设置加速度</span></div><div class=\"line\">        <span class=\"comment\">//处理前后</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (obj.keys.w != <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha2.forward += <span class=\"number\">5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.keys.s != <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha2.forward -= <span class=\"number\">2</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//处理左右</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (obj.keys.a != <span class=\"number\">0</span> &amp;amp;&amp;amp; obj.keys.d != <span class=\"number\">0</span>) &#123;<span class=\"comment\">//同时按下左右键则什么也不做</span></div><div class=\"line\"></div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.keys.a != <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha2.left += <span class=\"number\">2</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.keys.d != <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            obj.witha2.left -= <span class=\"number\">2</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.witha2.forward=<span class=\"number\">0</span>;</div><div class=\"line\">        obj.witha2.left=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//根据水平加速度计算水平运动</span></div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.witha2.forward!=<span class=\"number\">0</span>)</div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.vt.forward = obj.v0.forward + obj.witha2.forward * schange;<span class=\"comment\">//速度变化</span></div><div class=\"line\">        <span class=\"keyword\">if</span>((<span class=\"number\">0</span> &lt; obj.vt.forward &amp;amp;&amp;amp; obj.vt.forward &lt; obj.vm.forward) || (<span class=\"number\">0</span> &gt; obj.vt.forward &amp;amp;&amp;amp; obj.vt.forward &gt; -obj.vm.backwards))</div><div class=\"line\">        &#123;<span class=\"comment\">//在最大速度范围内</span></div><div class=\"line\">            obj.mchange.forward = obj.witha2.forward * schange * schange + obj.v0.forward * schange;<span class=\"comment\">//加速度产生的距离变化</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.vm.forward &lt;= obj.vt.forward) &#123;<span class=\"comment\">//超出最大速度则按最大速度算</span></div><div class=\"line\">            obj.vt.forward = obj.vm.forward;</div><div class=\"line\">            obj.mchange.forward = obj.vt.forward * schange;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (-obj.vm.backwards &gt;= obj.vt.forward) &#123;</div><div class=\"line\">            obj.vt.forward = -obj.vm.backwards;</div><div class=\"line\">            obj.mchange.forward = obj.vt.forward * schange;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> &#123;<span class=\"comment\">//无加速度时匀速运动</span></div><div class=\"line\">        obj.mchange.forward = obj.v0.forward * schange;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.witha2.left!=<span class=\"number\">0</span>)</div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.vt.left = obj.v0.left + obj.witha2.left * schange;<span class=\"comment\">//速度变化</span></div><div class=\"line\">        <span class=\"keyword\">if</span>((<span class=\"number\">0</span> &lt; obj.vt.left &amp;amp;&amp;amp; obj.vt.left &lt; obj.vm.left) || (<span class=\"number\">0</span> &gt; obj.vt.left &amp;amp;&amp;amp; obj.vt.left &gt; -obj.vm.right))</div><div class=\"line\">        &#123;<span class=\"comment\">//在最大速度范围内</span></div><div class=\"line\">            obj.mchange.left = obj.witha2.left * schange * schange + obj.v0.left * schange;<span class=\"comment\">//加速度产生的距离变化</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.vm.left &lt;= obj.vt.left) &#123;</div><div class=\"line\">            obj.vt.left = obj.vm.left;</div><div class=\"line\">            obj.mchange.left = obj.vt.left * schange;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (-obj.vm.right &gt;= obj.vt.left) &#123;</div><div class=\"line\">            obj.vt.left = -obj.vm.right;</div><div class=\"line\">            obj.mchange.left = obj.vt.left * schange;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        obj.mchange.left = obj.v0.left * schange;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3、计算垂直加速度、垂直位移：\"><a href=\"#3、计算垂直加速度、垂直位移：\" class=\"headerlink\" title=\"3、计算垂直加速度、垂直位移：\"></a>3、计算垂直加速度、垂直位移：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//垂直加速度单独计算</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//正在下落，但没有下落应有的距离</span></div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.v0.up&lt;<span class=\"number\">0</span>&amp;amp;&amp;amp;obj.flag_standonground==<span class=\"number\">0</span>&amp;amp;&amp;amp;((obj.py0-obj.mesh.position.y)&lt;(-obj.mchange.up)/<span class=\"number\">5</span>))</div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.v0.up=<span class=\"number\">0</span>;</div><div class=\"line\">        obj.flag_standonground=<span class=\"number\">1</span>;<span class=\"comment\">//表示接触地面</span></div><div class=\"line\">        obj.witha.up=<span class=\"number\">-0.5</span>;<span class=\"comment\">//考虑到下坡的存在，还要有一点向下的分量，使其能够沿地面向下但又不至于抖动过于剧烈</span></div><div class=\"line\">        obj.vm.up=<span class=\"number\">5</span>;</div><div class=\"line\">        obj.vm.down=<span class=\"number\">5</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(obj.flag_standonground==<span class=\"number\">1</span>&amp;amp;&amp;amp;((obj.py0-obj.mesh.position.y)&gt;(-obj.mchange.up)/<span class=\"number\">5</span>))<span class=\"comment\">//遇到了一个坑</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.flag_standonground=<span class=\"number\">0</span>;</div><div class=\"line\">        obj.witha.up=<span class=\"number\">-9.82</span>;</div><div class=\"line\">        obj.vm.up=<span class=\"number\">100</span>;</div><div class=\"line\">        obj.vm.down=<span class=\"number\">100</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    obj.witha2.up = obj.witha.up;</div><div class=\"line\">    <span class=\"keyword\">if</span> (obj.witha2.up != <span class=\"number\">0</span>&amp;amp;&amp;amp;(obj.flag_standonground==<span class=\"number\">0</span>||(obj.flag_standonground==<span class=\"number\">1</span>&amp;amp;&amp;amp;(obj.mchange.left!=<span class=\"number\">0</span>||obj.mchange.forward!=<span class=\"number\">0</span>)))) &#123;<span class=\"comment\">//不在地面或者有水平位移才考虑上下加速移动</span></div><div class=\"line\"></div><div class=\"line\">        obj.vt.up = obj.v0.up + obj.witha2.up * schange;<span class=\"comment\">//速度变化</span></div><div class=\"line\">        <span class=\"keyword\">if</span> ((<span class=\"number\">0</span> &lt; obj.vt.up &amp;amp;&amp;amp; obj.vt.up &lt; obj.vm.up) || (<span class=\"number\">0</span> &gt; obj.vt.up &amp;amp;&amp;amp; obj.vt.up &gt; -obj.vm.down)) &#123;</div><div class=\"line\">            obj.mchange.up = obj.witha2.up * schange * schange + obj.v0.up * schange;<span class=\"comment\">//加速度产生的距离变化</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.vm.up &lt;= obj.vt.up) &#123;</div><div class=\"line\">            obj.vt.up = obj.vm.up;</div><div class=\"line\">            obj.mchange.up = obj.vt.up * schange;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (-obj.vm.down &gt;= obj.vt.up) &#123;</div><div class=\"line\">            obj.vt.up = -obj.vm.down;</div><div class=\"line\">            obj.mchange.up = obj.vt.up * schange;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        obj.mchange.up = obj.v0.up * schange;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>　　Babylon初级教程中提供了两种现成的碰撞检测方法，其中一种能够较精确的检测到物体掉落在地面上，但不支持事件响应或者回调函数；另一种支持事件响应，但物体的碰撞检测边界太过粗糙，无法精确检测碰撞。所以我只好用“有没有在该方向上移动应有的距离”来暂时代替碰撞检测。</p>\n<h3 id=\"4、应用位移：\"><a href=\"#4、应用位移：\" class=\"headerlink\" title=\"4、应用位移：\"></a>4、应用位移：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//旧的当前速度没用了，更新当前速度</span></div><div class=\"line\">    obj.v0.forward = obj.vt.forward;</div><div class=\"line\">    obj.v0.left = obj.vt.left;</div><div class=\"line\">    obj.v0.up = obj.vt.up;</div><div class=\"line\">    <span class=\"comment\">//取消过于微小的速度和位移</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (obj.v0.forward &lt; <span class=\"number\">0.002</span> &amp;amp;&amp;amp; obj.v0.forward &gt; <span class=\"number\">-0.002</span>) &#123;</div><div class=\"line\">        obj.v0.forward = <span class=\"number\">0</span>;</div><div class=\"line\">        obj.mchange.forward=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (obj.v0.left &lt; <span class=\"number\">0.002</span> &amp;amp;&amp;amp; obj.v0.left &gt; <span class=\"number\">-0.002</span>) &#123;</div><div class=\"line\">        obj.v0.left = <span class=\"number\">0</span>;</div><div class=\"line\">        obj.mchange.left=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (obj.v0.up &lt; <span class=\"number\">0.002</span> &amp;amp;&amp;amp; obj.v0.up &gt; <span class=\"number\">-0.002</span>) &#123;</div><div class=\"line\">        obj.v0.up = <span class=\"number\">0</span>;</div><div class=\"line\">        obj.mchange.up=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.mchange.forward&lt;<span class=\"number\">0.002</span>&amp;amp;&amp;amp; obj.mchange.forward &gt; <span class=\"number\">-0.002</span>)</div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.mchange.forward=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.mchange.left&lt;<span class=\"number\">0.002</span>&amp;amp;&amp;amp; obj.mchange.left &gt; <span class=\"number\">-0.002</span>)</div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.mchange.left=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span>(obj.mchange.up&lt;<span class=\"number\">0.002</span>&amp;amp;&amp;amp; obj.mchange.up &gt; <span class=\"number\">-0.002</span>)</div><div class=\"line\">    &#123;</div><div class=\"line\">        obj.mchange.up=<span class=\"number\">0</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//实施移动，未来要考虑把这个实施移动传递给远方客户端</span></div><div class=\"line\">        obj.py0=obj.mesh.position.y;</div><div class=\"line\">        <span class=\"keyword\">var</span> vectir1=(<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.sin(<span class=\"built_in\">parseFloat</span>(obj.mesh.rotation.y))) * obj.mchange.forward * obj.flag_runfast,</div><div class=\"line\">            <span class=\"number\">0</span>, <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.cos(<span class=\"built_in\">parseFloat</span>(obj.mesh.rotation.y))) * obj.mchange.forward * obj.flag_runfast)).negate();</div><div class=\"line\">        <span class=\"keyword\">var</span> vectir2=<span class=\"keyword\">new</span> BABYLON.Vector3(-<span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.cos(<span class=\"built_in\">parseFloat</span>(obj.mesh.rotation.y))) * obj.mchange.left * obj.flag_runfast,</div><div class=\"line\">            <span class=\"number\">0</span>, <span class=\"built_in\">parseFloat</span>(<span class=\"built_in\">Math</span>.sin(<span class=\"built_in\">parseFloat</span>(obj.mesh.rotation.y))) * obj.mchange.left * obj.flag_runfast).negate();</div><div class=\"line\">        <span class=\"keyword\">var</span> vectir3=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, obj.mchange.up * obj.flag_runfast, <span class=\"number\">0</span>);</div><div class=\"line\">        obj.vmove = vectir1.add(vectir2).add(vectir3);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span>((obj.vmove.x!=<span class=\"number\">0</span>||obj.vmove.y!=<span class=\"number\">0</span>||obj.vmove.z!=<span class=\"number\">0</span>))</div><div class=\"line\">        &#123;</div><div class=\"line\">            obj.mesh.moveWithCollisions(obj.vmove);<span class=\"comment\">//似乎同一时刻只有一个物体能够使用这个方法！！</span></div><div class=\"line\">            </div><div class=\"line\">        &#125;</div></pre></td></tr></table></figure>\n<p>　　这里把物体坐标系位移向世界坐标系位移投影的方法参考了Babylon教程示例。这里有一个思维上的难点：对于一个物体来说“模型的正向”、“mesh的正向”和“骨骼动画的正向”可能不是一个方向！这是模型绘制者使用3D模型绘制工具时的习惯造成的，如果有条件的话可以在使用3D模型前用绘制工具把模型调整一下。</p>\n<h2 id=\"四、数据发送：\"><a href=\"#四、数据发送：\" class=\"headerlink\" title=\"四、数据发送：\"></a>四、数据发送：</h2><h3 id=\"1、Java后台的Websocket代码：\"><a href=\"#1、Java后台的Websocket代码：\" class=\"headerlink\" title=\"1、Java后台的Websocket代码：\"></a>1、Java后台的Websocket代码：</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CopyOnWriteArraySet;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.websocket.OnClose;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.websocket.OnError;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.websocket.OnMessage;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.websocket.OnOpen;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.websocket.Session;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.websocket.server.ServerEndpoint;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@ServerEndpoint</span>(<span class=\"string\">\"/websocket3\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Practice</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> onlineCount = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CopyOnWriteArraySet&lt;Practice&gt; webSocketSet = <span class=\"keyword\">new</span> CopyOnWriteArraySet&lt;Practice&gt;();</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String admin=<span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> Session session;</div><div class=\"line\">    <span class=\"keyword\">private</span> String name=<span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String id=<span class=\"string\">\"\"</span>;</div><div class=\"line\">    <span class=\"meta\">@OnOpen</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onOpen</span><span class=\"params\">(Session session)</span></span></div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.session = session;</div><div class=\"line\">        webSocketSet.add(<span class=\"keyword\">this</span>);     <span class=\"comment\">//加入set中</span></div><div class=\"line\">        addOnlineCount();           <span class=\"comment\">//在线数加1</span></div><div class=\"line\">        <span class=\"comment\">//System.out.println(\"有新连接加入！当前在线人数为\" + getOnlineCount());</span></div><div class=\"line\">        <span class=\"keyword\">try</span> </div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"keyword\">this</span>.sendMessage(<span class=\"string\">\"@id:\"</span>+<span class=\"keyword\">this</span>.session.getId());<span class=\"comment\">//这个id是按总连接数来算的，可以避免重复</span></div><div class=\"line\">            <span class=\"keyword\">this</span>.id=<span class=\"keyword\">this</span>.session.getId();</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">        &#123;   </div><div class=\"line\">            <span class=\"keyword\">if</span>(!item.id.equals(<span class=\"keyword\">this</span>.id))</div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    item.sendMessage(<span class=\"string\">\"[getonl]\"</span>+<span class=\"keyword\">this</span>.id);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"meta\">@OnClose</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onClose</span><span class=\"params\">()</span></span></div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">        &#123;   </div><div class=\"line\">            <span class=\"keyword\">if</span>(!item.id.equals(<span class=\"keyword\">this</span>.id))</div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    item.sendMessage(<span class=\"string\">\"[getoff]\"</span>+<span class=\"keyword\">this</span>.id);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.id.equals(Practice.admin))<span class=\"comment\">//如果是admin下线了</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            webSocketSet.remove(<span class=\"keyword\">this</span>);  <span class=\"comment\">//从set中删除</span></div><div class=\"line\">            subOnlineCount();           <span class=\"comment\">//在线数减1</span></div><div class=\"line\">            <span class=\"keyword\">if</span>(webSocketSet.size()&gt;<span class=\"number\">0</span>)</div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;</div><div class=\"line\">                <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">                &#123; <span class=\"comment\">//挑选剩余队列中的下一个玩家作为admin</span></div><div class=\"line\">                    <span class=\"keyword\">if</span>(i==<span class=\"number\">0</span>)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        i++;</div><div class=\"line\">                        item.name=<span class=\"string\">\"admin\"</span>;</div><div class=\"line\">                        Practice.admin=item.id;</div><div class=\"line\">                        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                            item.sendMessage(<span class=\"string\">\"@name:admin\"</span>);<span class=\"comment\">//任命</span></div><div class=\"line\">                        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                            e.printStackTrace();</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    </div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">else</span></div><div class=\"line\">            &#123;</div><div class=\"line\">                Practice.admin=<span class=\"string\">\"\"</span>;<span class=\"comment\">//可能所有用户都下线了，但这个服务还在</span></div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            webSocketSet.remove(<span class=\"keyword\">this</span>);  <span class=\"comment\">//从set中删除</span></div><div class=\"line\">            subOnlineCount();           <span class=\"comment\">//在线数减1</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"comment\">//System.out.println(\"有一连接关闭！当前在线人数为\" + getOnlineCount());</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"meta\">@OnMessage</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMessage</span><span class=\"params\">(String message, Session session)</span> </span></div><div class=\"line\">    &#123;</div><div class=\"line\">        <span class=\"comment\">//System.out.println(\"来自客户端的消息:\" + message);</span></div><div class=\"line\">        <span class=\"keyword\">if</span>((message.length()&gt;<span class=\"number\">6</span>)&amp;amp;&amp;amp;(message.substring(<span class=\"number\">0</span>,<span class=\"number\">6</span>).equals(<span class=\"string\">\"@name:\"</span>)))<span class=\"comment\">//这个是命名信息//如果message不足6竟然会报错！！</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            String str_name=message.split(<span class=\"string\">\":\"</span>)[<span class=\"number\">1</span>];    </div><div class=\"line\">            <span class=\"keyword\">if</span>(str_name.equals(<span class=\"string\">\"admin\"</span>))<span class=\"comment\">//如果这个玩家的角色是admin</span></div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span>(Practice.admin.equals(<span class=\"string\">\"\"</span>))</div><div class=\"line\">                &#123;<span class=\"comment\">//如果还没有admin</span></div><div class=\"line\">                    <span class=\"keyword\">this</span>.name=str_name;</div><div class=\"line\">                    Practice.admin=<span class=\"keyword\">this</span>.id;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        <span class=\"keyword\">this</span>.sendMessage(<span class=\"string\">\"@name:admin\"</span>);<span class=\"comment\">//任命</span></div><div class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                        e.printStackTrace();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">else</span></div><div class=\"line\">                &#123;<span class=\"comment\">//如果已经有了admin</span></div><div class=\"line\">                    <span class=\"keyword\">this</span>.name=<span class=\"keyword\">this</span>.id;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        <span class=\"keyword\">this</span>.sendMessage(<span class=\"string\">\"@name:\"</span>+<span class=\"keyword\">this</span>.session.getId());</div><div class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                        e.printStackTrace();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((message.length()&gt;<span class=\"number\">6</span>)&amp;amp;&amp;amp;(message.substring(<span class=\"number\">0</span>,<span class=\"number\">7</span>).equals(<span class=\"string\">\"privat:\"</span>)))</div><div class=\"line\">        &#123;<span class=\"comment\">//私聊信息</span></div><div class=\"line\">            <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">            &#123; </div><div class=\"line\">                <span class=\"keyword\">if</span>(item.id.equals(message.split(<span class=\"string\">\"#\"</span>)[<span class=\"number\">0</span>].split(<span class=\"string\">\":\"</span>)[<span class=\"number\">1</span>]))</div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        item.sendMessage(<span class=\"keyword\">this</span>.id+<span class=\"string\">\"@\"</span>+message.split(<span class=\"string\">\"#\"</span>)[<span class=\"number\">1</span>]);</div><div class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                        e.printStackTrace();</div><div class=\"line\">                        <span class=\"keyword\">continue</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;            </div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>((message.length()&gt;<span class=\"number\">6</span>)&amp;amp;&amp;amp;(message.substring(<span class=\"number\">0</span>,<span class=\"number\">8</span>).equals(<span class=\"string\">\"[admins]\"</span>))&amp;amp;&amp;amp;<span class=\"keyword\">this</span>.name.equals(<span class=\"string\">\"admin\"</span>))</div><div class=\"line\">        &#123;<span class=\"comment\">//由adminserver向其他server广播的信息</span></div><div class=\"line\">            <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">            &#123;   </div><div class=\"line\">                <span class=\"keyword\">if</span>(!item.id.equals(<span class=\"keyword\">this</span>.id))</div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        item.sendMessage(message);</div><div class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                        e.printStackTrace();</div><div class=\"line\">                        <span class=\"keyword\">continue</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;            </div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"comment\">//广播信息，不发给自己</span></div><div class=\"line\">            <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">            &#123;   </div><div class=\"line\">                <span class=\"keyword\">if</span>(!item.id.equals(<span class=\"keyword\">this</span>.id))</div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        item.sendMessage(<span class=\"keyword\">this</span>.id+<span class=\"string\">\"@\"</span>+message);</div><div class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                        e.printStackTrace();</div><div class=\"line\">                        <span class=\"keyword\">continue</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;               </div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"meta\">@OnError</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onError</span><span class=\"params\">(Session session, Throwable error)</span></span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"发生错误，关闭连接\"</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">        &#123;   </div><div class=\"line\">            <span class=\"keyword\">if</span>(!item.id.equals(<span class=\"keyword\">this</span>.id))</div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    item.sendMessage(<span class=\"string\">\"[geterr]\"</span>+<span class=\"keyword\">this</span>.id);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.id.equals(Practice.admin))<span class=\"comment\">//如果是admin下线了</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            webSocketSet.remove(<span class=\"keyword\">this</span>);  <span class=\"comment\">//从set中删除</span></div><div class=\"line\">            subOnlineCount();           <span class=\"comment\">//在线数减1</span></div><div class=\"line\">            <span class=\"keyword\">if</span>(webSocketSet.size()&gt;<span class=\"number\">0</span>)</div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;</div><div class=\"line\">                <span class=\"keyword\">for</span>(Practice item: webSocketSet)</div><div class=\"line\">                &#123; <span class=\"comment\">//挑选剩余队列中的下一个玩家作为admin</span></div><div class=\"line\">                    <span class=\"keyword\">if</span>(i==<span class=\"number\">0</span>)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        i++;</div><div class=\"line\">                        item.name=<span class=\"string\">\"admin\"</span>;</div><div class=\"line\">                        Practice.admin=item.id;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                        item.sendMessage(<span class=\"string\">\"@name:admin\"</span>);<span class=\"comment\">//任命</span></div><div class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</div><div class=\"line\">                        e.printStackTrace();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">else</span></div><div class=\"line\">            &#123;</div><div class=\"line\">                Practice.admin=<span class=\"string\">\"\"</span>;<span class=\"comment\">//可能所有用户都下线了，但这个服务还在</span></div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            webSocketSet.remove(<span class=\"keyword\">this</span>);  <span class=\"comment\">//从set中删除</span></div><div class=\"line\">            subOnlineCount();           <span class=\"comment\">//在线数减1</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">//webSocketSet.remove(this);</span></div><div class=\"line\">        <span class=\"comment\">//subOnlineCount(); </span></div><div class=\"line\">        error.printStackTrace();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">sendMessage</span><span class=\"params\">(String message)</span> <span class=\"keyword\">throws</span> IOException</span>&#123;<span class=\"comment\">//此为同步阻塞的发送方式（单发）</span></div><div class=\"line\">        <span class=\"keyword\">this</span>.session.getBasicRemote().sendText(message);</div><div class=\"line\">        Date dt=<span class=\"keyword\">new</span> Date();</div><div class=\"line\">        <span class=\"comment\">//System.out.println(dt.getTime()+\"==&gt;&gt;\"+message);</span></div><div class=\"line\">        <span class=\"comment\">//this.session.getAsyncRemote().sendText(message);</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sendMessage2</span><span class=\"params\">(String message)</span> <span class=\"keyword\">throws</span> IOException</span>&#123;<span class=\"comment\">//此为异步非阻塞的发送方式（单发）</span></div><div class=\"line\">        <span class=\"keyword\">this</span>.session.getAsyncRemote ().sendText(message);</div><div class=\"line\">        Date dt=<span class=\"keyword\">new</span> Date();</div><div class=\"line\">        <span class=\"comment\">//System.out.println(dt.getTime()+\"==&gt;&gt;\"+message);</span></div><div class=\"line\">        <span class=\"comment\">//this.session.getAsyncRemote().sendText(message);</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">int</span> <span class=\"title\">getOnlineCount</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> onlineCount;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">addOnlineCount</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        Practice.onlineCount++;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">subOnlineCount</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        Practice.onlineCount--;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>　　这个方法参考网上的一篇WebSocket教程编写而成，其大意是为每个上线的用户分配id，并把第一个自称是admin的用户设为主机，在主机用户下线后再任命另一个用户为主机。在数据同步方面提供“私聊”、“admin广播”、“普通广播”三种方式。在传输数据时遇到多个异步传输需求对this.session.getAsyncRemote ()争抢导致报错的问题，经过试验使用同步模式的sendMessage方法可以避免这一错误，至于用户量提升后同步方法能否提供足够的传输效率还要进一步研究。</p>\n<h3 id=\"2、前台的WebSocket代码位于WebSocket-js中：\"><a href=\"#2、前台的WebSocket代码位于WebSocket-js中：\" class=\"headerlink\" title=\"2、前台的WebSocket代码位于WebSocket.js中：\"></a>2、前台的WebSocket代码位于WebSocket.js中：</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> wsUri=<span class=\"string\">\"\"</span>;</div><div class=\"line\"><span class=\"keyword\">var</span> websocket;</div><div class=\"line\"><span class=\"keyword\">var</span> id=<span class=\"string\">\"\"</span>;<span class=\"comment\">//这个是sessionid！！</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">//建立连接</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Connect</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">&#123;<span class=\"comment\">//</span></div><div class=\"line\">    <span class=\"keyword\">var</span> location = (<span class=\"built_in\">window</span>.location+<span class=\"string\">''</span>).split(<span class=\"string\">'/'</span>);</div><div class=\"line\">    <span class=\"keyword\">var</span> IP=location[<span class=\"number\">2</span>];</div><div class=\"line\">    <span class=\"comment\">//wsUri=\"ws://\"+IP+\"/JUMP/websocket3\";</span></div><div class=\"line\">    wsUri=<span class=\"string\">\"ws://\"</span>+$(<span class=\"string\">\"#str_ip\"</span>)[<span class=\"number\">0</span>].value+<span class=\"string\">\":8081/PRACTICE/websocket3\"</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        websocket = <span class=\"keyword\">new</span> WebSocket(wsUri);<span class=\"comment\">//建立ws连接</span></div><div class=\"line\">        $(<span class=\"string\">\"#str_ip\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">true</span>;</div><div class=\"line\">        $(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">true</span>;</div><div class=\"line\">        username=$(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].value;</div><div class=\"line\">        $(<span class=\"string\">\"#btn_create\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\"></div><div class=\"line\">        websocket.onopen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">evt</span>) //连接建立完毕</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            onOpen(evt)</div><div class=\"line\">        &#125;;</div><div class=\"line\">        websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">evt</span>) </span>&#123;<span class=\"comment\">//收到服务器发来的信息</span></div><div class=\"line\">            onMessage(evt)</div><div class=\"line\">        &#125;;</div><div class=\"line\">        websocket.onclose = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">evt</span>) </span>&#123;</div><div class=\"line\">            onClose(evt)</div><div class=\"line\">        &#125;;</div><div class=\"line\">        websocket.onerror = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">evt</span>) </span>&#123;</div><div class=\"line\">            onError(evt)</div><div class=\"line\">        &#125;;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">catch</span>(e)</div><div class=\"line\">    &#123;</div><div class=\"line\">        alert(e);</div><div class=\"line\">        $(<span class=\"string\">\"#str_ip\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\">        $(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//连接建立完成的回调函数</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onOpen</span>(<span class=\"params\">evt</span>) </span>&#123;</div><div class=\"line\">    state=<span class=\"string\">\"online\"</span>;</div><div class=\"line\">    doSend(<span class=\"string\">\"@name:\"</span>+$(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].value);<span class=\"comment\">//连接建立后把浏览器端的用户信息传过去</span></div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//关闭连接</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Close</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    websocket.close();<span class=\"comment\">//浏览器端关闭连接</span></div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onClose</span>(<span class=\"params\">evt</span>) </span>&#123;</div><div class=\"line\">    writeToScreen(<span class=\"string\">'&lt;span style=\"color: red;\"&gt;本机连接关闭&lt;/span&gt;'</span>);</div><div class=\"line\">    $(<span class=\"string\">\"#str_ip\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\">    $(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\">    state=<span class=\"string\">\"offline\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//收到服务器端发来的消息</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onMessage</span>(<span class=\"params\">evt</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> str_data=evt.data;</div><div class=\"line\">    <span class=\"keyword\">if</span>(str_data.substr(<span class=\"number\">0</span>,<span class=\"number\">4</span>)==<span class=\"string\">\"@id:\"</span>)<span class=\"comment\">//从服务端返回了sessionid</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        id=str_data.split(<span class=\"string\">\":\"</span>)[<span class=\"number\">1</span>];</div><div class=\"line\">        $(<span class=\"string\">\"#str_id\"</span>)[<span class=\"number\">0</span>].innerHTML=id;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(str_data.substr(<span class=\"number\">0</span>,<span class=\"number\">6</span>)==<span class=\"string\">\"@name:\"</span>)<span class=\"comment\">//从服务端返回了任命信息</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        username=str_data.split(<span class=\"string\">\":\"</span>)[<span class=\"number\">1</span>];</div><div class=\"line\">        <span class=\"keyword\">if</span>(username==<span class=\"string\">\"admin\"</span>)</div><div class=\"line\">        &#123;</div><div class=\"line\">            $(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].value=username;</div><div class=\"line\">            writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;本机被任命为admin&lt;/span&gt;'</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            $(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].value=username;</div><div class=\"line\">            writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;已存在admin，本机被重命名为'</span>+username+<span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">。。。</div><div class=\"line\">    </div><div class=\"line\"><span class=\"comment\">//发生错误</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onError</span>(<span class=\"params\">evt</span>) </span>&#123;</div><div class=\"line\">    writeToScreen(<span class=\"string\">'&lt;span style=\"color: red;\"&gt;ERROR:&lt;/span&gt; '</span>+ evt.data);</div><div class=\"line\">    $(<span class=\"string\">\"#str_ip\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\">    $(<span class=\"string\">\"#str_name\"</span>)[<span class=\"number\">0</span>].disabled=<span class=\"literal\">false</span>;</div><div class=\"line\">    state=<span class=\"string\">\"offline\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//发送命令行信息</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Send</span>(<span class=\"params\"></span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    doSend($(<span class=\"string\">\"#str_message\"</span>)[<span class=\"number\">0</span>].value);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//向服务端发送信息</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doSend</span>(<span class=\"params\">message</span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    websocket.send(message);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//写入操作日志</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">writeToScreen</span>(<span class=\"params\">message</span>)</span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> pre = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"p\"</span>);</div><div class=\"line\">    pre.style.wordWrap = <span class=\"string\">\"break-word\"</span>;</div><div class=\"line\">    pre.innerHTML = MakeDateStr()+<span class=\"string\">\"-&gt;\"</span>+message;</div><div class=\"line\">    str_log.appendChild(pre);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>　　参考网上教程编写的常规WebSocket通信代码</p>\n<h3 id=\"3、建立一些“NPC物体”，也要对他们的状态进行同步\"><a href=\"#3、建立一些“NPC物体”，也要对他们的状态进行同步\" class=\"headerlink\" title=\"3、建立一些“NPC物体”，也要对他们的状态进行同步\"></a>3、建立一些“NPC物体”，也要对他们的状态进行同步</h3><p>NPC物体的建立代码在scene_link.js文件的110行：<br><img src=\"http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif\" alt=\"picture\"><br><img src=\"http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif\" alt=\"picture\"></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//一次引入十个物体</span></div><div class=\"line\">    BABYLON.SceneLoader.ImportMesh(<span class=\"string\">\"Rabbit\"</span>, <span class=\"string\">\"../MODEL/Rabbit/\"</span>, <span class=\"string\">\"Rabbit.babylon\"</span>, scene, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">newMeshes, particleSystems, skeletons</span>)</span></div><div class=\"line\">    &#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> rabbitmesh = newMeshes[<span class=\"number\">1</span>];</div><div class=\"line\">        <span class=\"comment\">//shadowGenerator.getShadowMap().renderList.push(rabbitmesh);//加入阴影渲染队列</span></div><div class=\"line\">        <span class=\"keyword\">var</span> rabbit=<span class=\"keyword\">new</span> Animal;</div><div class=\"line\">        <span class=\"keyword\">var</span> obj_p=&#123;</div><div class=\"line\">            mesh:rabbitmesh,</div><div class=\"line\">            scaling:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0.04</span>, <span class=\"number\">0.04</span>, <span class=\"number\">0.04</span>),<span class=\"comment\">//缩放</span></div><div class=\"line\">            position:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">100</span>, <span class=\"number\">30</span>, <span class=\"built_in\">Math</span>.random()*<span class=\"number\">100</span>),<span class=\"comment\">//位置</span></div><div class=\"line\">            rotation:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.random()*<span class=\"number\">6.28</span>, <span class=\"number\">0</span>),<span class=\"comment\">// 旋转</span></div><div class=\"line\">            <span class=\"comment\">//rotation:new BABYLON.Vector3(0, 0, 0),</span></div><div class=\"line\">            checkCollisions:<span class=\"literal\">true</span>,<span class=\"comment\">//使用默认的碰撞检测</span></div><div class=\"line\">            ellipsoid:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>),<span class=\"comment\">//碰撞检测椭球</span></div><div class=\"line\">            ellipsoidOffset:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>),<span class=\"comment\">//碰撞检测椭球位移</span></div><div class=\"line\">            fieldofvision:<span class=\"number\">50</span>,<span class=\"comment\">//视野</span></div><div class=\"line\">            powerofmove:<span class=\"number\">1</span>,<span class=\"comment\">//移动力量</span></div><div class=\"line\">            methodofmove:<span class=\"string\">\"controlwitha\"</span>,</div><div class=\"line\">            state:<span class=\"string\">\"eat\"</span>,</div><div class=\"line\">            id:<span class=\"string\">\"rabbit\"</span></div><div class=\"line\">        &#125;;</div><div class=\"line\">        rabbit.init(obj_p);</div><div class=\"line\">        arr_animals[<span class=\"string\">\"rabbit\"</span>]=rabbit;</div><div class=\"line\">        scene.beginAnimation(rabbitmesh.skeleton, <span class=\"number\">0</span>, <span class=\"number\">72</span>, <span class=\"literal\">true</span>, <span class=\"number\">0.8</span>);</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">\"rabbit\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span>(i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">9</span>;i++)</div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"keyword\">var</span> rabbitmesh2 = rabbitmesh.clone(<span class=\"string\">\"rabbit2\"</span>+(i+<span class=\"number\">2</span>));</div><div class=\"line\">            rabbitmesh2.skeleton = rabbitmesh.skeleton.clone(<span class=\"string\">\"clonedSkeleton\"</span>);</div><div class=\"line\">            <span class=\"keyword\">var</span> rabbit2=<span class=\"keyword\">new</span> Animal;</div><div class=\"line\">            <span class=\"keyword\">var</span> obj_p2=&#123;</div><div class=\"line\">                mesh:rabbitmesh2,</div><div class=\"line\">                scaling:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0.04</span>, <span class=\"number\">0.04</span>, <span class=\"number\">0.04</span>),<span class=\"comment\">//缩放</span></div><div class=\"line\">                position:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">Math</span>.random()*<span class=\"number\">100</span>, <span class=\"number\">30</span>, <span class=\"built_in\">Math</span>.random()*<span class=\"number\">100</span>),<span class=\"comment\">//位置</span></div><div class=\"line\">                rotation:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"built_in\">Math</span>.random()*<span class=\"number\">6.28</span>, <span class=\"number\">0</span>),<span class=\"comment\">// 旋转</span></div><div class=\"line\">                <span class=\"comment\">//rotation:new BABYLON.Vector3(0, 0, 0),// 旋转</span></div><div class=\"line\">                checkCollisions:<span class=\"literal\">true</span>,<span class=\"comment\">//使用默认的碰撞检测</span></div><div class=\"line\">                ellipsoid:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>),<span class=\"comment\">//碰撞检测椭球</span></div><div class=\"line\">                ellipsoidOffset:<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>),<span class=\"comment\">//碰撞检测椭球位移</span></div><div class=\"line\">                fieldofvision:<span class=\"number\">50</span>,<span class=\"comment\">//视野</span></div><div class=\"line\">                powerofmove:<span class=\"number\">1</span>,<span class=\"comment\">//移动力量</span></div><div class=\"line\">                methodofmove:<span class=\"string\">\"controlwitha\"</span>,</div><div class=\"line\">                state:<span class=\"string\">\"eat\"</span>,</div><div class=\"line\">                id:<span class=\"string\">\"rabbit\"</span>+(i+<span class=\"number\">2</span>)</div><div class=\"line\">            &#125;;</div><div class=\"line\">            rabbit2.init(obj_p2);</div><div class=\"line\">            arr_animals[<span class=\"string\">\"rabbit\"</span>+(i+<span class=\"number\">2</span>)]=rabbit2;</div><div class=\"line\">            scene.beginAnimation(rabbitmesh2.skeleton, <span class=\"number\">0</span>, <span class=\"number\">72</span>, <span class=\"literal\">true</span>, <span class=\"number\">0.8</span>);</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">\"rabbit\"</span>+(i+<span class=\"number\">2</span>));</div><div class=\"line\">            <span class=\"comment\">//shadowGenerator.getShadowMap().renderList.push(rabbitmesh2);//报错</span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">    &#125;);</div></pre></td></tr></table></figure>\n<p>View Code　　这里建立了十个物体，其中只有第一个物体的骨骼模型是从模型文件中导入内存的，其他的物体都在内存中从第一个物体“克隆”而来。注意，在Babylon看来骨骼也是一种特殊的网格（Mesh），所以对网格和骨骼的克隆是分别进行的，再把骨骼克隆的结果作为网格克隆结果的骨骼属性。<br>　　十个物体被初始化为Animal对象，Animal对象与Player对象类似，都是从sdyq.object对象派生而来。<br>NPC物体的运动控制和运动同步代码在317行：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span>(username==<span class=\"string\">\"admin\"</span>)<span class=\"comment\">//由主机对所有NPC物体的相互作用进行计算，再把作用结果同步到各个分机</span></div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"comment\">//计算每个动物和所有玩家的交互效果</span></div><div class=\"line\">                    <span class=\"keyword\">var</span> arr_rabbitmove=[];</div><div class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> arr_animals)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        <span class=\"keyword\">var</span> rabbit=arr_animals[key];</div><div class=\"line\">                        <span class=\"keyword\">var</span> v_face=<span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>);</div><div class=\"line\">                        <span class=\"keyword\">var</span> newstate=<span class=\"string\">\"eat\"</span>;</div><div class=\"line\">                        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key2 <span class=\"keyword\">in</span> arr_myplayers)</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">var</span> obj=arr_myplayers[key2];</div><div class=\"line\">                            <span class=\"keyword\">var</span> v_sub=rabbit.mesh.position.subtract(obj.mesh.position);</div><div class=\"line\">                            <span class=\"keyword\">var</span> distans=v_sub.length();<span class=\"comment\">//兔子与人类之间的距离</span></div><div class=\"line\">                            <span class=\"keyword\">if</span>(distans&lt;rabbit.fieldofvision)<span class=\"comment\">//在视野内发现了人类</span></div><div class=\"line\">                            &#123;</div><div class=\"line\">                                newstate=<span class=\"string\">\"run\"</span>;</div><div class=\"line\">                                v_face.addInPlace(v_sub.normalize().scaleInPlace(<span class=\"number\">1</span>/distans));<span class=\"comment\">//越近则影响越大</span></div><div class=\"line\">                            &#125;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key2 <span class=\"keyword\">in</span> arr_webplayers)</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">var</span> obj=arr_webplayers[key2];</div><div class=\"line\">                            <span class=\"keyword\">var</span> v_sub=rabbit.mesh.position.subtract(obj.mesh.position);</div><div class=\"line\">                            <span class=\"keyword\">var</span> distans=v_sub.length();</div><div class=\"line\">                            <span class=\"keyword\">if</span>(distans&lt;rabbit.fieldofvision)<span class=\"comment\">//在视野内发现了人类</span></div><div class=\"line\">                            &#123;</div><div class=\"line\">                                newstate=<span class=\"string\">\"run\"</span>;</div><div class=\"line\">                                v_face.addInPlace(v_sub.normalize().scaleInPlace(<span class=\"number\">1</span>/distans));</div><div class=\"line\">                            &#125;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">if</span>(newstate==<span class=\"string\">\"run\"</span>&amp;amp;&amp;amp;rabbit.state==<span class=\"string\">\"eat\"</span>)</div><div class=\"line\">                        &#123;<span class=\"comment\">//从eat状态变为run状态</span></div><div class=\"line\">                            rabbit.state=<span class=\"string\">\"run\"</span>;</div><div class=\"line\">                            rabbit.powerofmove=<span class=\"number\">3</span>;</div><div class=\"line\">                            scene.beginAnimation(rabbit.mesh.skeleton, <span class=\"number\">0</span>, <span class=\"number\">72</span>, <span class=\"literal\">true</span>, <span class=\"number\">2.4</span>);</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(newstate==<span class=\"string\">\"eat\"</span>&amp;amp;&amp;amp;rabbit.state==<span class=\"string\">\"run\"</span>)</div><div class=\"line\">                        &#123;<span class=\"comment\">//从run状态变为eat状态</span></div><div class=\"line\">                            rabbit.state=<span class=\"string\">\"eat\"</span>;</div><div class=\"line\">                            rabbit.powerofmove=<span class=\"number\">1</span>;</div><div class=\"line\">                            scene.beginAnimation(rabbit.mesh.skeleton, <span class=\"number\">0</span>, <span class=\"number\">72</span>, <span class=\"literal\">true</span>, <span class=\"number\">0.8</span>);</div><div class=\"line\">                        &#125;</div><div class=\"line\"></div><div class=\"line\">                        <span class=\"keyword\">var</span> num_pi=<span class=\"built_in\">Math</span>.PI;</div><div class=\"line\">                        <span class=\"keyword\">if</span>(rabbit.state==<span class=\"string\">\"eat\"</span>)<span class=\"comment\">//一直没有见到人类</span></div><div class=\"line\">                        &#123;</div><div class=\"line\">                            rabbit.waitforturn+=schange;</div><div class=\"line\">                            <span class=\"keyword\">if</span>(rabbit.waitforturn&gt;<span class=\"number\">3</span>)</div><div class=\"line\">                            &#123;<span class=\"comment\">//每3秒随机决定一个运动方向</span></div><div class=\"line\">                                rabbit.waitforturn=<span class=\"number\">0</span>;</div><div class=\"line\">                                rabbit.witha0=&#123;forward:(<span class=\"built_in\">Math</span>.random()<span class=\"number\">-0.5</span>)*<span class=\"number\">2</span>*rabbit.powerofmove,up:<span class=\"number\">0</span>,left:(<span class=\"built_in\">Math</span>.random()<span class=\"number\">-0.5</span>)*<span class=\"number\">2</span>*rabbit.powerofmove&#125;;</div><div class=\"line\">                                rabbit.mesh.rotation.y=<span class=\"built_in\">Math</span>.random()*<span class=\"number\">6.28</span>;</div><div class=\"line\">                            &#125;</div><div class=\"line\">                            movewitha(rabbit);</div><div class=\"line\">                            <span class=\"comment\">//这些兔子的数据汇总起来一起传</span></div><div class=\"line\">                            arr_rabbitmove.push([key,rabbit.mesh.position,rabbit.mesh.rotation,rabbit.vmove,rabbit.rychange,rabbit.state]);</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(rabbit.state==<span class=\"string\">\"run\"</span>)</div><div class=\"line\">                        &#123;<span class=\"comment\">//奔跑远离人类</span></div><div class=\"line\">                            rabbit.witha0=&#123;forward:-rabbit.powerofmove,up:<span class=\"number\">0</span>,left:<span class=\"number\">0</span>&#125;;<span class=\"comment\">//这个是兔子的“自主加速度”！！不是世界加速度，也不是键盘控制产生的加速度</span></div><div class=\"line\">                            rabbit.mesh.rotation.y=(<span class=\"built_in\">Math</span>.atan(v_face.z/v_face.x)+num_pi*<span class=\"number\">1</span>/<span class=\"number\">2</span>);</div><div class=\"line\">                            movewitha(rabbit);</div><div class=\"line\">                            arr_rabbitmove.push([key,rabbit.mesh.position,rabbit.mesh.rotation,rabbit.vmove,rabbit.rychange,rabbit.state]);</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    <span class=\"keyword\">var</span> str_data=<span class=\"string\">\"[admins]\"</span>+<span class=\"built_in\">JSON</span>.stringify(arr_rabbitmove);</div><div class=\"line\">                    doSend(str_data);</div><div class=\"line\">                &#125;</div></pre></td></tr></table></figure></p>\n<p>　　在这个模式中，由主机承担所有的NPC物体运动计算工作，再把所有计算结果同步到分机，&nbsp;<br>　　起初对于不太复杂的玩家信息数据，我简单的用分隔符“@”将各个字段拼接成一个字符串向其他客户端传递，后来随着数据结构的复杂化，我改用JSON传递结构化的数据。</p>\n<h3 id=\"4、客户端对服务器端传来的信息进行处理：\"><a href=\"#4、客户端对服务器端传来的信息进行处理：\" class=\"headerlink\" title=\"4、客户端对服务器端传来的信息进行处理：\"></a>4、客户端对服务器端传来的信息进行处理：</h3><h4 id=\"a、添加新玩家，代码位于WebSocket-js184行：\"><a href=\"#a、添加新玩家，代码位于WebSocket-js184行：\" class=\"headerlink\" title=\"a、添加新玩家，代码位于WebSocket.js184行：\"></a>a、添加新玩家，代码位于WebSocket.js184行：</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">\"addnewplayer\"</span>:</div><div class=\"line\">                    &#123;<span class=\"comment\">//感知到加入了一个新的玩家，把新玩家加入到自己的场景里,先查询场景中是否已经有同名的mesh，如果有则使用clone方法同步加载，如果没有再使用import异步导入，这样做的根本原因在于import方法导入模型的返回函数里无法自定义参数</span></div><div class=\"line\">                        <span class=\"keyword\">var</span> dt=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</div><div class=\"line\">                        <span class=\"built_in\">console</span>.log(dt.getTime()+<span class=\"string\">\"get addnewplayer\"</span>+arr[<span class=\"number\">0</span>]);</div><div class=\"line\">                        <span class=\"keyword\">var</span> flag=<span class=\"number\">0</span>;<span class=\"comment\">//加载完成标志</span></div><div class=\"line\">                        <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> arr_myplayers)<span class=\"comment\">//先在本机的玩家列表里找</span></div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">if</span>(arr_myplayers[key].meshname==arr[<span class=\"number\">14</span>])<span class=\"comment\">//如果与主控物体的meshname相同</span></div><div class=\"line\">                            &#123;</div><div class=\"line\"></div><div class=\"line\">                                <span class=\"keyword\">var</span> obj_key=arr_myplayers[key];</div><div class=\"line\">                                arr_webplayers[arr[<span class=\"number\">0</span>]] = MyCloneplayer(obj_key,arr);</div><div class=\"line\">                                shadowGenerator.getShadowMap().renderList.push(arr_webplayers[arr[<span class=\"number\">0</span>]].mesh);<span class=\"comment\">//阴影生成器似乎对含有submesh的Mesh不起作用</span></div><div class=\"line\">                                writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;addnewplayer: '</span> + arr[<span class=\"number\">0</span>] + <span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">                                flag=<span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">                                <span class=\"comment\">//异步加入新玩家之后，还要把自己的信息发给新玩家，让新玩家添加自己（私聊）</span></div><div class=\"line\">                                addoldplayer(arr[<span class=\"number\">0</span>]);</div><div class=\"line\">                                <span class=\"keyword\">break</span>;</div><div class=\"line\">                            &#125;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">if</span>(flag==<span class=\"number\">0</span>)<span class=\"comment\">//再在网络玩家列表里查找</span></div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> arr_webplayers)</div><div class=\"line\">                            &#123;</div><div class=\"line\">                                <span class=\"keyword\">if</span>(arr_webplayers[key].meshname==arr[<span class=\"number\">14</span>])<span class=\"comment\">//如果与主控物体的meshname相同</span></div><div class=\"line\">                                &#123;</div><div class=\"line\">                                    <span class=\"keyword\">var</span> obj_key=arr_webplayers[key];</div><div class=\"line\">                                    arr_webplayers[arr[<span class=\"number\">0</span>]] = MyCloneplayer(obj_key,arr);</div><div class=\"line\">                                    shadowGenerator.getShadowMap().renderList.push(arr_webplayers[arr[<span class=\"number\">0</span>]].mesh);</div><div class=\"line\">                                    writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;addnewplayer: '</span> + arr[<span class=\"number\">0</span>] + <span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">                                    flag=<span class=\"number\">1</span>;</div><div class=\"line\">                                    <span class=\"comment\">//异步加入新玩家之后，还要把自己的信息发给新玩家，让新玩家添加自己（私聊）</span></div><div class=\"line\">                                    addoldplayer(arr[<span class=\"number\">0</span>]);</div><div class=\"line\">                                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                                &#125;</div><div class=\"line\">                            &#125;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">if</span>(flag==<span class=\"number\">0</span>)<span class=\"comment\">//都没找着，就新建</span></div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"comment\">//arr[14]保存着meshname可以作为异步方法间的纽带,如果发生同时加载两个一样的不存在的mesh时，让后来的那个通过websocket延时重发</span></div><div class=\"line\">                            <span class=\"keyword\">if</span>(tempobj[arr[<span class=\"number\">14</span>]]&amp;amp;&amp;amp;tempobj[arr[<span class=\"number\">14</span>]]!=<span class=\"string\">\"OK\"</span>)<span class=\"comment\">//这个暂存位正在被占用</span></div><div class=\"line\">                            &#123;</div><div class=\"line\">                                doSend(<span class=\"string\">\"privat:\"</span> + id + <span class=\"string\">\"#\"</span> + str_data);<span class=\"comment\">//请求websocket服务器再次把这个指令发给自己，以等待占用者完成操作</span></div><div class=\"line\">                            &#125;</div><div class=\"line\">                            <span class=\"keyword\">else</span></div><div class=\"line\">                            &#123;</div><div class=\"line\">                                tempobj[arr[<span class=\"number\">14</span>]] = arr;<span class=\"comment\">//用tempobj暂存该物体的初始化参数</span></div><div class=\"line\">                                BABYLON.SceneLoader.ImportMesh(arr[<span class=\"number\">11</span>], arr[<span class=\"number\">12</span>], arr[<span class=\"number\">13</span>], scene, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">newMeshes, particleSystems, skeletons</span>) </span>&#123;<span class=\"comment\">//载入完成的回调函数</span></div><div class=\"line\">                                    <span class=\"keyword\">var</span> Tom = <span class=\"keyword\">new</span> Player;</div><div class=\"line\">                                    <span class=\"keyword\">var</span> obj_p = &#123;&#125;;</div><div class=\"line\">                                    obj_p.mesh = newMeshes[<span class=\"number\">0</span>];<span class=\"comment\">//网格数据</span></div><div class=\"line\">                                    <span class=\"keyword\">var</span> arr = tempobj[obj_p.mesh.name];</div><div class=\"line\">                                    obj_p.scaling = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">2</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">3</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">4</span>]));<span class=\"comment\">//缩放</span></div><div class=\"line\">                                    obj_p.position = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">5</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">6</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">7</span>]));<span class=\"comment\">//位置</span></div><div class=\"line\">                                    obj_p.rotation = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">8</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">9</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">10</span>]));<span class=\"comment\">// 旋转</span></div><div class=\"line\">                                    obj_p.checkCollisions = <span class=\"literal\">true</span>;<span class=\"comment\">//使用默认的碰撞检测</span></div><div class=\"line\">                                    obj_p.ellipsoid = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0.5</span>, <span class=\"number\">1</span>, <span class=\"number\">0.5</span>);<span class=\"comment\">//碰撞检测椭球</span></div><div class=\"line\">                                    obj_p.ellipsoidOffset = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">0</span>);<span class=\"comment\">//碰撞检测椭球位移</span></div><div class=\"line\">                                    obj_p.skeletonsPlayer = skeletons;</div><div class=\"line\">                                    obj_p.methodofmove = <span class=\"string\">\"controlwitha\"</span>;</div><div class=\"line\">                                    obj_p.id = arr[<span class=\"number\">0</span>];</div><div class=\"line\">                                    obj_p.name = arr[<span class=\"number\">0</span>];</div><div class=\"line\">                                    obj_p.p1 = arr[<span class=\"number\">11</span>];</div><div class=\"line\">                                    obj_p.p2 = arr[<span class=\"number\">12</span>];</div><div class=\"line\">                                    obj_p.p3 = arr[<span class=\"number\">13</span>];</div><div class=\"line\">                                    <span class=\"keyword\">var</span> len=newMeshes.length;<span class=\"comment\">//对于复杂的模型来说newMeshes的其他部分也必须保存下来</span></div><div class=\"line\">                                    <span class=\"keyword\">var</span> arr=[];</div><div class=\"line\">                                    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>;i&lt;len;i++)</div><div class=\"line\">                                    &#123;</div><div class=\"line\">                                        arr.push(newMeshes[i]);</div><div class=\"line\">                                    &#125;</div><div class=\"line\">                                    obj_p.submeshs=arr;</div><div class=\"line\">                                    Tom.init(</div><div class=\"line\">                                        obj_p</div><div class=\"line\">                                    );</div><div class=\"line\">                                    tempobj[obj_p.mesh.name] = <span class=\"string\">\"OK\"</span>;</div><div class=\"line\">                                    arr_webplayers[arr[<span class=\"number\">0</span>]] = Tom;</div><div class=\"line\">                                    shadowGenerator.getShadowMap().renderList.push(arr_webplayers[arr[<span class=\"number\">0</span>]].mesh);</div><div class=\"line\"></div><div class=\"line\">                                    writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;addnewplayer: '</span> + arr[<span class=\"number\">0</span>] + <span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">                                    flag=<span class=\"number\">1</span>;</div><div class=\"line\">                                    <span class=\"comment\">//异步加入新玩家之后，还要把自己的信息发给新玩家，让新玩家添加自己（私聊）</span></div><div class=\"line\">                                    addoldplayer(arr[<span class=\"number\">0</span>]);</div><div class=\"line\"></div><div class=\"line\">                                &#125;);</div><div class=\"line\">                            &#125;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">break</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\"></div><div class=\"line\">                    <span class=\"keyword\">case</span> <span class=\"string\">\"addoldplayer\"</span>:</div><div class=\"line\">                    &#123;<span class=\"comment\">//添加一个前辈玩家，此时默认前辈的网络玩家列表里已经有了本元素，所以不需要再通知前辈玩家添加本玩家，多个前辈玩家同时返回如何处理？用出入栈方式？能保证先进先出？</span></div><div class=\"line\">                         <span class=\"keyword\">var</span> dt=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</div><div class=\"line\">                         <span class=\"built_in\">console</span>.log(dt.getTime()+<span class=\"string\">\"get addoldplayer\"</span>+arr[<span class=\"number\">0</span>]);</div><div class=\"line\">                         <span class=\"keyword\">var</span> flag=<span class=\"number\">0</span>;</div><div class=\"line\">                         <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> arr_myplayers)</div><div class=\"line\">                         &#123;</div><div class=\"line\">                             <span class=\"keyword\">if</span>(arr_myplayers[key].meshname==arr[<span class=\"number\">14</span>])<span class=\"comment\">//如果与主控物体的meshname相同</span></div><div class=\"line\">                             &#123;</div><div class=\"line\">                                 <span class=\"keyword\">var</span> obj_key=arr_myplayers[key];</div><div class=\"line\">                                 arr_webplayers[arr[<span class=\"number\">0</span>]] =MyCloneplayer(obj_key,arr);</div><div class=\"line\">                                 shadowGenerator.getShadowMap().renderList.push(arr_webplayers[arr[<span class=\"number\">0</span>]].mesh);</div><div class=\"line\">                                 writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;addoldplayer: '</span> + arr[<span class=\"number\">0</span>] + <span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">                                 flag=<span class=\"number\">1</span>;</div><div class=\"line\"> </div><div class=\"line\">                                 <span class=\"keyword\">break</span>;</div><div class=\"line\">                             &#125;</div><div class=\"line\">                         &#125;</div><div class=\"line\">                         <span class=\"keyword\">if</span>(flag==<span class=\"number\">0</span>)<span class=\"comment\">//再在网络元素里查找</span></div><div class=\"line\">                         &#123;</div><div class=\"line\">                             <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> arr_webplayers)</div><div class=\"line\">                             &#123;</div><div class=\"line\">                                 <span class=\"keyword\">if</span>(arr_webplayers[key].meshname==arr[<span class=\"number\">14</span>])<span class=\"comment\">//如果与主控物体的meshname相同</span></div><div class=\"line\">                                 &#123;</div><div class=\"line\">                                     <span class=\"keyword\">var</span> obj_key=arr_webplayers[key];</div><div class=\"line\">                                     arr_webplayers[arr[<span class=\"number\">0</span>]] =  MyCloneplayer(obj_key,arr);</div><div class=\"line\">                                     shadowGenerator.getShadowMap().renderList.push(arr_webplayers[arr[<span class=\"number\">0</span>]].mesh);</div><div class=\"line\">                                     writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;addoldplayer: '</span> + arr[<span class=\"number\">0</span>] + <span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">                                     flag=<span class=\"number\">1</span>;</div><div class=\"line\">                                     <span class=\"keyword\">break</span>;</div><div class=\"line\">                                 &#125;</div><div class=\"line\">                             &#125;</div><div class=\"line\">                         &#125;</div><div class=\"line\">                         <span class=\"keyword\">if</span>(flag==<span class=\"number\">0</span>)<span class=\"comment\">//都没找着，就新建</span></div><div class=\"line\">                         &#123;</div><div class=\"line\">                             <span class=\"comment\">//arr[14]保存着meshname可以作为异步方法间的纽带,如果发生同时加载两个一样的不存在的mesh时，让后来的那个通过websocket延时重发</span></div><div class=\"line\">                             <span class=\"keyword\">if</span>(tempobj[arr[<span class=\"number\">14</span>]]&amp;amp;&amp;amp;tempobj[arr[<span class=\"number\">14</span>]]!=<span class=\"string\">\"OK\"</span>)<span class=\"comment\">//这个暂存位正在被占用</span></div><div class=\"line\">                             &#123;</div><div class=\"line\">                                 doSend(<span class=\"string\">\"privat:\"</span> + id + <span class=\"string\">\"#\"</span> + str_data);<span class=\"comment\">//请求websocket服务器再次把这个指令发给自己，以等待占用者完成操作</span></div><div class=\"line\">                             &#125;</div><div class=\"line\">                             <span class=\"keyword\">else</span></div><div class=\"line\">                             &#123;</div><div class=\"line\">                                 tempobj[arr[<span class=\"number\">14</span>]] = arr;</div><div class=\"line\">                                 BABYLON.SceneLoader.ImportMesh(arr[<span class=\"number\">11</span>], arr[<span class=\"number\">12</span>], arr[<span class=\"number\">13</span>], scene, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">newMeshes, particleSystems, skeletons</span>) </span>&#123;<span class=\"comment\">//载入完成的回调函数</span></div><div class=\"line\">                                     <span class=\"keyword\">var</span> Tom = <span class=\"keyword\">new</span> Player;</div><div class=\"line\">                                     <span class=\"keyword\">var</span> obj_p = &#123;&#125;;</div><div class=\"line\">                                     obj_p.mesh = newMeshes[<span class=\"number\">0</span>];<span class=\"comment\">//网格数据</span></div><div class=\"line\">                                     <span class=\"keyword\">var</span> arr = tempobj[obj_p.mesh.name];</div><div class=\"line\">                                     obj_p.scaling = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">2</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">3</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">4</span>]));<span class=\"comment\">//缩放</span></div><div class=\"line\">                                     obj_p.position = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">5</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">6</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">7</span>]));<span class=\"comment\">//位置</span></div><div class=\"line\">                                     obj_p.rotation = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">8</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">9</span>]), <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">10</span>]));<span class=\"comment\">// 旋转</span></div><div class=\"line\">                                     obj_p.checkCollisions = <span class=\"literal\">true</span>;<span class=\"comment\">//使用默认的碰撞检测</span></div><div class=\"line\">                                     obj_p.ellipsoid = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0.5</span>, <span class=\"number\">1</span>, <span class=\"number\">0.5</span>);<span class=\"comment\">//碰撞检测椭球</span></div><div class=\"line\">                                     obj_p.ellipsoidOffset = <span class=\"keyword\">new</span> BABYLON.Vector3(<span class=\"number\">0</span>, <span class=\"number\">2</span>, <span class=\"number\">0</span>);<span class=\"comment\">//碰撞检测椭球位移</span></div><div class=\"line\">                                     obj_p.skeletonsPlayer = skeletons;</div><div class=\"line\">                                     obj_p.methodofmove = <span class=\"string\">\"controlwitha\"</span>;</div><div class=\"line\">                                     obj_p.id = arr[<span class=\"number\">0</span>];</div><div class=\"line\">                                     obj_p.name = arr[<span class=\"number\">0</span>];</div><div class=\"line\">                                     obj_p.p1 = arr[<span class=\"number\">11</span>];</div><div class=\"line\">                                     obj_p.p2 = arr[<span class=\"number\">12</span>];</div><div class=\"line\">                                     obj_p.p3 = arr[<span class=\"number\">13</span>];</div><div class=\"line\">                                     <span class=\"keyword\">var</span> len=newMeshes.length;<span class=\"comment\">//对于复杂的模型来说newMeshes的其他部分也必须保存下来</span></div><div class=\"line\">                                     <span class=\"keyword\">var</span> arr=[];</div><div class=\"line\">                                     <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>;i&lt;len;i++)</div><div class=\"line\">                                     &#123;</div><div class=\"line\">                                         arr.push(newMeshes[i]);</div><div class=\"line\">                                     &#125;</div><div class=\"line\">                                     obj_p.submeshs=arr;</div><div class=\"line\">                                     Tom.init(</div><div class=\"line\">                                         obj_p</div><div class=\"line\">                                     );</div><div class=\"line\">                                     tempobj[obj_p.mesh.name] = <span class=\"string\">\"OK\"</span>;</div><div class=\"line\">                                     arr_webplayers[arr[<span class=\"number\">0</span>]] = Tom;</div><div class=\"line\">                                     shadowGenerator.getShadowMap().renderList.push(arr_webplayers[arr[<span class=\"number\">0</span>]].mesh);</div><div class=\"line\">                                     writeToScreen(<span class=\"string\">'&lt;span style=\"color: blue;\"&gt;addoldplayer: '</span> + arr[<span class=\"number\">0</span>] + <span class=\"string\">'&lt;/span&gt;'</span>);</div><div class=\"line\">                                     flag=<span class=\"number\">1</span>;</div><div class=\"line\"> </div><div class=\"line\">                                 &#125;);</div><div class=\"line\">                             &#125;</div><div class=\"line\">                         &#125;</div><div class=\"line\">                         <span class=\"keyword\">break</span>;</div><div class=\"line\">                     &#125;</div></pre></td></tr></table></figure>\n<p>　　这里的主要难点是如何处理多个异步的添加玩家请求，经过思考和实验部分的解决了问题。</p>\n<h4 id=\"b、多个客户端之间同步玩家的状态：\"><a href=\"#b、多个客户端之间同步玩家的状态：\" class=\"headerlink\" title=\"b、多个客户端之间同步玩家的状态：\"></a>b、多个客户端之间同步玩家的状态：</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">\"updatemesh\"</span>:</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        <span class=\"keyword\">var</span> dt=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</div><div class=\"line\">                        <span class=\"built_in\">console</span>.log(dt.getTime()+<span class=\"string\">\"get updatemesh\"</span>+arr[<span class=\"number\">0</span>]);</div><div class=\"line\">                        <span class=\"keyword\">var</span> obj = arr_webplayers[arr[<span class=\"number\">0</span>]];<span class=\"comment\">//从网络玩家列表里找到这个玩家</span></div><div class=\"line\">                        <span class=\"keyword\">if</span>(obj)</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">var</span> mesh = obj.mesh;</div><div class=\"line\">                            mesh.position.x = <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">2</span>]);<span class=\"comment\">//这里已经产生了位移效果！！</span></div><div class=\"line\">                            mesh.position.y = <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">3</span>]);</div><div class=\"line\">                            mesh.position.z = <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">4</span>]);</div><div class=\"line\">                            mesh.rotation.x = <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">5</span>]);</div><div class=\"line\">                            mesh.rotation.y = <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">6</span>]);</div><div class=\"line\">                            mesh.rotation.z = <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">7</span>]);</div><div class=\"line\">                           </div><div class=\"line\">                            obj.vmove.x=<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">8</span>]);</div><div class=\"line\">                            obj.vmove.y=<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">9</span>]);</div><div class=\"line\">                            obj.vmove.z=<span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">10</span>]);</div><div class=\"line\">                           </div><div class=\"line\">                            obj.rychange= <span class=\"built_in\">parseFloat</span>(arr[<span class=\"number\">11</span>]);</div><div class=\"line\">                            obj.countstop=<span class=\"number\">0</span>;<span class=\"comment\">//唤醒该物体的运动</span></div><div class=\"line\">                            <span class=\"keyword\">if</span>(obj.PlayAnnimation == <span class=\"literal\">false</span>&amp;amp;&amp;amp;(obj.vmove.x != <span class=\"number\">0</span> || obj.vmove.y != <span class=\"number\">0</span> || obj.vmove.z != <span class=\"number\">0</span> || obj.rychange != <span class=\"number\">0</span>))</div><div class=\"line\">                            &#123;</div><div class=\"line\">                                obj.PlayAnnimation = <span class=\"literal\">true</span>;</div><div class=\"line\">                                obj.beginSP(<span class=\"number\">0</span>);</div><div class=\"line\">                            &#125;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">break</span>;</div><div class=\"line\">                    &#125;</div></pre></td></tr></table></figure>\n<p>另一部分控制网络玩家的代码在<br>scene.registerBeforeRender（）中：<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key2 <span class=\"keyword\">in</span> arr_webplayers)<span class=\"comment\">//对于由其他客户端控制的物体</span></div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"keyword\">var</span> obj = arr_webplayers[key2];</div><div class=\"line\">                    <span class=\"keyword\">switch</span>(obj.methodofmove)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        <span class=\"keyword\">case</span> <span class=\"string\">\"controlwitha\"</span>:</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            obj.lab.rotation.y=(<span class=\"number\">-1.55</span> - cameraArcRotative[<span class=\"number\">0</span>].alpha)-obj.mesh.rotation.y;</div><div class=\"line\">                            <span class=\"keyword\">if</span>(obj.countstop&lt;=<span class=\"number\">4</span>)</div><div class=\"line\">                            &#123;</div><div class=\"line\">                                <span class=\"keyword\">if</span> ((obj.vmove.x != <span class=\"number\">0</span> || obj.vmove.y != <span class=\"number\">0</span> || obj.vmove.z != <span class=\"number\">0</span> || obj.rychange != <span class=\"number\">0</span>)&amp;amp;&amp;amp; obj.PlayAnnimation == <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">                                    obj.PlayAnnimation = <span class=\"literal\">true</span>;</div><div class=\"line\">                                    obj.beginSP(<span class=\"number\">0</span>);</div><div class=\"line\">                                    obj.mesh.moveWithCollisions(obj.vmove);</div><div class=\"line\">                                &#125;</div><div class=\"line\">                                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj.vmove.x == <span class=\"number\">0</span> &amp;amp;&amp;amp; obj.vmove.y == <span class=\"number\">0</span> &amp;amp;&amp;amp; obj.vmove.z == <span class=\"number\">0</span> &amp;amp;&amp;amp; obj.rychange == <span class=\"number\">0</span> &amp;amp;&amp;amp; obj.PlayAnnimation == <span class=\"literal\">true</span>) &#123;</div><div class=\"line\">                                    obj.countstop++;</div><div class=\"line\">                                    <span class=\"keyword\">if</span> (obj.countstop &gt; <span class=\"number\">4</span>)<span class=\"comment\">//连续4帧没有该对象的运动信息传过来，则该物体的运动计算进入休眠</span></div><div class=\"line\">                                    &#123;</div><div class=\"line\">                                        obj.PlayAnnimation = <span class=\"literal\">false</span>;</div><div class=\"line\">                                        obj.stopSP(<span class=\"number\">0</span>);</div><div class=\"line\">                                    &#125;</div><div class=\"line\">                                &#125;</div><div class=\"line\">                            &#125;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">default</span> :</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            <span class=\"keyword\">break</span>;</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div></pre></td></tr></table></figure></p>\n<h4 id=\"c、最后是对NPC物体运动同步的处理：\"><a href=\"#c、最后是对NPC物体运动同步的处理：\" class=\"headerlink\" title=\"c、最后是对NPC物体运动同步的处理：\"></a>c、最后是对NPC物体运动同步的处理：</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">\"[admins]\"</span>:</div><div class=\"line\">            &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span>(username==<span class=\"string\">\"admin\"</span>)</div><div class=\"line\">                &#123;<span class=\"comment\">//adminserver不处理admin广播</span></div><div class=\"line\"></div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">else</span></div><div class=\"line\">                &#123;</div><div class=\"line\">                    <span class=\"keyword\">if</span>(!scene.isReady() || !arr_myplayers)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        <span class=\"keyword\">return</span>;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                    <span class=\"keyword\">var</span> arr_rabbitmove=<span class=\"built_in\">JSON</span>.parse(str_data.substr(<span class=\"number\">8</span>));</div><div class=\"line\">                    <span class=\"keyword\">var</span> len=arr_rabbitmove.length;</div><div class=\"line\">                    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>;i&lt;len;i++)</div><div class=\"line\">                    &#123;</div><div class=\"line\">                        <span class=\"keyword\">var</span> arr=arr_rabbitmove[i];</div><div class=\"line\">                        <span class=\"keyword\">var</span> rabbit=arr_animals[arr[<span class=\"number\">0</span>]];</div><div class=\"line\">                        <span class=\"keyword\">var</span> rabbitmesh=rabbit.mesh;</div><div class=\"line\">                        rabbitmesh.position=arr[<span class=\"number\">1</span>];</div><div class=\"line\">                        rabbitmesh.rotation=arr[<span class=\"number\">2</span>];</div><div class=\"line\">                        rabbit.vmove=arr[<span class=\"number\">3</span>];</div><div class=\"line\">                        rabbit.rychange=arr[<span class=\"number\">4</span>];</div><div class=\"line\"></div><div class=\"line\">                        <span class=\"keyword\">if</span>(arr[<span class=\"number\">5</span>]==<span class=\"string\">\"run\"</span>&amp;amp;&amp;amp;rabbit.state==<span class=\"string\">\"eat\"</span>)</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            rabbit.state=<span class=\"string\">\"run\"</span>;</div><div class=\"line\">                            rabbit.powerofmove=<span class=\"number\">3</span>;</div><div class=\"line\">                            scene.beginAnimation(rabbitmesh.skeleton, <span class=\"number\">0</span>, <span class=\"number\">72</span>, <span class=\"literal\">true</span>, <span class=\"number\">2.4</span>);</div><div class=\"line\">                        &#125;</div><div class=\"line\">                        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(arr[<span class=\"number\">5</span>]==<span class=\"string\">\"eat\"</span>&amp;amp;&amp;amp;rabbit.state==<span class=\"string\">\"run\"</span>)</div><div class=\"line\">                        &#123;</div><div class=\"line\">                            rabbit.state=<span class=\"string\">\"eat\"</span>;</div><div class=\"line\">                            rabbit.powerofmove=<span class=\"number\">1</span>;</div><div class=\"line\">                            scene.beginAnimation(rabbitmesh.skeleton, <span class=\"number\">0</span>, <span class=\"number\">72</span>, <span class=\"literal\">true</span>, <span class=\"number\">0.8</span>);</div><div class=\"line\">                        &#125;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div></pre></td></tr></table></figure>\n<p>解开JSON，对每一个NPC物体分别处理。</p>\n<h2 id=\"五、部署和使用：\"><a href=\"#五、部署和使用：\" class=\"headerlink\" title=\"五、部署和使用：\"></a>五、部署和使用：</h2><p>程序完整代码在可以在<a href=\"https://github.com/ljzc002/WebGL2下载，我编写的代码基于MIT协议发布，使用的第三方库文件按其原有的发布协议发布。\" target=\"_blank\" rel=\"external\">https://github.com/ljzc002/WebGL2下载，我编写的代码基于MIT协议发布，使用的第三方库文件按其原有的发布协议发布。</a><br>部署：把PRACTICE/WebRoot/下的所有文件复制到PRACTICE3/目录下，将PRACTICE3/复制到Tomcat的WebApps/目录下，把PRACTICE3/改名为PRACTICE/，启动Tomcat，访问scene_link.html页面。<br>使用：第一个input输入Websocket所在IP，第二个input输入用户名（输入admin表示申请作为主机），点击“websocket连接”建立连接，点击“启动场景”启动WebGL场景。</p>\n<h2 id=\"六、写在后面的话：\"><a href=\"#六、写在后面的话：\" class=\"headerlink\" title=\"六、写在后面的话：\"></a>六、写在后面的话：</h2><p>限于时间和编程水平，程序中还有很多bug和缺陷，欢迎大家批评指正。<br>音乐、美术、文学等常规的人类自我表达方式都要求人不断的在很短的时间片内对事物产生足够充分的认识，非有过人之天赋与辛苦之训练而不可成就；相对而言编程可以通过分解、封装、复用将空间复杂度转化为时间复杂度，任何普通人经过努力都能有所收获。</p>\n"},{"title":"html5+jqueryMobile编写App推广注册页","url":"http://www.leonma.cn/2016/11/07/page67/","content":"<p>#html5+jqueryMobile编写App推广注册页<br> data-role=”page”、  data-role=”header” 、data-role=”content”、 data-role=”footer”,  为什么html5会增加这几个特征，我觉得多是为支持web版手机app开发而出的，因为html5提倡开发web版app只创建一个html页，然后每个段落=一个新页面，下面我贴一段几个div标签组合成的一个整体页面，当然它们都各自加了上面的特性。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"page\"表示这个是一个html5单独页面，可以从另外一个加了page特性的div打开它 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"header\"这个特性你想成APP的navigationbar --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"content\"内容里面展示页面内容的，必入你放一张表在这个标签里面展示 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"footer\"这个特性你想成APP的tabbar --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"page\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"phoneRegister\"</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"header\"这个特性你想成APP的navigationbar --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"header\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"heardId\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"content\"内容里面展示页面内容的，必入你放一张表在这个标签里面展示 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"content\"</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--data-role=\"footer\"这个特性你想成APP的tabbar --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"footer\"</span>&gt;</span> <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>##1. 首先html5标准页面申明，页面中的第一行代码与html4不一样,<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</span></div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</span></div></pre></td></tr></table></figure></p>\n<p>此标签的作用是告诉浏览器支持什么html规范。</p>\n<p>引入jquery和jquerymobile的支持库</p>\n<p>##2.引入jquery和jquerymobile的支持库<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0\"</span> /&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css\"</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://code.jquery.com/jquery-1.8.3.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"meta\">&lt;!DOCTYPE&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0\"</span> /&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Content-Type\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"text/html; charset=ISO-8859-1\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://code.jquery.com/jquery-1.8.3.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Insert title here<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"javascript\"></span></div><div class=\"line\"> $(<span class=\"built_in\">document</span>).on(<span class=\"string\">\"pagecreate\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">     <span class=\"keyword\">var</span> contentHeight = <span class=\"built_in\">document</span>.body.clientHeight;</div><div class=\"line\">     <span class=\"keyword\">var</span> header = contentHeight * <span class=\"number\">0.1</span>;</div><div class=\"line\">     <span class=\"keyword\">var</span> content = contentHeight * <span class=\"number\">0.75</span>;</div><div class=\"line\">     <span class=\"keyword\">var</span> footer = contentHeight * <span class=\"number\">0.15</span>;</div><div class=\"line\">     $(<span class=\"string\">\"#phoneRegister #heardId\"</span>).css(&#123; <span class=\"string\">'height'</span>: header + <span class=\"string\">'px'</span>, <span class=\"string\">'background'</span>: <span class=\"string\">'#4dbb49'</span>, <span class=\"string\">'line-height'</span>: header + <span class=\"string\">'px'</span> &#125;);</div><div class=\"line\">     $(<span class=\"string\">\"#phoneRegister #contentId\"</span>).css(&#123; <span class=\"string\">'height'</span>: content + <span class=\"string\">'px'</span> &#125;);</div><div class=\"line\">     $(<span class=\"string\">\"#phoneRegister #footerId\"</span>).css(&#123; <span class=\"string\">'height'</span>: footer + <span class=\"string\">'px'</span>, <span class=\"string\">' font-size'</span>: <span class=\"string\">'70px'</span>, <span class=\"string\">'line-height'</span>: footer + <span class=\"string\">'px'</span> &#125;);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> flag = <span class=\"literal\">false</span>;</div><div class=\"line\">    setInterval(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (flag == <span class=\"literal\">false</span>) &#123;</div><div class=\"line\">            $(<span class=\"string\">\"#presentGiftTitle\"</span>).css(&#123; <span class=\"string\">'color'</span>: <span class=\"string\">'rgb(255, 0, 0)'</span> &#125;);</div><div class=\"line\">            flag = <span class=\"literal\">true</span>;</div><div class=\"line\">            <span class=\"keyword\">return</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (flag == <span class=\"literal\">true</span>) &#123;</div><div class=\"line\">            $(<span class=\"string\">\"#presentGiftTitle\"</span>).css(&#123; <span class=\"string\">'color'</span>: <span class=\"string\">'rgb(255, 102, 0)'</span> &#125;);</div><div class=\"line\">             flag = <span class=\"literal\">false</span>;</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\">     &#125;, <span class=\"number\">100</span>);</div><div class=\"line\"> </div><div class=\"line\"> &#125;);</div><div class=\"line\"> <span class=\"comment\">//当页面初始化完毕后</span></div><div class=\"line\"> </div><div class=\"line\"> $(<span class=\"built_in\">document</span>).on(<span class=\"string\">\"pageshow\"</span>, <span class=\"string\">\"#commonRegister\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">// 当进入页面二时</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">var</span> contentHeight = <span class=\"built_in\">document</span>.body.clientHeight;</div><div class=\"line\">    <span class=\"keyword\">var</span> header = contentHeight * <span class=\"number\">0.1</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> content = contentHeight * <span class=\"number\">0.75</span>;</div><div class=\"line\">    <span class=\"keyword\">var</span> footer = contentHeight * <span class=\"number\">0.15</span>;</div><div class=\"line\"></div><div class=\"line\">    $(<span class=\"string\">\"#commonRegister #heardId\"</span>).css(&#123; <span class=\"string\">'height'</span>: header + <span class=\"string\">'px'</span>, <span class=\"string\">'background'</span>: <span class=\"string\">'#4dbb49'</span>, <span class=\"string\">'line-height'</span>: header + <span class=\"string\">'px'</span> &#125;);</div><div class=\"line\">    $(<span class=\"string\">\"#commonRegister #contentId\"</span>).css(&#123; <span class=\"string\">'height'</span>: content + <span class=\"string\">'px'</span> &#125;);</div><div class=\"line\">     $(<span class=\"string\">\"#commonRegister #footerId\"</span>).css(&#123; <span class=\"string\">'height'</span>: footer + <span class=\"string\">'px'</span>, <span class=\"string\">'font-size'</span>: <span class=\"string\">'70px'</span>, <span class=\"string\">'line-height'</span>: footer + <span class=\"string\">'px'</span> &#125;);</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> &#125;);</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">  </div><div class=\"line\"> $(<span class=\"built_in\">document</span>).on(<span class=\"string\">\"pageinit\"</span>, <span class=\"string\">\"#phoneRegister\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">     $(<span class=\"string\">\"#phoneRegisterClick\"</span>).on(<span class=\"string\">\"tap\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\"> </div><div class=\"line\">         <span class=\"keyword\">var</span> name = $(<span class=\"string\">\"#phoneRegister #name\"</span>).val();</div><div class=\"line\">         <span class=\"keyword\">var</span> password = $(<span class=\"string\">\"#phoneRegister #password\"</span>).val();</div><div class=\"line\"> </div><div class=\"line\">         <span class=\"keyword\">var</span> re = <span class=\"regexp\">/^(13[0-9]&#123;9&#125;)|(15[89][0-9]&#123;8&#125;)$/</span>;</div><div class=\"line\">         <span class=\"keyword\">if</span> (!re.test(name)) &#123;</div><div class=\"line\">             alert(<span class=\"string\">\"请输入正确的手机号!\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\">         <span class=\"keyword\">if</span> (password.length &lt; <span class=\"number\">6</span>) &#123;</div><div class=\"line\">             alert(<span class=\"string\">\"密码不能小于6位数\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\">         <span class=\"keyword\">var</span> checkBox = $(<span class=\"string\">\"#phoneRegister #Checkbox1\"</span>);</div><div class=\"line\">         <span class=\"keyword\">if</span> (!checkBox.is(<span class=\"string\">\":checked\"</span>)) &#123;</div><div class=\"line\">             alert(<span class=\"string\">\"请阅读条例!\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">         <span class=\"comment\">//开始发送手机验证</span></div><div class=\"line\"> </div><div class=\"line\">         alertVerifyCodeMethod();</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">     &#125;);</div><div class=\"line\"> &#125;);</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> $(<span class=\"built_in\">document</span>).on(<span class=\"string\">\"pageinit\"</span>, <span class=\"string\">\"#commonRegister\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">     $(<span class=\"string\">\"#commonRegisterClick\"</span>).on(<span class=\"string\">\"tap\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\"> </div><div class=\"line\">         <span class=\"keyword\">var</span> name = $(<span class=\"string\">\"#commonRegister #name\"</span>).val();</div><div class=\"line\">         <span class=\"keyword\">var</span> password = $(<span class=\"string\">\"#commonRegister #password\"</span>).val();</div><div class=\"line\">         <span class=\"keyword\">var</span> phonenumber = $(<span class=\"string\">\"#commonRegister #phoneNumber\"</span>).val();</div><div class=\"line\">         <span class=\"keyword\">var</span> safemail = $(<span class=\"string\">\"#commonRegister #safeMail\"</span>).val();</div><div class=\"line\"> </div><div class=\"line\">         <span class=\"keyword\">var</span> re = <span class=\"regexp\">/^(13[0-9]&#123;9&#125;)|(15[89][0-9]&#123;8&#125;)$/</span>;</div><div class=\"line\">         <span class=\"keyword\">var</span> mre = <span class=\"regexp\">/\\w@\\w*\\.\\w/</span>;</div><div class=\"line\">         <span class=\"keyword\">if</span> (name.length &lt; <span class=\"number\">6</span>) &#123;</div><div class=\"line\">             alert(<span class=\"string\">\"注册用户名不能小于6位数!\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\">         <span class=\"keyword\">if</span> (password.length &lt; <span class=\"number\">10</span>) &#123;</div><div class=\"line\"> </div><div class=\"line\">             alert(<span class=\"string\">\"密码不能小于10位数\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\">         <span class=\"keyword\">if</span> (!re.test(phonenumber)) &#123;</div><div class=\"line\"> </div><div class=\"line\">             alert(<span class=\"string\">\"请输入正确的手机号!\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\"> </div><div class=\"line\">         <span class=\"keyword\">if</span> (!mre.test(safemail)) &#123;</div><div class=\"line\">             alert(<span class=\"string\">\"请输入正确的邮箱!\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\"> </div><div class=\"line\">         <span class=\"keyword\">var</span> checkBox = $(<span class=\"string\">\"#commonRegister #Checkbox1\"</span>);</div><div class=\"line\">         <span class=\"keyword\">if</span> (!checkBox.is(<span class=\"string\">\":checked\"</span>)) &#123;</div><div class=\"line\">             alert(<span class=\"string\">\"请阅读条例!\"</span>)</div><div class=\"line\">             <span class=\"keyword\">return</span>;</div><div class=\"line\">         &#125;</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">         shareAjaxMethord(<span class=\"number\">0</span>, name, password, phonenumber, safemail);</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">     &#125;);</div><div class=\"line\"> &#125;);</div><div class=\"line\"> </div><div class=\"line\">  </div><div class=\"line\"> </div><div class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">alertVerifyCodeMethod</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\"> </div><div class=\"line\">     <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.all) &#123;</div><div class=\"line\">         <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"alertVerifyCodeBox\"</span>).click();</div><div class=\"line\">     &#125;</div><div class=\"line\">     <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">         <span class=\"keyword\">var</span> e = <span class=\"built_in\">document</span>.createEvent(<span class=\"string\">\"MouseEvents\"</span>);</div><div class=\"line\">         e.initEvent(<span class=\"string\">\"click\"</span>, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>);</div><div class=\"line\">         <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"alertVerifyCodeBox\"</span>).dispatchEvent(e);</div><div class=\"line\">     &#125;</div><div class=\"line\"> &#125;</div><div class=\"line\">  </div><div class=\"line\">  </div><div class=\"line\"> </div><div class=\"line\"> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">shareAjaxMethord</span>(<span class=\"params\">index, name, password, phone, email</span>) </span>&#123;</div><div class=\"line\"> </div><div class=\"line\">   </div><div class=\"line\">     $.ajax(&#123;</div><div class=\"line\">         type: <span class=\"string\">\"POST\"</span>,</div><div class=\"line\">         <span class=\"keyword\">async</span>: <span class=\"literal\">false</span>,</div><div class=\"line\">         dataType: <span class=\"string\">\"text\"</span>,</div><div class=\"line\">         data: <span class=\"string\">\"&amp;amp;sgin=\"</span> + index + <span class=\"string\">\"&amp;amp;name=\"</span> + name + <span class=\"string\">\"&amp;amp;password=\"</span> + password + <span class=\"string\">\"&amp;amp;phone=\"</span> + phone + <span class=\"string\">\"&amp;amp;email=\"</span> + email,</div><div class=\"line\">         url: <span class=\"string\">\"ajaxMediumPage.ashx\"</span>,</div><div class=\"line\">         success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">returnDate</span>) </span>&#123;</div><div class=\"line\"> </div><div class=\"line\">             <span class=\"keyword\">if</span> (index == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                 <span class=\"keyword\">if</span>(returnDate==<span class=\"string\">\"1\"</span>)</div><div class=\"line\">                 &#123;</div><div class=\"line\">                     alert(<span class=\"string\">\"注册成功!\"</span>);</div><div class=\"line\"> </div><div class=\"line\">                 &#125;</div><div class=\"line\">                 <span class=\"keyword\">else</span></div><div class=\"line\">                 &#123;</div><div class=\"line\">                     alert(<span class=\"string\">\"注册失败!\"</span>);</div><div class=\"line\">                 &#125;</div><div class=\"line\">             &#125;</div><div class=\"line\">             <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (inedx == <span class=\"number\">1</span>) &#123;</div><div class=\"line\"> </div><div class=\"line\">             &#125;</div><div class=\"line\">             <span class=\"keyword\">else</span> &#123;</div><div class=\"line\"> </div><div class=\"line\">             &#125;</div><div class=\"line\"> </div><div class=\"line\">         &#125;</div><div class=\"line\">     &#125;);</div><div class=\"line\"> &#125;</div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">     <span class=\"comment\">&lt;!-- 这个div data-role=\"page\"表明它是一个页面 --&gt;</span></div><div class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"page\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"phoneRegister\"</span>&gt;</span></div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"header\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"heardId\"</span>&gt;</span></div><div class=\"line\">         </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left:20px; font-size:17px;   font-weight:bold\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#pagetwo\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color:white; text-decoration:none;\"</span>&gt;</span>首页&gt;手机在线注册<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"content\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"contentId\"</span>&gt;</span></div><div class=\"line\">          </div><div class=\"line\"> </div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">\"posts\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                     <span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">h4</span> <span class=\"attr\">id</span>=<span class=\"string\">\"presentGiftTitle\"</span>&gt;</span>使用手机后注册后立刻赠送100乐币!<span class=\"tag\">&lt;/<span class=\"name\">h4</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             手机号:</div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入注册帐号!\"</span> /&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             密&amp;amp;nbsp;&amp;amp;nbsp;码:</div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入注册密码!\"</span> /&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left:-15px;\"</span>&gt;</span></div><div class=\"line\">                                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 20px;   height: 20px; float:left;  margin-top:5px;\"</span>&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"Checkbox1\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 18px; height: 18px;\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">220                                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left:40px;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">h5</span>&gt;</span>打勾注册表示你同意本公司的服务条例!<span class=\"tag\">&lt;/<span class=\"name\">h5</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                             <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-top:20px;\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"phoneRegisterClick\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"text-align: center; border: 1px solid #666666; background: #4dbb49; color: white; height: 30px; width: 100px; line-height: 30px; \"</span>&gt;</span>立即注册<span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#dialog\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"alertVerifyCodeBox\"</span> <span class=\"attr\">data-rel</span>=<span class=\"string\">\"dialog\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"display:none\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span>  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-top:20px;\"</span>&gt;</span></div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"float:right\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#commonRegister\"</span> <span class=\"attr\">data-transition</span>=<span class=\"string\">\"flip\"</span>&gt;</span>普通注册(非手机)<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                     <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                 <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">            </div><div class=\"line\">             </div><div class=\"line\"> </div><div class=\"line\">  </div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"footer\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"footerId\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background:#666666;\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:100%;height:90%;text-align:center;\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-size:13px; height:25%;text-decoration:none;margin-top:0px;padding-top:0px; line-height:16px;\"</span>&gt;</span>电话:400-900-8000<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-size: 13px; height: 25%; text-decoration:none;margin-top: 0px; padding-top: 0px; line-height:16px;\"</span>&gt;</span>渝ICP备000000-c号<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-size: 13px; height: 25%;text-decoration:none; margin-top: 0px; padding-top: 0px; line-height: 16px;\"</span>&gt;</span>版权所有<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">     </div><div class=\"line\">     </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> <span class=\"comment\">&lt;!-- 这个div data-role=\"page\"表明它是一个页面 --&gt;</span></div><div class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"page\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"commonRegister\"</span>&gt;</span></div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"header\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"heardId\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left:20px; font-size:17px;   font-weight:bold\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#pagetwo\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color:white; text-decoration:none;\"</span>&gt;</span>首页&gt;普通用户在线注册<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"content\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"contentId\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">  </div><div class=\"line\"> </div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">id</span>=<span class=\"string\">\"posts\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                     <span class=\"tag\">&lt;<span class=\"name\">article</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             帐 号:</div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入注册帐号!\"</span> /&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             密&amp;amp;nbsp;&amp;amp;nbsp;码:</div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入注册密码!\"</span> /&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             手机号:</div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"phoneNumber\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入手机号!\"</span> /&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             安全邮箱:</div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"safeMail\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入安全邮箱!\"</span> /&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left:-15px;\"</span>&gt;</span></div><div class=\"line\">                                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 20px;   height: 20px; float:left;  margin-top:5px;\"</span>&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"Checkbox1\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 18px; height: 18px;\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">311                                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left:40px;\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">h5</span>&gt;</span>打勾注册表示你同意本公司的服务条例!<span class=\"tag\">&lt;/<span class=\"name\">h5</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">aside</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-top:20px;\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"commonRegisterClick\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"text-align:center;border:1px solid #666666; background:#4dbb49;color:white;height:30px;width:100px; line-height:30px;\"</span>&gt;</span>立即注册 <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">aside</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-top:20px;\"</span>&gt;</span></div><div class=\"line\">                             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"float:right\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#phoneRegister\"</span> <span class=\"attr\">data-transition</span>=<span class=\"string\">\"flip\"</span>&gt;</span>手机注册(手机号)<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                         <span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                     <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></div><div class=\"line\">                     <span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></div><div class=\"line\">                     </div><div class=\"line\">                   </div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"footer\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"footerId\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background:#666666;\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:100%;height:90%;text-align:center;\"</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-size:13px; height:25%;text-decoration:none;margin-top:0px;padding-top:0px; line-height:16px;\"</span>&gt;</span>电话:400-900-8000<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-size: 13px; height: 25%;text-decoration:none; margin-top: 0px; padding-top: 0px; line-height:16px;\"</span>&gt;</span>渝ICP备000000-c号<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">style</span>=<span class=\"string\">\"font-size: 13px; height: 25%;text-decoration:none; margin-top: 0px; padding-top: 0px; line-height: 16px;\"</span>&gt;</span>版权所有<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">  </div><div class=\"line\">    </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"page\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dialog\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"padding-top:auto\"</span>&gt;</span></div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"header\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"heardId\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background:#4dbb49\"</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>输入验证码<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"content\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"contentId\"</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">                验证码:</div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">id</span>=<span class=\"string\">\"verifyCode\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入验证码!\"</span> /&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">                 <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"inputVerifyCodeDiv\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 100px; height: 30px; background: #4dbb49; color:white; line-height:30px; float:right; text-align:center\"</span>&gt;</span>确 定<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">             <span class=\"tag\">&lt;/<span class=\"name\">aside</span>&gt;</span></div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">data-role</span>=<span class=\"string\">\"footer\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"footerId\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background:#4dbb49\"</span>&gt;</span></div><div class=\"line\">             <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></div><div class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\"> </div><div class=\"line\"> </div><div class=\"line\">    </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>上面的代码直接copy到一个html页面可以运行。</p>\n"},{"title":"H5分栏（第一章）","url":"http://www.leonma.cn/2016/11/07/page65/","content":"<p>#H5分栏（第一章）</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.w3.org/1999/xhtml\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span> <span class=\"attr\">runat</span>=<span class=\"string\">\"server\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Content-Type\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"text/html; charset=utf-8\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>页面结构<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\">        header, nav, article, footer &#123;</div><div class=\"line\">            border: solid 1px #666;</div><div class=\"line\">            padding: 5px;</div><div class=\"line\">        &#125;         header &#123;</div><div class=\"line\">            width: 500px;</div><div class=\"line\">        &#125;         nav &#123;</div><div class=\"line\">            float: left;</div><div class=\"line\">            width: 60px;</div><div class=\"line\">            height: 100px;</div><div class=\"line\">        &#125;         article &#123;</div><div class=\"line\">            float: left;</div><div class=\"line\">            width: 428px;</div><div class=\"line\">            height: 100px;</div><div class=\"line\">        &#125;         footer &#123;</div><div class=\"line\">            clear: both;</div><div class=\"line\">            width: 500px;</div><div class=\"line\">        &#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></div><div class=\"line\">        header 头部部分</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">nav</span>&gt;</span></div><div class=\"line\">        nav 菜单导航说明部分</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">nav</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">article</span>&gt;</span></div><div class=\"line\">        article 内容说明部分</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">article</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">footer</span>&gt;</span></div><div class=\"line\">        footer  底部说明部分</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">footer</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>普通html 分栏<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.w3.org/1999/xhtml\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span> <span class=\"attr\">runat</span>=<span class=\"string\">\"server\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Content-Type\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"text/html; charset=utf-8\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>html页面结构<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"xml\"></span></div><div class=\"line\">        #header, #nav, #article, #footer &#123;</div><div class=\"line\">            border: solid 1px #666;</div><div class=\"line\">            padding: 5px;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span> <span class=\"attr\">runat</span>=<span class=\"string\">\"server\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Content-Type\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"text/html; charset=utf-8\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>html页面结构<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\">        #header, #nav, #article, #footer &#123;</div><div class=\"line\">            border: solid 1px #666;</div><div class=\"line\">            padding: 5px;</div><div class=\"line\">        &#125;        #header &#123;</div><div class=\"line\">            width: 500px;</div><div class=\"line\">        &#125;</div><div class=\"line\">        /*左边菜单*/</div><div class=\"line\">        #nav &#123;</div><div class=\"line\">            float: left;</div><div class=\"line\">            width: 60px;</div><div class=\"line\">            height: 100px;</div><div class=\"line\">        &#125;</div><div class=\"line\">        /*右边菜单*/</div><div class=\"line\">        #article &#123;</div><div class=\"line\">            float: left;</div><div class=\"line\">            width: 428px;</div><div class=\"line\">            height: 100px;</div><div class=\"line\">        &#125;</div><div class=\"line\">    </div><div class=\"line\">            width: 500px;</div><div class=\"line\">        &#125;</div><div class=\"line\">        /*左边菜单*/</div><div class=\"line\">        #nav &#123;</div><div class=\"line\">            float: left;</div><div class=\"line\">            width: 60px;</div><div class=\"line\">            height: 100px;</div><div class=\"line\">        &#125;</div><div class=\"line\">        /*右边菜单*/</div><div class=\"line\">        #article &#123;</div><div class=\"line\">            float: left;</div><div class=\"line\">            width: 428px;</div><div class=\"line\">            height: 100px;</div><div class=\"line\">        &#125;        #footer &#123;</div><div class=\"line\">            clear: both;</div><div class=\"line\">            width: 500px;</div><div class=\"line\">        &#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"header\"</span>&gt;</span></div><div class=\"line\">        导航部分</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"nav\"</span>&gt;</span></div><div class=\"line\">        左边内容</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"article\"</span>&gt;</span></div><div class=\"line\">        右边内容</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"footer\"</span>&gt;</span></div><div class=\"line\">        底部</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    </div><div class=\"line\">            clear: both;</div><div class=\"line\">            width: 500px;</div><div class=\"line\">        &#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"header\"</span>&gt;</span></div><div class=\"line\">        导航部分</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"nav\"</span>&gt;</span></div><div class=\"line\">        左边内容</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"article\"</span>&gt;</span></div><div class=\"line\">        右边内容</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"footer\"</span>&gt;</span></div><div class=\"line\">        底部</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n"},{"title":"遍历节点树","url":"http://www.leonma.cn/2016/11/07/page57/","content":"<p>#遍历节点树<br>从以下属性读出来的信息可以让我们了解相邻节点之间的关系。</p>\n<p>childNodes属性将返回一个数组，这个数组由给定元素节点的子节点构成：</p>\n<p>nodeList = node.childNodes<br>这个属性返回的数组是一个nodeList集合。这个nodeList集合里的每个节点都是一个节点对象。这些节点对象都有着nodeType、nodeName、nodeValue等常见的节点属性。<br>文本节点和属性节点都不可能包含任何的子节点，所以他们的childNodes属性永远返回一个空数组。<br>　　如果只是想知道某个元素有没有子节点，可以使用hasChildNodes方法。<br>　　如果想知道某个元素有多少个节点，请使用childNodes数组的length属性：</p>\n<p>node.childNodes.length<br>即使元素只有一个子节点，childNodes属性也将返回一个节点数组而不是返回一个单个的节点，此时，childNodes数组的length的长度值将是1，比如说，如果某个网页上的document元素只有html元素这个子节点，那么document.childNodes[0].nodeName值将是HTML。<br>childNodes属性是一个只读属性，如果需要给某个元素增加子节点，可以使用appendChild()或insertBefore()方法；如果需要删除某个元素节点，可以使用removeChild()方法；在使用这几个方法曾、减某个元素子节点时，这个元素childNodes属性也将自动刷新。</p>\n<p>firstChild</p>\n<p>reference = node.firstChild<br>这个属性返回一个节点对象的引用指针，这个节点对象有nodeType、nodeName、nodeValue等常见属性。<br>文本节点和属性节点不可能在包含任何的子节点，所以他们的firstChild属性永远会返回null。<br>firstChild是一个只读属性。</p>\n<p>lastChild<br>lastChild：属性将返回一个给定元素的最后一个子节点：</p>\n<p>reference = node.lastChild<br>这个属性返回一个节点对熊引用指针，这个节点对象都有着nodeType、nodeName、nodeValue等常见节点属性。<br>文本节点属性和属性节点属性都不可能在包含任何子节点，所以lastChild属性永远返回null。<br>某个元素的lastChild属性等价于元素childNodes节点集合的最后一个节点：</p>\n<p>refrence = node.childNodes[element.childNodes.lelgth-1]<br>如果想知道某个元素有没有子节点，可以使用hasChildNodes方法，如果某个节点没有任何子节点，它的lastChild属性将返回null。<br>lastChild属性是一个只读属性。</p>\n<p>nextSibing<br>nextSibing属性将返回一个给定节点的下一个子节点：</p>\n<p>reference = node.nextSibing<br>这个属性返回一个节点对象引用指针，这个节点对象都有着nodeType、nodeName、nodeValue等常见属性。<br>如果给定节点后面没有同属于父节点的节点，它的nextSibling属性将返回null。<br>nextSibling属性是一个只读属性。</p>\n<p>parentNode<br>parentNode属性将返回一个给定节点的父节点：</p>\n<p>reference = node.parentNode<br>这个属性返回一个节点对象的引用指针，这个节点对象都有着nodeType、nodeName、nodeValue等常见节点属性。<br>parentNode属性返回的节点永远是一个元素节点，因为只有元素节点才有可能包含子节点，唯一的例外是document节点，他没有父节点，换句话说，document节点的parentNode属性将返回null。<br>parentNode属性是一个只读属性。</p>\n<p>previousSibling</p>\n<p>reference  = node.previousSibling<br>这个属性返回前一个节点对象的引用指针，这个节点对象都有着nodeType、nodeName、nodeValue等常见节点属性。<br>　　如果没有前一个元素节点返回null。<br>　　previousSibling属性是一个只读属性。</p>\n"},{"title":"HTML5大数据可视化效果（二）可交互地铁线路图","url":"http://www.leonma.cn/2016/11/07/HTML5大数据可视化效果-二-可交互地铁线路图/","content":"<p>#HTML5大数据可视化效果（二）可交互地铁线路图</p>\n<p><a href=\"http://www.cnblogs.com/twaver/p/4547924.html\" target=\"_blank\" rel=\"external\">HTML5大数据可视化效果</a><br>”系列，以示鼓励（P.S. 其实还挺有压力的，后浪推前浪，新人赶旧人。我们这些老鸟也得注意，免得让00后给抢了饭碗）</p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103121614533-2062155906.jpg\" alt=\"picture\"><br><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103121656721-376610979.jpg\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103121921361-1178958456.gif\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103122154049-1255275872.gif\" alt=\"picture\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">twaver.Util.registerImage(<span class=\"string\">'station'</span>,&#123;     </div><div class=\"line\">\tw: linkWidth*<span class=\"number\">1.6</span>,     </div><div class=\"line\">\th: linkWidth*<span class=\"number\">1.6</span>,     </div><div class=\"line\">\tv: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data, view</span>) </span>&#123;         </div><div class=\"line\">\t\t<span class=\"keyword\">var</span> result = [];         </div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(data.getClient(<span class=\"string\">'focus'</span>))&#123;             </div><div class=\"line\">\t\t\tresult.push(&#123;                 </div><div class=\"line\">\t\t\t\tshape: <span class=\"string\">'circle'</span>,                 </div><div class=\"line\">\t\t\t\tr: linkWidth*<span class=\"number\">0.7</span>,                 </div><div class=\"line\">\t\t\t\tlineColor:  data.getClient(<span class=\"string\">'lineColor'</span>),                 </div><div class=\"line\">\t\t\t\tlineWidth: linkWidth*<span class=\"number\">0.2</span>,                 </div><div class=\"line\">\t\t\t\tfill: <span class=\"string\">'white'</span>,             </div><div class=\"line\">\t\t\t&#125;);             </div><div class=\"line\">\t\t\tresult.push(&#123;                 </div><div class=\"line\">\t\t\t\tshape: <span class=\"string\">'circle'</span>,                 </div><div class=\"line\">\t\t\t\tr: linkWidth*<span class=\"number\">0.2</span>,                 </div><div class=\"line\">\t\t\t\tfill:  data.getClient(<span class=\"string\">'lineColor'</span>),             </div><div class=\"line\">\t\t\t&#125;);         </div><div class=\"line\">\t\t&#125;<span class=\"keyword\">else</span>&#123;             </div><div class=\"line\">\t\t\tresult.push(&#123;                 </div><div class=\"line\">\t\t\t\tshape: <span class=\"string\">'circle'</span>,                 </div><div class=\"line\">\t\t\t\tr: linkWidth*<span class=\"number\">0.6</span>,                 </div><div class=\"line\">\t\t\t\tlineColor: data.getClient(<span class=\"string\">'lineColor'</span>),                 </div><div class=\"line\">\t\t\t\tlineWidth: linkWidth*<span class=\"number\">0.2</span>,                 </div><div class=\"line\">\t\t\t\tfill: <span class=\"string\">'white'</span>,             </div><div class=\"line\">\t\t\t&#125;);         </div><div class=\"line\">\t\t&#125;         </div><div class=\"line\">\t<span class=\"keyword\">return</span> result;     </div><div class=\"line\">&#125; &#125;);</div></pre></td></tr></table></figure>\n<p> 来看代码：</p>\n<p>###1. 代码1<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">twaver.Util.registerImage(<span class=\"string\">'rotateArrow'</span>, &#123; </div><div class=\"line\">w: <span class=\"number\">124</span>, </div><div class=\"line\">h: <span class=\"number\">124</span>, </div><div class=\"line\">v: [&#123; </div><div class=\"line\">    shape: <span class=\"string\">'vector'</span>, </div><div class=\"line\">    name: <span class=\"string\">'doubleArrow'</span>, </div><div class=\"line\">    rotate: <span class=\"number\">360</span>, </div><div class=\"line\">    animate: [&#123; </div><div class=\"line\">        attr: <span class=\"string\">'rotate'</span>, </div><div class=\"line\">          to: <span class=\"number\">0</span>, </div><div class=\"line\">          dur: <span class=\"number\">2000</span>, </div><div class=\"line\">          reverse: <span class=\"literal\">false</span>, </div><div class=\"line\">          repeat: <span class=\"built_in\">Number</span>.POSITIVE_INFINITY </div><div class=\"line\">      &#125;] </div><div class=\"line\">  &#125;] </div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure></p>\n<pre><code>另外，在单击和双击站点时，还实现了selected和loading的动画效果，值得点赞！\n![picture](http://images2015.cnblogs.com/blog/311983/201611/311983-20161103141545565-2010504104.gif)\n![picture](http://images2015.cnblogs.com/blog/311983/201611/311983-20161103141605065-1237423734.gif)\n</code></pre><p>​<br>​<br>       <img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103141731096-1466288424.gif\" alt=\"picture\"></p>\n<p>​       </p>\n<p>###2. 代码2<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">network.setZoomManager(<span class=\"keyword\">new</span> twaver.vector.MixedZoomManager(network)); </div><div class=\"line\">network.setMinZoom(<span class=\"number\">0.2</span>); </div><div class=\"line\">network.setMaxZoom(<span class=\"number\">3</span>); </div><div class=\"line\">network.setZoomVisibilityThresholds(&#123; </div><div class=\"line\">    label : <span class=\"number\">0.6</span>, <span class=\"number\">6.</span>    &#125;);</div></pre></td></tr></table></figure></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103141931643-856207231.gif\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103143834486-1796262740.gif\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103143940158-1173344247.gif\" alt=\"picture\"></p>\n<p>来鉴赏下小弟的成果。</p>\n<p>数据结构，按照站点、线路、杂项三大块来组织，结构清晰，利于遍历、查询等操作。</p>\n<p>###3. 代码3<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">&#123; </div><div class=\"line\">   \"stations\":&#123; </div><div class=\"line\">       \"l01s01\":&#123; &#125;, </div><div class=\"line\">       ………… </div><div class=\"line\">   &#125; </div><div class=\"line\">   \"lines\":&#123; </div><div class=\"line\">       \"l01\":&#123;……&#125;, </div><div class=\"line\">       ………… </div><div class=\"line\">   &#125; </div><div class=\"line\">     \"sundrys\":&#123; </div><div class=\"line\">         \"railwaystationshanghai\":&#123;……&#125;, </div><div class=\"line\">         ………… </div><div class=\"line\">     &#125; </div><div class=\"line\"> &#125;</div></pre></td></tr></table></figure></p>\n<p>###4. 代码4<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">\"l01s01\":&#123; </div><div class=\"line\">      \"id\":\"l01s01\", </div><div class=\"line\">          \"name\":\"莘庄\", </div><div class=\"line\">          \"loc\":&#123;\"x\":419,\"y\":1330&#125;, </div><div class=\"line\">          \"label\":\"bottomright.bottomright\", </div><div class=\"line\">      &#125;,</div></pre></td></tr></table></figure></p>\n<p>###5. 代码5<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loadJSON</span>(<span class=\"params\">path,callback</span>)</span>&#123; <span class=\"number\">2.</span>        <span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest(); <span class=\"number\">3.</span>        xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"number\">4.</span>            <span class=\"keyword\">if</span> (xhr.readyState === <span class=\"number\">4</span>) &#123; <span class=\"number\">5.</span>                <span class=\"keyword\">if</span> (xhr.status === <span class=\"number\">200</span>) &#123; <span class=\"number\">6.</span>                   dataJson = <span class=\"built_in\">JSON</span>.parse(xhr.responseText); <span class=\"number\">7.</span>                   callback &amp;amp;&amp;amp; callback(); <span class=\"number\">8.</span>               &#125; <span class=\"number\">9.</span>           &#125; <span class=\"number\">10.</span>       &#125;; <span class=\"number\">11.</span>       xhr.open(<span class=\"string\">\"GET\"</span>, path, <span class=\"literal\">true</span>); <span class=\"number\">12.</span>       xhr.send(); <span class=\"number\">13.</span>    &#125;</div></pre></td></tr></table></figure></p>\n<p>###6. 代码6<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>)</span>&#123; </div><div class=\"line\">loadJSON(<span class=\"string\">\"shanghaiMetro.json\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </div><div class=\"line\">        initNetwork(dataJson); </div><div class=\"line\">        initNode(dataJson); </div><div class=\"line\">    &#125;); </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>###7. 代码7<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span>(staId <span class=\"keyword\">in</span> json.stations)&#123; </div><div class=\"line\"><span class=\"keyword\">var</span> station = json.stations[staId]; </div><div class=\"line\">staNode = <span class=\"keyword\">new</span> twaver.Node(&#123; </div><div class=\"line\">    id: staId, </div><div class=\"line\">    name: station.name, </div><div class=\"line\">    image:<span class=\"string\">'station'</span>, </div><div class=\"line\">&#125;); </div><div class=\"line\">staNode.s(<span class=\"string\">'label.color'</span>,<span class=\"string\">'rgba(99,99,99,1)'</span>); </div><div class=\"line\">staNode.s(<span class=\"string\">'label.font'</span>,<span class=\"string\">'12px 微软雅黑'</span>); </div><div class=\"line\"> staNode.s(<span class=\"string\">'label.position'</span>,station.label); </div><div class=\"line\"> staNode.setClient(<span class=\"string\">'location'</span>,station.loc); </div><div class=\"line\"> box.add(staNode); <span class=\"number\">13.</span>    &#125;</div></pre></td></tr></table></figure></p>\n<p>###8. 代码8<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">for</span>(lineId <span class=\"keyword\">in</span> json.lines) &#123; </div><div class=\"line\">   &amp;hellip;&amp;hellip; </div><div class=\"line\">   <span class=\"keyword\">for</span>(staSn <span class=\"keyword\">in</span> line.stations) &#123;</div><div class=\"line\">       &amp;hellip;&amp;hellip; </div><div class=\"line\">       <span class=\"keyword\">var</span> link = <span class=\"keyword\">new</span> twaver.Link(linkId,prevSta,staNode); </div><div class=\"line\">       link.s(<span class=\"string\">'link.color'</span>, line.color); </div><div class=\"line\">       link.s(<span class=\"string\">'link.width'</span>, linkWidth);</div><div class=\"line\">       link.setToolTip(line.name); </div><div class=\"line\">       box.add(link); </div><div class=\"line\">    &#125; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>最后再加入图标，一张原始的地铁图就呈现出来了。<br><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103144715205-1780446914.png\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103144816315-1456837843.png\" alt=\"picture\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> createTurnSta = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">line, staSn</span>)</span>&#123;     staTurn = <span class=\"keyword\">new</span> twaver.Node(staSn);     staTurn.setImage();     staTurn.setClient(<span class=\"string\">'lineColor'</span>,line.color);     staTurn.setClient(<span class=\"string\">'lines'</span>,[line.id]);     <span class=\"keyword\">var</span> loc = line.stations[staSn];     staTurn.setClient(<span class=\"string\">'location'</span>,loc);     box.add(staTurn);     <span class=\"keyword\">return</span> staTurn; &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> createFollowSta = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">json, line, staNode, staId</span>)</span>&#123;     staFollow = <span class=\"keyword\">new</span> twaver.Follower(staId);     staFollow.setImage();     staFollow.setClient(<span class=\"string\">'lineColor'</span>,line.color);     staFollow.setClient(<span class=\"string\">'lines'</span>,[line.id]);     staFollow.setHost(staNode);     <span class=\"keyword\">var</span> az = azimuth[staId.substr(<span class=\"number\">6</span>,<span class=\"number\">2</span>)];     <span class=\"keyword\">var</span> loc0 = json.stations[staId.substr(<span class=\"number\">0</span>,<span class=\"number\">6</span>)].loc;     <span class=\"keyword\">var</span> loc = &#123;x:loc0.x+az.x, y:loc0.y+az.y&#125;;     staFollow.setClient(<span class=\"string\">'location'</span>,loc);     box.add(staFollow);     <span class=\"keyword\">return</span> staFollow; &#125;</div></pre></td></tr></table></figure>\n<p><img src=\"http://images2015.cnblogs.com/blog/311983/201611/311983-20161103144955643-1549309486.png\" alt=\"picture\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> azimuth = &#123;     bb: &#123;x: <span class=\"number\">0</span>, y: linkWidth*zoom/<span class=\"number\">2</span>&#125;,     tt: &#123;x: <span class=\"number\">0</span>, y: -linkWidth*zoom/<span class=\"number\">2</span>&#125;,     rr: &#123;x: linkWidth*zoom/<span class=\"number\">2</span>, y: <span class=\"number\">0</span>&#125;,     ll: &#123;x: -linkWidth/<span class=\"number\">2</span>, y: <span class=\"number\">0</span>&#125;,     br: &#123;x: linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>, y: linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>&#125;,     bl: &#123;x: -linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>, y: linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>&#125;,     tr: &#123;x: linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>, y: -linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>&#125;,     tl: &#123;x: -linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>, y: -linkWidth*zoom*<span class=\"number\">0.7</span>/<span class=\"number\">2</span>&#125;,     BB: &#123;x: <span class=\"number\">0</span>, y: linkWidth*zoom&#125;,     TT: &#123;x: <span class=\"number\">0</span>, y: -linkWidth*zoom&#125;,     RR: &#123;x: linkWidth*zoom, y: <span class=\"number\">0</span>&#125;,     LL: &#123;x: -linkWidth, y: <span class=\"number\">0</span>&#125;,     BR: &#123;x: linkWidth*zoom*<span class=\"number\">0.7</span>, y: linkWidth*zoom*<span class=\"number\">0.7</span>&#125;,     BL: &#123;x: -linkWidth*zoom*<span class=\"number\">0.7</span>, y: linkWidth*zoom*<span class=\"number\">0.7</span>&#125;,     TR: &#123;x: linkWidth*zoom*<span class=\"number\">0.7</span>, y: -linkWidth*zoom*<span class=\"number\">0.7</span>&#125;,     TL: &#123;x: -linkWidth*zoom*<span class=\"number\">0.7</span>, y: -linkWidth*zoom*<span class=\"number\">0.7</span>&#125; &#125;;</div></pre></td></tr></table></figure>\n<p>最后，想要看程序，或者想玩“地铁拖拖乐”的各位，都可以给我留言和发邮件：tw-service@servasoft.com。</p>\n"},{"title":"让IE9以下版本的浏览支持html5,CSS3的插件","url":"http://www.leonma.cn/2016/11/07/让IE9以下版本的浏览支持html5-CSS3的插件/","content":"<p>#让IE9以下版本的浏览支持html5,CSS3的插件<br>　　随着html5(后面用h5代表)标签越来越广泛的使用，IE不识别h5标签的问题让人很是烦恼。<br>　　在火狐和chrome之类的浏览器中，遇到不认识的标签，只要给个display:block属性，就能让这个元素成为一个类似div的元素，但是到IE上就很恶心了，它不认识就是不认识，你在html和css里添加什么它都不理你。<br>　　没什么什么问题是万能的程序猿解决不了的，其实要让IE识别一个自定义的标签(IE认为h5的标签是陌生的，不合法的)<br>　　<br>html5–html5shiv.js插件下载　　<br>css3–selectivizr-min.js插件下载　　以上两个插件常在项目中运用较多。在html页面中的&lt;head&gt;标签里面插入下载好的js文件，页面就可以正常添加html5元素了，css3样式</p>\n"},{"title":"Picasso ganchuanpu","url":"http://www.leonma.cn/2016/11/07/Picasso-ganchuanpu/","content":"<p>#Picasso ganchuanpu<br>Picasso是Square公司出品的一个强大的图片下载和缓存图片库<br>1）在adapter中需要取消已经不在视野范围的ImageView图片资源的加载，否则会导致图片错位，Picasso已经解决了这个问题。<br>2）使用复杂的图片压缩转换来尽可能的减少内存消耗<br>3）自带内存和硬盘二级缓存功能</p>\n<p>1）在adapter中需要取消已经不在视野范围的ImageView图片资源的加载，否则会导致图片错位，Picasso已经解决了这个问题。<br>2）使用复杂的图片压缩转换来尽可能的减少内存消耗<br>3）自带内存和硬盘二级缓存功能&nbsp;<br><img src=\"http://images2015.cnblogs.com/blog/1044471/201611/1044471-20161103222330440-1256902303.png\" alt=\"picture\"><br>①普通加载图片</p>\n<p>Picasso.with(PicassoActivity.this)<br>　　　　.load(“<a href=\"http://n.sinaimg.cn/translate/20160819/9BpA-fxvcsrn8627957.jpg\" target=\"_blank\" rel=\"external\">http://n.sinaimg.cn/translate/20160819/9BpA-fxvcsrn8627957.jpg</a>“)<br>　　　　.into(ivPicassoResult1);</p>\n<p>②裁剪的方式加载图片</p>\n<p>Picasso.with(PicassoActivity.this)<br>　　　　.load(“<a href=\"http://n.sinaimg.cn/translate/20160819/9BpA-fxvcsrn8627957.jpg\" target=\"_blank\" rel=\"external\">http://n.sinaimg.cn/translate/20160819/9BpA-fxvcsrn8627957.jpg</a>“)<br>　　　　.resize(100,100)<br>　　　　.into(ivPicassoResult1);　　<br>③选择180度</p>\n<p>Picasso.with(PicassoActivity.this)<br>　　　　.load(“<a href=\"http://n.sinaimg.cn/translate/20160819/9BpA-fxvcsrn8627957.jpg\" target=\"_blank\" rel=\"external\">http://n.sinaimg.cn/translate/20160819/9BpA-fxvcsrn8627957.jpg</a>“)<br>　　　　.rotate(180)<br>　　　　.into(ivPicassoResult1);</p>\n<p>资源加载的方法 - placeholder(xxx). 设置资源加载过程中的显示的Drawable。</p>\n<pre><code>- error(xxx).设置load失败时显示的Drawable。\n- into(xxx) 设置资源加载到的目标 包括ImageView Target等\n\n- error(xxx).设置load失败时显示的Drawable。\n- into(xxx) 设置资源加载到的目标 包括ImageView Target等eg:Adapter中getView()方法中\n</code></pre><p>// 加载图片<br>Picasso.with(mContext) .load(Constants.IMAGES[position]) .placeholder(R.drawable.atguigu_logo) .error(R.drawable.atguigu_logo) .into(holder.iv);</p>\n<p>&nbsp;<br><img src=\"http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif\" alt=\"picture\"><br><img src=\"http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif\" alt=\"picture\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PicassoUtil</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//加载本地图片</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, <span class=\"keyword\">int</span> resId, ImageView imgView)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(resId)</div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .fit()</div><div class=\"line\">                .into(imgView);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//按照一定的宽高加载本地图片，带有加载错误和默认图片</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context,<span class=\"keyword\">int</span> resId,ImageView imgView,<span class=\"keyword\">int</span> weight,<span class=\"keyword\">int</span> height)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(resId)<span class=\"comment\">//加载本地图片</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .resize(weight,height)<span class=\"comment\">//设置图片的宽高</span></div><div class=\"line\">                .into(imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//加载网络图片到imgview,带有加载错误和默认图片</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, String imgurl, <span class=\"keyword\">int</span> resId, ImageView imgView)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(imgurl)<span class=\"comment\">//加载网络图片的url</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .placeholder(resId)<span class=\"comment\">//默认图片</span></div><div class=\"line\">                .error(resId)<span class=\"comment\">//加载错误的图片</span></div><div class=\"line\">                .fit()<span class=\"comment\">//图片的宽高等于控件的宽高</span></div><div class=\"line\">                .into(imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, String imgurl, ImageView imgView)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(imgurl)<span class=\"comment\">//加载网络图片的url</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .fit()<span class=\"comment\">//图片的宽高等于控件的宽高</span></div><div class=\"line\">                .into(imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//加载网络图片到Viewpager</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, String imgurl, ViewPager imgView)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(imgurl)<span class=\"comment\">//加载网络图片的url</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .fit()<span class=\"comment\">//图片的宽高等于控件的宽高</span></div><div class=\"line\">                .into((Target) imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//加载网络图片到Viewpager，带有加载错误和默认图片</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, String imgurl, <span class=\"keyword\">int</span> resId, ViewPager imgView)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(imgurl)<span class=\"comment\">//加载网络图片的url</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .placeholder(resId)<span class=\"comment\">//默认图片</span></div><div class=\"line\">                .error(resId)<span class=\"comment\">//加载错误的图片</span></div><div class=\"line\">                .fit()<span class=\"comment\">//图片的宽高等于控件的宽高</span></div><div class=\"line\">                .into((Target) imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//按照设定的宽高加载网络图片到imgview</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, String imgurl,ImageView imgView,<span class=\"keyword\">int</span> weight,<span class=\"keyword\">int</span> height)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(imgurl)<span class=\"comment\">//加载网络图片的url</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .resize(weight,height)<span class=\"comment\">//设置图片的宽高</span></div><div class=\"line\">                .into(imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//按照设定的宽高加载网络图片到imgview，带有加载错误和默认图片</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setImg</span><span class=\"params\">(Context context, String imgurl, <span class=\"keyword\">int</span> resId,<span class=\"keyword\">int</span> weight,<span class=\"keyword\">int</span> height, ImageView imgView)</span></span>&#123;</div><div class=\"line\">        Picasso.with(context)</div><div class=\"line\">                .load(imgurl)<span class=\"comment\">//加载网络图片的url</span></div><div class=\"line\">                .config(Bitmap.Config.RGB_565)<span class=\"comment\">//8位RGB位图</span></div><div class=\"line\">                .placeholder(resId)<span class=\"comment\">//默认图片</span></div><div class=\"line\">                .error(resId)<span class=\"comment\">//加载错误的图片</span></div><div class=\"line\">                .resize(weight,height)<span class=\"comment\">//设置图片的宽高</span></div><div class=\"line\">                .into(imgView);<span class=\"comment\">//把图片加载到控件上</span></div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>PicassoUtil<br><img src=\"http://images2015.cnblogs.com/blog/1044471/201611/1044471-20161103225834799-284883798.png\" alt=\"picture\"><br>在module的gradle中添加转换库:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">dependencies &#123;</div><div class=\"line\"> \tcompile <span class=\"string\">'jp.wasabeef:picasso-transformations:2.1.0'</span></div><div class=\"line\">    <span class=\"comment\">// If you want to use the GPU Filters</span></div><div class=\"line\">    compile <span class=\"string\">'jp.co.cyberagent.android.gpuimage:gpuimage-library:1.4.1'</span></div><div class=\"line\">&#125; repositories &#123;</div><div class=\"line\">    jcenter()</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>Activity中:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">List&amp;lt;String&amp;gt; data = <span class=\"keyword\">new</span> ArrayList&amp;lt;&amp;gt;();</div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i&amp;lt;= <span class=\"number\">36</span>; i++)&#123; data.add(i+<span class=\"string\">\"\"</span>);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">// 初始化listview</span></div><div class=\"line\">PicassoTransformationsAdapter picassoTransformationsAdapter = <span class=\"keyword\">new</span> PicassoTransformationsAdapter(PicassoTransfromationsActivity.<span class=\"keyword\">this</span>,data);</div><div class=\"line\">lvPicassoTransfromations.setAdapter(picassoTransformationsAdapter);</div></pre></td></tr></table></figure></p>\n<p>PicassoListviewAdapter：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PicassoTransformationsAdapter</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAdapter</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> Context mContext;</div><div class=\"line\">    <span class=\"keyword\">private</span> List&amp;lt;String&amp;gt; mData;     <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">PicassoTransformationsAdapter</span><span class=\"params\">(Context context, List&amp;lt;String&amp;gt; data)</span> </span>&#123;</div><div class=\"line\">        mContext = context;</div><div class=\"line\">        mData = data;</div><div class=\"line\">    &#125;     <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getCount</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mData == <span class=\"keyword\">null</span> ? <span class=\"number\">0</span> : mData.size();</div><div class=\"line\">    &#125;     <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getItem</span><span class=\"params\">(<span class=\"keyword\">int</span> position)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;     <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getItemId</span><span class=\"params\">(<span class=\"keyword\">int</span> position)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">    &#125;     <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">getView</span><span class=\"params\">(<span class=\"keyword\">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;         ViewHolder holder;</div><div class=\"line\">        <span class=\"keyword\">if</span>(convertView == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            convertView = View.inflate(mContext, R.layout.item_picasso_transformations,<span class=\"keyword\">null</span>);             holder = <span class=\"keyword\">new</span> ViewHolder(convertView);             convertView.setTag(holder);</div><div class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            holder = (ViewHolder) convertView.getTag();</div><div class=\"line\">        &#125;         <span class=\"comment\">// 显示名称</span></div><div class=\"line\">        holder.name.setText(<span class=\"string\">\"item\"</span>+(position + <span class=\"number\">1</span>));         <span class=\"keyword\">int</span> integer = Integer.parseInt(mData.get(position));         <span class=\"keyword\">switch</span> (integer) &#123;             <span class=\"keyword\">case</span> <span class=\"number\">1</span>: &#123;</div><div class=\"line\">                <span class=\"keyword\">int</span> width = Utils.dip2px(mContext, <span class=\"number\">133.33f</span>);</div><div class=\"line\">                <span class=\"keyword\">int</span> height = Utils.dip2px(mContext, <span class=\"number\">126.33f</span>);</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .resize(width, height)</div><div class=\"line\">                        .centerCrop()</div><div class=\"line\">                        .transform((<span class=\"keyword\">new</span> MaskTransformation(mContext, R.drawable.mask_starfish)))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>: &#123;</div><div class=\"line\">                <span class=\"keyword\">int</span> width = Utils.dip2px(mContext, <span class=\"number\">150.0f</span>);</div><div class=\"line\">                <span class=\"keyword\">int</span> height = Utils.dip2px(mContext, <span class=\"number\">100.0f</span>);</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .resize(width, height)</div><div class=\"line\">                        .centerCrop()</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> MaskTransformation(mContext, R.drawable.chat_me_mask))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.LEFT,</div><div class=\"line\">                                CropTransformation.GravityVertical.TOP))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</div><div class=\"line\">                Picasso.with(mContext).load(R.drawable.demo)</div><div class=\"line\">                        <span class=\"comment\">// 300, 100, CropTransformation.GravityHorizontal.LEFT, CropTransformation.GravityVertical.CENTER))</span></div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>)).into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">5</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.LEFT,</div><div class=\"line\">                                CropTransformation.GravityVertical.BOTTOM))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">6</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.TOP))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">7</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">8</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.BOTTOM))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">9</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.RIGHT,</div><div class=\"line\">                                CropTransformation.GravityVertical.TOP))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">10</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.RIGHT,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">11</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">300</span>, <span class=\"number\">100</span>, CropTransformation.GravityHorizontal.RIGHT,</div><div class=\"line\">                                CropTransformation.GravityVertical.BOTTOM))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">12</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation((<span class=\"keyword\">float</span>) <span class=\"number\">16</span> / (<span class=\"keyword\">float</span>) <span class=\"number\">9</span>,</div><div class=\"line\">                                CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">13</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation((<span class=\"keyword\">float</span>) <span class=\"number\">4</span> / (<span class=\"keyword\">float</span>) <span class=\"number\">3</span>,</div><div class=\"line\">                                CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">14</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">3</span>, CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">15</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">3</span>, CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.TOP))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">16</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation(<span class=\"number\">1</span>, CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">17</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation((<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>, (<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>,</div><div class=\"line\">                                CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">18</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation((<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>, (<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>,</div><div class=\"line\">                                CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.TOP))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">19</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation((<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>, (<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>,</div><div class=\"line\">                                CropTransformation.GravityHorizontal.RIGHT,</div><div class=\"line\">                                CropTransformation.GravityVertical.BOTTOM))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">20</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropTransformation((<span class=\"keyword\">float</span>) <span class=\"number\">0.5</span>, <span class=\"number\">0</span>, (<span class=\"keyword\">float</span>) <span class=\"number\">4</span> / (<span class=\"keyword\">float</span>) <span class=\"number\">3</span>,</div><div class=\"line\">                                CropTransformation.GravityHorizontal.CENTER,</div><div class=\"line\">                                CropTransformation.GravityVertical.CENTER))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">21</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropSquareTransformation())</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">22</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> CropCircleTransformation())</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">23</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> ColorFilterTransformation(Color.argb(<span class=\"number\">80</span>, <span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>)))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">24</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> GrayscaleTransformation())</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">25</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> RoundedCornersTransformation(<span class=\"number\">30</span>, <span class=\"number\">0</span>,</div><div class=\"line\">                                RoundedCornersTransformation.CornerType.BOTTOM_LEFT))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">26</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> BlurTransformation(mContext, <span class=\"number\">25</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">27</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.demo)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> ToonFilterTransformation(mContext))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">28</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> SepiaFilterTransformation(mContext))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">29</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> ContrastFilterTransformation(mContext, <span class=\"number\">2.0f</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">30</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> InvertFilterTransformation(mContext))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">31</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> PixelationFilterTransformation(mContext, <span class=\"number\">20</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">32</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> SketchFilterTransformation(mContext))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">33</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> SwirlFilterTransformation(mContext, <span class=\"number\">0.5f</span>, <span class=\"number\">1.0f</span>, <span class=\"keyword\">new</span> PointF(<span class=\"number\">0.5f</span>, <span class=\"number\">0.5f</span>)))</div><div class=\"line\">                        .into(holder.image);                 <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">34</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> BrightnessFilterTransformation(mContext, <span class=\"number\">0.5f</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">35</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> KuwaharaFilterTransformation(mContext, <span class=\"number\">25</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">36</span>:</div><div class=\"line\">                Picasso.with(mContext)</div><div class=\"line\">                        .load(R.drawable.check)</div><div class=\"line\">                        .transform(<span class=\"keyword\">new</span> VignetteFilterTransformation(mContext, <span class=\"keyword\">new</span> PointF(<span class=\"number\">0.5f</span>, <span class=\"number\">0.5f</span>),</div><div class=\"line\">                                <span class=\"keyword\">new</span> <span class=\"keyword\">float</span>[]&#123;<span class=\"number\">0.0f</span>, <span class=\"number\">0.0f</span>, <span class=\"number\">0.0f</span>&#125;, <span class=\"number\">0f</span>, <span class=\"number\">0.75f</span>))</div><div class=\"line\">                        .into(holder.image);</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">return</span> convertView;</div><div class=\"line\">    &#125;     <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewHolder</span></span>&#123;         <span class=\"meta\">@Bind</span>(R.id.iv_picasso)</div><div class=\"line\">        ImageView image;         <span class=\"meta\">@Bind</span>(R.id.tv_picasso)</div><div class=\"line\">        TextView name;         <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ViewHolder</span><span class=\"params\">(View view)</span> </span>&#123;             ButterKnife.bind(<span class=\"keyword\">this</span>, view);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"},{"title":"React实例入门教程(1)基础API,JSX语法","url":"http://www.leonma.cn/2016/11/07/React实例入门教程-1-基础API-JSX语法/","content":"<p>#React实例入门教程(1)基础API,JSX语法<br>　　毫无疑问，react是目前最最热门的框架(没有之一)，了解并学习使用React，可以说是现在每个前端工程师都需要的。<br>　　在前端领域，一个框架为何会如此之火爆，无外乎两个原因：性能优秀，开发效率高。React当然集成了这两大优点。<br>　　这要归功于React的两大特点，也是该框架一直强调的优势：<br>　　1.虚拟dom与dom diff：在React中，一切的更新都是先更新虚拟dom，再根据react自带的dom diff 算法，进行对比计算，在实际dom中实现最小粒度的更新，这就是React性能优秀的原因了！<br>　　2.一切皆是组件：React强调一切皆是组件，那么组件就是React的核心元素，在使用React开发时，开发人员会对各种颗粒进行组件化开发，自然而然的提升了代码复用度，提升了开发效率。<br>　　本系列文章，每篇都会有个小实例，带领大家一步步的走进React开发的世界。<br>　　<br>文章预告　　　本系列文章分为<br>　　React实例入门教程(1)基础API,JSX语法–hello world<br>　　React实例入门教程(2)组件与组件的生命周期–弹窗组件<br>　　React实例入门教程(3)数据流之props与state–实时更新的倒计时组件<br>　　React实例入门教程(4)事件处理–事件丰富的swipe组件<br>　　React实例入门教程(5)总结–咪咕阅读首页开发实战<br>　　　　　　　　　　　　　　　　　　　　　　　　　<br>LET’S START　　作为本系列教程的第一篇，按照国际惯例，我们先从HELLO WORLD 开始~，那么先看看本例的代码吧：<br>　　<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span>; </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>hello world<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"react.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"react-dom.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"browser.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"demo\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>     </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/babel\"</span>&gt;</span><span class=\"javascript\">         </span></div><div class=\"line\">\t\t\t<span class=\"keyword\">var</span> Helloworld = React.createClass(&#123; </div><div class=\"line\">\t\t\t\trender:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;  </div><div class=\"line\">            \t\t<span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello world<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;             &#125;         \t\t\t&#125;);</div><div class=\"line\">              ReactDOM.render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Helloworld</span>/&gt;</span></span>,<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"demo\"</span>)); </div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span> </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>　　以上代码需要注意：最后的<script>标签type是&ldquo;text/babel&rdquo;。因为React使用的是JSX语法，他与传统js语法不兼容，所以type要选择babel。<br>　　最开始引入的js中，react和react-dom是react基础库，而browser.js是用来线上分析JSX语法的，真实项目上线中并不会引用这个，而是再上线前进行编译（使用工具babel等）转换成传统js语法再上线。（因为browser线上编译很影响性能）。为了方便大家的学习，现在这里直接引入了该js。<br>从上面示例代码可以看到，我们使用一些API，这些API都是非常基础的，下面我来做简单的介绍：<br>从上面示例代码可以看到，我们使用一些API，这些API都是非常基础的，下面我来做简单的介绍：　　<br>React.createClass:　　　　前言里说到react一切皆是组件，那么React.createClass就是最基本的创建组件的方法，它的第一个传入参数是json对象，代表组件的主体，该json其中，有必带的和可选择的参数，其必带参数为render，类型是函数要求返回该组件的模版。<br>　　使用方式可见篇头示例，具体细节会在后续组件章节中做介绍。<br>　　<br>ReactDOM.render:　　ReactDOM.render 是 React 的最基本方法，用于将模板(html，jsx,React.createElement等)转为 HTML ，并插入指定的 DOM 节点。<br>　　看下面的示例代码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"> 　ReactDOM.render(<span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>HELLO,REACT!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span>,document.getElementById(\"example\"));</div></pre></td></tr></table></figure>\n<p>　　就是将一段html结构输出到id为example浏览器，效果如下：<br><img src=\"http://images2015.cnblogs.com/blog/354376/201611/354376-20161102150429518-2077470571.png\" alt=\"picture\"><br>&nbsp;<br>　　JSX即JavaScript XML，即一种在React内部构建的标签语法，React不使用JSX一样可以工作，但是使用JSX可以让代码简洁，提高代码可读性，因此推荐使用：<br>　　那么，我们来看看对比，前面示例代码中，使用了JSX语法的语句为：<br> <Helloword/> 　　如果不使用JSX语法将变成：<br> React.createElement(“Helloword”,{},””); 　　可见JSX语法的优势。<br>　　那么让我们来学习JSX语法：<br>　　JSX和HTML很像，但却不同于HTML，JSX中标签名可以是HTML标签，也可以是自己定义的组件，如前面示例中的Helloworld组件。那么我们来具体看看JSX与HTML的不同处和需要注意的地方：<br>　　<br>属性引用：　　<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"some-id\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"some-class\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color:red;\"</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>JSX ：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"someId\"</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;someClass&#125;</span> <span class=\"attr\">style</span>=<span class=\"string\">&#123;&#123;color:red&#125;&#125;</span>&gt;</span>...<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>　　如上示例所示，JSX语法中，属性的引入拥有HTML的方式（文本直接赋值）；也可以引用JS变量（如：someClass）,方式是使用大括号包裹，其中要注意的是，class在JSX中要写成className，style的 赋值要写成json的引入 ，如上例。<br>　　<br>条件判断：　　在JSX标签的属性中，我们可以使用条件判断来根据条件生成JSX，JSX允许的条件判断方式是，三目运算符，逻辑与(&amp;&amp;)运算符，使用变量，使用函数。<br>　　看面的示例代码：<br>　　给出一个函数：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">function getNumber()&#123; 　return Math.floor(Math.random()*100); &#125; 　　对应JSX片段：</div><div class=\"line\">　　<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">className</span>=<span class=\"string\">&#123;this.state.num</span>&gt;</span>1?\"demo1\":\"demo2\"&#125; &gt;&#123;getNumber()&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> 　　这段jsx 会根据this.state.num值来选择对应的class，并随机生成数字来填充内容。</div></pre></td></tr></table></figure></p>\n<p>事件绑定JSX中，和HTML事件绑定类似，对应的事件名称为onClick,onChange等：<br>JSX中，和HTML事件绑定类似，对应的事件名称为onClick,onChange等： 　　<div onClick={this.handleClick}>…</div> 　　<br>特殊用法　　数组引入：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">var jsxArr = [<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>,<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>,<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>,<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>]; ReactDOM.render(<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;jsxArr&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>,...);  输出的结果等同于 ReactDOM.render(<span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>,...);</div></pre></td></tr></table></figure></p>\n<p>JSX可以根据数组直接遍历产出JSX结构　　<br>循环遍历：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">var demos= ['demo1', 'demo2', 'demo3']; ReactDOM.render(   <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>   &#123;     demos.map(function (demo) &#123;       return <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello, &#123;demo&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>     &#125;)   &#125;   <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>,...);</div></pre></td></tr></table></figure></p>\n<p>产出的结果为：<br> Hello，demo1！ Hello，demo2！ Hello，demo3！  你看懂了么~</p>\n<p>以上就是对React 基础API，和 JSX语法的介绍讲解了，那么回头看看最初的示例代码，是不是已经了解如何使用了呢？</p>\n</script></p>"},{"title":"多列布局","url":"http://www.leonma.cn/2016/11/07/多列布局/","content":"<p>#多列布局<br><img src=\"http://images2015.cnblogs.com/blog/601779/201611/601779-20161101135733565-636633711.png\" alt=\"picture\"><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>两列布局<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span>&gt;</span><span class=\"undefined\"></span></div><div class=\"line\">\t\t\thtml,body,.body,.main,.side&#123; </div><div class=\"line\">\t\t\t\tmargin: 0;</div><div class=\"line\">\t\t\t\tpadding: 0;         </div><div class=\"line\">\t\t\t\theight: 100%;     </div><div class=\"line\">\t\t\t&#125;     </div><div class=\"line\">\t\t\t.body&#123;         </div><div class=\"line\">\t\t\t\twidth: 960px;         </div><div class=\"line\">\t\t\t\tmargin: 0 auto;     </div><div class=\"line\">\t\t\t&#125;     </div><div class=\"line\">\t\t\t.main&#123;         </div><div class=\"line\">\t\t\t\tbackground-color: pink;     </div><div class=\"line\">\t\t\t&#125;     </div><div class=\"line\">\t\t\t.side&#123;         </div><div class=\"line\">\t\t\t\tbackground-color: #bebebe;     </div><div class=\"line\">\t\t\t&#125;          </div><div class=\"line\">\t\t\t.main&#123;         </div><div class=\"line\">\t\t\t\tfloat: left;         </div><div class=\"line\">\t\t\t\twidth: 660px;     </div><div class=\"line\">\t\t\t&#125;    </div><div class=\"line\">\t\t\t.side&#123;         </div><div class=\"line\">\t\t\t\tfloat: right;         </div><div class=\"line\">\t\t\t\twidth: 300px;     </div><div class=\"line\">\t\t\t&#125;          </div><div class=\"line\">\t\t\t.clearfix:after&#123;         </div><div class=\"line\">\t\t\t\tcontent: '.';         </div><div class=\"line\">\t\t\t\tdisplay: block;         </div><div class=\"line\">\t\t\t\tclear: both;         </div><div class=\"line\">\t\t\t\theight: 0;         </div><div class=\"line\">\t\t\t\toverflow: hidden;         </div><div class=\"line\">\t\t\t\tvisibility: hidden;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"body clearfix\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"side\"</span>&gt;</span>side<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"main\"</span>&gt;</span>main<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/601779/201611/601779-20161101135742221-1300447152.png\" alt=\"picture\"><br>main向 左浮动 ，side向右浮动。<br>main定宽660px, side定宽300px<br>在main和side 元素的父元素上加 ，用来『清除浮动』，这样后续的元素就不会受到 main和side『浮动动作』的影响。</p>\n<p><img src=\"http://images2015.cnblogs.com/blog/601779/201611/601779-20161101135808908-1524079312.png\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/601779/201611/601779-20161101135813236-465393938.png\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/601779/201611/601779-20161101135822174-977319174.png\" alt=\"picture\"></p>\n<p><img src=\"http://images2015.cnblogs.com/blog/601779/201611/601779-20161101135915783-1710233814.png\" alt=\"picture\"></p>\n<blockquote>\n<p>css float 属性介绍：<br><a href=\"http://www.w3school.com.cn/css/css_positioning_floating.asp\" target=\"_blank\" rel=\"external\">http://www.w3school.com.cn/css/css_positioning_floating.asp</a><br>如果你使用 chrome浏览器，这里推荐给你一个浏览器插件(用于查看div 分布情况)<br><a href=\"https://chrome.google.com/webstore/detail/div-density/akhjnfacldhnbhkpmhebkfocmheaicif?hl=zh-CN\" target=\"_blank\" rel=\"external\">Div Density</a></p>\n</blockquote>\n"},{"title":"你不知道山里的故事","url":"http://www.leonma.cn/2016/08/31/你不知道山里的故事/","content":"<p><img src=\"http://ockhcbepk.bkt.clouddn.com/2016-08-30%20001927.png?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"HomeTone1\"></p>\n<blockquote>\n<p>日子在不同的空间流逝，思念在不同的时间来临。</p>\n</blockquote>\n<h1 id=\"家乡、煤炭和一个传说\"><a href=\"#家乡、煤炭和一个传说\" class=\"headerlink\" title=\"家乡、煤炭和一个传说\"></a>家乡、煤炭和一个传说</h1><p>　　我的家乡位于宁夏北部，贺兰山北段腹地，一个名叫“汝箕沟”的地方。<br>汝箕沟盛产煤炭，它出产的煤炭都有一个统一而好听的名字，叫做“太西乌金”。<br>汝箕沟的盛名是从一个有关獐子的传说开始的……</p>\n<p>　　传说很久以前，有位农夫赶着一头小毛驴，进山驮炭，走着走着，迷失了方向，走来走去走乏了，便躺在一块石板上打盹儿。朦胧中，见一只獐子慌张地跑来，钻进了他的毛线口袋里，说：“大哥别声张，请帮帮忙。”农夫感到非常稀奇，还没等他弄明白是怎么回事，两个猎人已经追过来了。猎人问农夫： “老弟，一只獐子从前边跑过来，你看见没有？”农夫想，救生要紧，就指着远处的山沟对猎人说：“刚刚向那边跑去了。”猎人信以为真，便顺着农夫所指的方向追去。猎人离去，獐子爬出口袋对农夫说：“你要我帮什么忙吗？”。迷失方向的大哥，农夫便把自己驮炭的情况向獐子讲了。獐子二话没说，爬到坡下，用爪子刨呀刨呀……不到吃一顿饭的工夫，刨了簸箕大的一个深洞。接着，獐子用嘴从洞里叼出一块块亮晶晶的煤炭。农夫一见，连忙装了满满一口袋，高高兴兴地驮回家去。<br>　　从此以后，他经过来这儿驮炭，临来时还带一个簸箕端炭用。后来人们都问他：“这么好的炭你是从哪儿驮来的？”他不知山沟叫什么名字，只知道那个挖煤的洞，能擩（Ru）进去一个簸箕，“擩箕沟。”以后人们便随口说： 经过多年口传，就把出干炭的山沟叫汝箕沟了。</p>\n<p><img src=\"http://ockhcbepk.bkt.clouddn.com/2016-08-30%20001835.png?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"煤矿\"></p>\n<h1 id=\"煤矿\"><a href=\"#煤矿\" class=\"headerlink\" title=\"煤矿\"></a>煤矿</h1><p>　　汝箕沟煤炭开采活动最早可追溯到清朝道光九年（公元一八二一年），迄今已有一百八十多年的历史。解放前建有私营德昌煤矿，宁夏解放后，改称宁夏新华第一煤矿，一九五二年改制为地方国营宁夏第一煤矿，一九五四年九月正式命名为汝箕沟煤矿，二00二年十二月加入宁夏煤业集团有限责任公司。为响应集团公司跨域式发展，汝箕沟煤矿从井工转型露天开采，将人员分批次，整建制的向银南各厂矿进行输送，2013年7月15日矿区的人们陆续离开了养育他们这片土地。</p>\n<p><img src=\"http://ockhcbepk.bkt.clouddn.com/2016-08-30%20001600.png?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"我长大的地方\"></p>\n<h1 id=\"我长大的地方\"><a href=\"#我长大的地方\" class=\"headerlink\" title=\"我长大的地方\"></a>我长大的地方</h1><blockquote>\n<p>小时候，只觉得汝箕沟是世界上最美 最大的地方，长大了，走的地方多了，才知道汝箕沟其实很小很闭塞。</p>\n</blockquote>\n<p>　　这就是我长大的地方，她四面皆山，一块小盆地，山是由颗颗巨石天然聚垒而成，只有那些零零落落长在山缝里低矮的山桃笏树，在春天里发芽，在夏天开花，在秋天里结果，为这茫茫群山增加一抹绿色。小盆地上住人，干涸缺水，居民生活用水都是架管从外面引进来，还限时限量，一些散落的住户到定点的地方拎着桶肩挑手提，还有的用人力独轮车，车上专门固定着一个铁皮焊牢的水箱，一家人一步步艰难的沿着盘山路向家的方向跋涉。</p>\n<p><img src=\"http://ockhcbepk.bkt.clouddn.com/2016-08-30%20002108.png?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"童年的回忆\"></p>\n<h1 id=\"童年的回忆\"><a href=\"#童年的回忆\" class=\"headerlink\" title=\"童年的回忆\"></a>童年的回忆</h1><p>　　汝箕沟那一条通往外面的路，蜿蜒盘旋、曲折迂回在山腰爬行延伸，小时候第一次出山，我的手紧紧抓着前座椅背，眼睛一刻不离盯着车窗外似乎摇摇欲坠高悬的石块，真害怕一声响雷就会震落下来砸向我的头部，车子来回颠簸，忽左忽右，瞬间九十度的急转弯，车上的人东摇西晃，瘦小的我身子离开了座位，不知不觉汗水从鬓角流出，坐一次车，如同玩了一会过山车，彷佛经历了一场惊心动魄的生死劫难，后来坐的次数多了，也就安心了。对父辈常年生活在如此环境下心生怜悯和敬重。<br>　　生活在这里的人们，都是刚刚脱离了面朝黄土背朝天的农民矿工，善良、朴实、勤快、乐观，邻里之间相处的非常融洽和睦。这里的女人把当矿工的丈夫当做天，丈夫上班前她们就早早围着灶台做着他爱吃的饭菜，丈夫上班后，各家的女人聚在一家唠嗑，眼睛却不时盯着表，算计着丈夫下班，等时间差不多了，一个个像燕雀般纷纷逃离，只要丈夫的脚步声响起，原本寂静的小院不时传来欢声笑语，围着丈夫展开了锅碗瓢盆交响曲，各家飘出的不同菜香味在夕阳下的微风里弥漫、飘散，久久回荡，传承着老婆孩子热炕头的古训。<br>　　<br><img src=\"http://ockhcbepk.bkt.clouddn.com/2016-08-30%20000629.jpg?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"童年的回忆\"></p>\n<h1 id=\"记忆中的地方\"><a href=\"#记忆中的地方\" class=\"headerlink\" title=\"记忆中的地方\"></a>记忆中的地方</h1><p>　　站在山头上看，那些房屋错落无序、凌乱不一。那些墙面斑驳陈旧的老屋，常常出现在陡峭的绝壁下，上去的路只有一条仅容一人蜿蜒曲折的小路，这样的平房如果在平地修建可谓小菜一碟，可在如此绝壁下诞生，一砖一瓦、一石一木是怎样搬运上去的？每次看到这样的房屋，对房屋的主人充满了钦佩和敬重，我佩服汝箕沟人的那种对家的眷念和执着，只要有家，只要有爱，不管绝壁陡峭，还是深山旷野，一样鲜花开放，春意暖人。<br>　　干旱缺水的山谷，每到夏季，山洪就是突如其来的猛虎，有时晴空万里的天空瞬间乌云密布，紧接着一声近似一声的炸雷在天空响起，天空像炸裂了一个缺口，顷刻间豆大的雨点瓢泼似的从天上倒下来，整个矿区呈现在汪洋大海中，随着急剧的溪流，山上的石头也落荒而下，雨水冲击着石头一路高歌猛进横冲直撞肆无忌惮，所到之处房屋墙倒、沟渠填埋，道路冲毁，车辆被毁，山洪侵袭的矿区残垣断壁，狼藉一片，人们的惊呼声、哭喊声、谩骂声和车辆鸣笛声交织在一起响成一片。雨后初晴，倒塌的房屋重新修建，填埋的防洪沟挖的更深更宽，冲毁的路面一点点恢复正常，勇敢的汝箕沟人与恶劣的自然环境作斗争。</p>\n<h1 id=\"山珍野味\"><a href=\"#山珍野味\" class=\"headerlink\" title=\"山珍野味\"></a>山珍野味</h1><p><img src=\"http://ockhcbepk.bkt.clouddn.com/mashroom.jpg?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"山珍野味\"><br>　　<br>　　环境恶劣的地方往往出产绝美的物品，汝箕沟的深山老林里就有一种山货——<a href=\"http://news.ifeng.com/a/20140813/41564490_0.shtml\" target=\"_blank\" rel=\"external\">蘑菇</a>，这种天然蘑菇和羊肉做成的臊子面鲜美味浓，意犹深远无与伦比，市场上很难买到。每到这个时候，山里人骚动了，三五成群结伙到深山采蘑菇，需要十几个小时翻山越岭艰难跋涉，找到松树林繁密的地方就找到了蘑菇，那些常年凋落的松叶覆盖在潮湿的地面上，为蘑菇创造了诞生的温床，找到一个蘑菇，你就在周围瞅，一个、一簇簇、一片片就会呈现在你眼前，难怪有人说；蘑菇如同人类，都是沾亲带故，找到一个就是一片。也有不识路的后生跑单帮在食品缺失、体力不支救援无助的情况下坠崖身亡。在那沟壑纵深、峰峦叠嶂的深山里，偶尔还能看到三五只结对的青羊仓皇逃跑，也能见到从未见过的鸟，这些游人就像来犯者，惊扰了它们安静的生活。等这些跋涉者背负着沉甸甸的战果回到家时，汝箕沟的一条街沸腾了，热闹了，街道两边摆满了新采的蘑菇，夹杂着潮湿的泥土，各个肥硕圆滑润泽，吸引着不少外来者前来采购<br>　　九月是<a href=\"http://baike.baidu.com/link?url=Z_TI8o1R5VYPBBRDNmPrMR8ywnat9Lde1B47vL7gAg02HGIT6kOihOjwoXDp9yvZUcW1DivQKlBkB75f4pM8dGgI5QzYtetPVF-VOKhSds7\" target=\"_blank\" rel=\"external\">山桃笏</a>成熟的季节，我们小孩子三五成群也结伙摘山桃笏，山桃笏结在布满荆棘的山杏树上，尖锐的硬刺扎的你手破血流，戴上手套也挡不住扎且诸多不方面，只能小心谨慎的摘，时间长了竟然也不怕疼了，速度也明显快了。成熟的山桃笏外层厚厚的绿皮也张开了嘴，有的坠落在树下躺在那里，似乎就等我们前来捡拾。从这个山头翻越到那个山头，再从那个山头攀越到更高的山头，我们的身心都被那些枝繁叶茂的山笏树吸引，总认为最高处的树一定是果实压弯腰，哪知越是高处的大树果实越少，有时费尽九牛二虎之力爬到最高处，却并无多少收获，常常被困在陡峭绝壁上找不到下山的路急的像热锅蚂蚁团团转，饶了许多弯子才找到下山路。\n　　</p>\n<h1 id=\"衰落\"><a href=\"#衰落\" class=\"headerlink\" title=\"衰落\"></a>衰落</h1><p><img src=\"http://ockhcbepk.bkt.clouddn.com/2016-08-30%20000130.jpg?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"衰落\"></p>\n<p>2008年的那个夏天，最疼爱我的姥姥在我长大的地方去世了。<br>同年中考，我考上了宁夏银川一中，带着一个沉重背包和满腔的悲伤，坐上了离开汝箕沟的巴士。<br>那时，我还不知道，这一走，就真的走了，而且是……<br>永远……</p>\n<p>2011年的那个夏天，高考。<br>在银川，我考上了大学。<br>同年，父亲去世。<br>带着一箱沉重的行李和满腔的悲伤，我坐上了离开宁夏的火车。<br>那时的我还不知道，这一走，就真的，走了。</p>\n<p>2013年夏，挖掘机和装载机压过人行道，穿过菜市场，开进了汝箕沟的居住区。<br>巨大的铁壁敲碎了曾经姥姥每周都擦的窗户，捣烂了父亲曾引以为豪自建房。<br>从此，童年的汝箕沟变成了梦中的汝箕沟。</p>\n<p>现在的我和我的生活，<br>多了一层雾霾，少了一片星空。<br>多了一份成熟，少了几分天真。<br>多了几个朋友，少了几个亲人。<br>多了一点繁华，少了一个家乡……</p>\n<p>这就是我的家乡，和一些你不知道的山里的故事。</p>\n<p>PS: 以上部分内容非作者本人原创</p>\n"},{"title":"最好的我们","url":"http://www.leonma.cn/2016/08/29/最好的我们/","content":"<p><img src=\"http://ockhcbepk.bkt.clouddn.com/bestUs.jpg?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"最好的我们\"></p>\n<blockquote>\n<p>那时的你是最好的你，现在的我是最好的我。最好的我们之间隔了整整一个青春。</p>\n</blockquote>\n<p>首先来说说这整部剧，从刚开始莫名其妙的欢喜冤家，到剧情慢慢舒展后耿耿余淮的甜蜜，振华三姐妹的感情，到最后耿耿余淮树下的重逢。我想每一个追剧的人都被这些可爱的演员感动着，被一次次的带回自己的中学时代，想起曾经陪伴在身边的那些人。</p>\n<p>小说是写的很好很戳心，可是电视剧不可能百分百还原小说。太多过于外露的情感，太多被删掉的打动我们的剧情，太多被增加的莫名的冲突，也让我边看边吐槽。</p>\n<p>可是，吹毛求疵的去执着于那些不完美，而忽略了那些美好，又有什么意思呢？</p>\n<p>至少它给了我们生动又真实的耿耿余淮简单贝塔徐延亮张平，我们可以从屏幕上看到他们的笑与泪，感受他们的离别与重逢，就好像看到了自己。</p>\n<p>那是最好的他们，也是最好的我们。</p>\n<p>关于耿耿星河和耿耿余淮。</p>\n<p>我其实很不理解那些因为支持耿耿余淮而讽刺支持耿耿星河的人的，你们还是太年轻，真的不要这样了。有些书粉说受不了一堆人刷路星河多么好的，虽然我是耿耿余淮党还是看着好难受。（虽然我觉得我这么说肯定又会被喷了可是我就这么耿直…）一千个读者有一千个哈姆雷特。谢谢路星河一直陪在耿耿身边呀。</p>\n<p>有人说现实里应该会选择像路星河这样的人吧，一心一意的对你好。</p>\n<p>可是耿耿就是耿耿，那么倔的耿耿，她说“说到底我也不明白，为什么有些人可以在适合结婚的年龄以结婚为目的去和陌生人同床共枕，陌生人的气息倾覆过来的时候，不会恶心吗？不会怕吗？不会觉得不甘心吗？或许有一天我也会妥协，也会放弃这些矫情的心思。可我并不盼望那一天的到来。”所以，就是这样不肯妥协的耿耿，才傻傻的等一个可能再也不会出现的余淮。也只有这样不肯放弃的耿耿，才能等到余淮。</p>\n<p>说什么十年的陪伴比不上一句我来晚了，可是你们知道吗，余淮对于耿耿的意义，是多少个路星河都不能比的。就像耿耿对于路星河一样。</p>\n<p>所以从一定程度上说，她不答应路星河的一次次求婚，也是对路星河好。不是两情相悦，一方还心有所属，在一起又有什么意义呢？只是耿耿不应该给路星河希望，傻子都看的出来接受戒指是为了气余淮，编剧这样改显得耿耿太婊了。可我欣赏路星河的一点就是他知道 我是爱你的，你是自由的。不妨换一个角度想，路星河这个角色的出现，是为了我们思考，我们该如何做选择。路星河对耿耿的坚持，耿耿对余淮的坚持，这种不知道有没有意义的坚持是否应该继续下去。只是耿耿太幸运等到了余淮，路星河没有。</p>\n<p>画面最后定格在了耿耿余淮在树前相视而笑。余淮剃了胡子，换了衣服，就重新开始吧。年少时倾心爱过的人，最后一定会在一起。兜兜转转，又回到了开始的地方，把那些没说完的话说完。故事就到这吧。没有柴米油盐，只有甜蜜的回忆。</p>\n<p>耿耿余淮才是圆满。</p>\n<p>谢谢耿耿余淮圆了我们一个梦。</p>\n<p>再见啦，最好的耿耿余淮，最好的我们。</p>\n<p>——————————————————</p>\n<p>我觉得吧，看情怀得看书，看脸就看网剧呗。</p>\n<p>分享一个超级苏超级甜的耿耿余淮版《晴天》。</p>\n<p><a href=\"//link.zhihu.com/?target=http%3A//www.bilibili.com/mobile/video/av4448831.html\">www.bilibili.com</a></p>\n<p><a href=\"//link.zhihu.com/?target=http%3A//m.miaopai.com/show/channel/u2tUYOHap-URIBHtd2UIeg__\">m.miaopai.com</a></p>\n<p>这个比较清楚但是画面不够甜~</p>\n<p>——————————————————</p>\n<p>看到好多熊孩子吐槽路星河甚至弃剧了的。没必要那么极端啦，其实我觉得这个角色并没有那么讨人厌。</p>\n<p>路星河挺早熟的，他脑子里有些不属于高中生的想法，更真实更实在，虽然可能不都正确。他不想被所谓的学校所谓的成绩束缚，他想好好实现画画的梦想。然而他没办法反抗专制的爸爸，所以只能用不听课逃学这种幼稚的举动来表达他的不满。他勇敢执着，敢作敢当不别扭。路星河，是一小部分人的缩影放大啊。影视剧的夸张，只是为了戏剧冲突需要。</p>\n<p>耿耿这个傻姑娘一直都是把路星河当朋友看的啊，和对余淮是完全不同的情感。因为和路星河在一起的时候她会觉得自己没有被振华这个大包袱捆绑，可以很轻松的说自己不喜欢上学不喜欢没完没了的作业，可以暂时的逃离现实世界。路星河代表的是她内心里反抗野性的一面。所以有路星河这个朋友让她觉得很放松。所以当她知道路星河对她的感情后她会像小女生那样逃避路星河。</p>\n<p>也许你们是觉得改动太大以至于都不像耿耿余淮的故事了，而且恶俗的三角恋没有了原著那种单纯的情感。耿耿不再是那个对着余淮星星眼的说“我只崇拜你的”小姑娘了；余淮也不再是那个没发育全的傻大个了。可是姑娘们啊，现实可能会比这更狗血啊。</p>\n<p>也许我没有遇到过余淮那样会发光的同桌，我周围也没出现过那么叛逆桀骜不驯的路星河。我们大多数人的生活都是按部就班的学习，高考上大学。可是呀，你敢说你没有过路星河那样的想法只是不敢承认？路星河展现的是另一种生活态度，是平凡如我们内心不安分的小野兽。</p>\n<p>即使余淮这么多年在我心里一直是男神的存在，我依然痛快的接受路星河这个男二的存在，因为我知道，从过去到现在，我的心里一直都有一个“路星河”的存在。<br><img src=\"https://pic4.zhimg.com/65f89d73547f1ba6c85c102942d09967_b.jpg\" alt=\"\"><br><img src=\"https://pic3.zhimg.com/88875eba465874a4fdd31bb684b4c03e_b.jpg\" alt=\"\"><br>——————————-—————超多图预警<br>24集<br>3个月了，终于等到了完结的这一天。有人说每看完一部喜欢的剧都有一种失恋了的感觉。<br>真的真的很难过。<br>从医院重逢开始。<br><img src=\"https://pic1.zhimg.com/5d0fa43f420fd65fb1981e2241ae77f8_b.jpg\" alt=\"\"><br>想起拜伦的那句诗：</p>\n<blockquote>\n<p>“若我再次遇到你， 事隔经年， 我将如何与你招呼。 以沉默， 以眼泪。”</p>\n</blockquote>\n<p>我曾想象过很多次与你重逢的场景，摔一巴掌告别青春或是若无其事就是最大的报复。然而这次遇见却那么猝不及防。<br>我甚至不敢回头看。不是怕看见你，而是怕看见你没在看我。<br>刘昊然这里真的把那种沧桑和疲倦演绎的超级贴切。不再是那个骄傲又傲娇的大男孩，而是一个胡渣都来不及剃的中年男人。<br>（嗯原著其实不是这样的，耿耿觉得时光放过了他却没有放过自己，所以才觉得他还是继续做着他的天之骄子。可是看到这一幕的余淮还是好心疼）<br><img src=\"https://pic1.zhimg.com/d4c3104c50ea47f03ca36bb7ab4137a4_b.jpg\" alt=\"\"><br><img src=\"https://pic4.zhimg.com/1ec883b9ef8c2046876c05447abec8f3_b.jpg\" alt=\"\"><br><img src=\"https://pic3.zhimg.com/91d5d94209f476ebeb220055eaa22fa6_b.jpg\" alt=\"\"></p>\n<p>万众期待的强吻剧情啊啊啊！！耿耿粗暴而青涩的强吻拍的很好，但是我觉得后来她问余淮那几句话说的有点像念台词。再次表白刘昊然文身只是为了给自己带来好运气那段话，凌厉的眼神真是演技爆表！！<br>明明就是情绪崩盘，却告诉自己不能给耿耿任何期望。所以故作潇洒的转身离去。<br>我们以前就没可能，以后更没可能。</p>\n<p>网剧因为集数限制删改了很多。很仓促。<br>余淮太颓了。可他明明是在一次次打击后仍然努力将生活拨回正轨的小爷。</p>\n<p>终于懂得你汹涌情绪背后的无奈，终于懂得你早已不再是那个天之骄子，终于懂得你背后的千山万水。<br>想起曾经那个在红榜面前一脸不忿的你，想起那个说成王败寇的你，想起那个说小爷我可是很厉害的你要继续崇拜我的你。<br>这样的反差，更让我心疼。<br>我抱怨你这么多年都没来找过我，纠结你没和我说完的话。却没能在你需要我的时候陪着你。<br>因为懂得你，所以才格外心疼。<br>我犹犹豫豫，不知道怎么面对你。直到洛枳告诉我，总有一些坚持，能从冰封的土地里，开出十万朵盛放的蔷薇。直到我明白，爱情的意义，就是两个人一起，扭转命运的手腕。<br>不管有多苦，别怕，有我陪着你呢。以前你喜欢那么平凡的一个我，现在轮到我了。<br>我终于等到了你。<br>谁说结果不重要。</p>\n<p><img src=\"https://pic1.zhimg.com/720c20f29fc7e3d38e58992025f6f1e8_b.jpg\" alt=\"\"></p>\n<p>23集<br>这集来到了2015年，这么多年，你还是忘不了他。<br>路星河向耿耿求了第56次婚。其实我很羡慕耿耿身边一直有这么好一个路星河陪着她，两个人你熟悉我，我也了解你。也感动于路星河的执著，虽然是个万年备胎的角色。</p>\n<p><img src=\"https://pic2.zhimg.com/5545d61a60e8decd0e80689e98df93f1_b.jpg\" alt=\"\"></p>\n<p>他知道耿耿心里一直有余淮，这么多年还是忘不了他。余淮留给耿耿的数独解出来了，于是他陪着她打听余淮的下落，陪她去找余淮。他说或许你找到他了，就想通了。<br>可是耿耿心里还是绕不开余淮。<br>在医院里看到耿耿因为重新得到了余淮的消息，他躲到了墙背后没有过去打扰就离开了。他是真的明白余淮在耿耿心中的位置。只是仍然不想放弃。<br>舍不得放弃。<br>迟迟钟鼓初长夜，耿耿星河欲曙天。星河灿烂依旧，只是耿耿的太阳又重新升起了。</p>\n<p>22集</p>\n<p>我本来是不接受周末和简单在一起的。后来看到了简单扮演者的微博，简单这样单纯的女孩子，真的值得被爱吧。</p>\n<blockquote>\n<p>之前为了简单的结局厚颜缠着编剧和导演讨论了好多次，我个人开始是不倾向简单周末在一起的，我站在女生的角度试图证明简单的爱不太容易转移，但是最后，我被编剧说服了。<br>简单这样的姑娘要的不多而且善良，她值得被爱值得被温暖被关怀，我也很希望她会遇见一个人像她爱韩叙那样爱她，她的付出虽然在一个人身上没有回报，但我们都希望命运会还给她。<br>这个姑娘太好了，我自己也不忍心看她被辜负，让她在情伤的阴影里自我挣扎或强颜欢笑都确实太残忍。<br>简单不仅仅是简单，她还比我想象的更坚强更勇敢，她最让我感动和佩服的是，无论经历过什么她都愿意始终相信爱，愿意再敞开心扉去接纳和付出，不是顾影自怜不是自我封闭，擦掉眼泪继续奔跑，那个选择才是最有力量的。<br>成长过程中我们已经被动的改变了太多，但我们最不应该改掉的，是因外界对我们造成伤害而改掉的那个内心里最初最真的自己。<br>她眼里的周末可能就是那时候的自己，我不确定她肯不肯定那是爱，也许是因她不忍心伤害不忍心拒绝并且容易被打动，也许是因为她想给自己一个走出来的机会，也许是她看到一个比自己更适合的人站在他旁边再也找不回自己的位置，也许是付出多年终于体会到了被守护的感觉，也许是她以为她对他的情谊再也开不出花来。<br>她知道爱情有时候像一场赌局，我也信，愿意为爱全情付出的人一定会赢一次的。<br>尽管我也不忍大家期待已久的#简单韩叙# 就这样散场，但最后#简单周末# 仔细想想也很合乎情理逻辑。<br>其实客观的角度来说，简单确实误会了韩叙，可能在一起除了喜欢之外真的需要一点点机缘巧合，她不知道韩叙为她哭对她说对不起，不知道有一天会等到他送的牛奶和面包，如果知道结局会不一样吧，可是生活也是这样充满遗憾和阴差阳错。但愿你们大家和爱人之间没有误会，祝你们“得到的都是最好的”。<br>以前我们以为爱上一个人就是一辈子，后来我们发现不是每对有情人都能终成眷属，也不是所有恋爱都能地老天荒，无论是青春年少时还是长大成人后，我们都要学着面对突如其来的告别，可每次还是会难舍难分也可能心痛万分，既然和过去告别无法学会平静，那哭过之后，希望我们内心都仍有力量去选择爱，仍保留着最大的善意去相信美好。</p>\n</blockquote>\n<p>来自@陈梦希Nikki</p>\n<p>21集</p>\n<p><img src=\"https://pic3.zhimg.com/0e01bca252223a313a6e07af342640fe_b.jpg\" alt=\"\"><br>这就是所谓的我喜欢你我不告诉你但是我周围的人都知道。。。他俩打电话这一段还有大晚上躲在被子里打电话的时候真是甜到炸裂。<br>可是我还是想吐槽这集看的我挺尴尬的，因为我觉得小爷不是一个沉浸在你侬我侬里而扰乱心智的人。我理解编剧想表现他遵守和耿耿每天通电话的承诺，理解想表现他俩的感情，可是我真的觉得有一点过。好像他竞赛没考好就是因为耿耿一样。他一直是一个明白自己要什么，明白自己的路不能有一点偏差的人，所以他才没有和耿耿表白，而不是像这样被儿女情长所困。</p>\n<p>20集</p>\n<p><img src=\"https://pic1.zhimg.com/4f16de1ebf5b3c4c8222f303f6356130_b.jpg\" alt=\"\"></p>\n<p>作者：doldrums<br>链接：<a href=\"https://www.zhihu.com/question/40536672/answer/90306127\" target=\"_blank\" rel=\"external\">https://www.zhihu.com/question/40536672/answer/90306127</a><br>来源：知乎<br>著作权归作者所有，转载请联系作者获得授权。</p>\n<p>喂喂喂110这里有人虐狗！！小小年纪搂搂抱抱卿卿我我成何体统！！<br>但是为什么这狗粮我吃的心甘情愿 (⁎⁍̴̛ᴗ⁍̴̛⁎)<br>耿耿睡觉的时候余淮一直在偷看她，边看边笑，耿耿醒来又装正经。这一幕真的好真实啊！谁没有悄悄偷看过喜欢的人又害怕他发现？<br>也许对余淮来说，单是「你是我很重要的事儿」这一句，就很了不得了吧。比起路星河「我喜欢你我中意你」直白的告白，这种欲说还休含糊其辞的语句，更能体现少男少女之间朦胧的情愫。余淮身上背负的压力太多，自身的性格也决定了他不会有大胆而锐利告白，所以他只可能小心翼翼的用自己的方式对耿耿好。<br>我想这么多人喜欢余淮，正是因为他是一个立体的不是完美无缺的形象，他有缺点有顾虑。一方面温暖着耿耿，一方面又别扭的不肯直说。就好像戏外无数个你和我。<br>我觉得这部剧里演技最浮夸的就是韩叙了，之前一脸冷漠还可以解释为面瘫性格使然，然而哭戏都让我分分钟想快进啊。。。<br>关于简单和韩叙。<br>耿耿说简单没有错，韩叙可以不喜欢她可是不能不在乎。可是余淮说简单一开始就错了。我一直认为，爱应该是建立在双方平等的基础上的。简单一直期盼等待的，不就是有一天韩叙能接受她吗？<br>所以你看，耿耿是多么幸运。她说那我呢，余淮说你不一样。没说完的是你有我呢，你才不是一厢情愿。<br>我喜欢你的时候你也正好喜欢着我，多么美好。<br>下周真正的虐就快要来了，好心疼小爷 ╥﹏╥<br>最后，张平你跟沈老师走了你家张峰怎么办！</p>\n<p>19集</p>\n<p><img src=\"https://pic1.zhimg.com/21dcd27f54c68ef6d3aa3aa9b19b53d4_b.jpg\" alt=\"\"><br>徐延亮，他终于说出口了呀。<br>“你要在北京等我，等我以后去了北京，就能每天都看到你了。”<br>贝塔说的没错，她走了以后徐延亮得疯。那个知道贝塔霸道蛮横背后的善良的胖子，那个任由贝塔拳打脚踢的胖子，那个知道贝塔喜欢什么的胖子，终于勇敢了一次。<br>大概真的有很多话，只有在告别时才能说出口吧。<br>没说出口的，就什么也不算了。<br>我突然很相信，得了相思病的徐延亮，会因为贝塔对他说的最后一句“我不喜欢胖子”而减肥。<br><img src=\"https://pic2.zhimg.com/9cae6fa2a329abf629e13f8ae4c1873d_b.png\" alt=\"\"></p>\n<p>耿耿说，既然要离别，那为什么还要相遇呢？<br>我想到了那句话“分离就是轻微的死亡，道别等于死去一点点”。<br>可能直到离别的时刻，我们才懂相遇的意义吧。</p>\n<p>小爷高三居然烫了头发！高三不该好好学习吗！凸什么造型！烫什么卷毛！<br>虽然我觉得有点显老，但是小爷怎么样都帅！欧耶！<br>颜即是正义！</p>\n<p><img src=\"https://pic4.zhimg.com/9deb18a055d4fd6e38e48f1c17bfebe7_b.jpg\" alt=\"\"></p>\n<p>至于简单和韩叙的故事，我们等下集吧~<br>我和我舍友赌简单会不会和周末在一起，她赌会我赌不会。赌注是我输了就去加一直不敢加的男神的微信。<br>虽然剧里很明显的暗示了周末喜欢简单，简单伤心难过的时候最关心的人是他，可是我还是相信不会的。因为喜欢韩叙，对韩叙好已经是简单生活中的一部分。<br>她说一厢情愿就得愿赌服输，她说韩叙不是不喜欢说话只是不喜欢和我说话，所以即使单纯简单如她又怎么会不懂韩叙，只是不愿意放弃而已。所以即使周末可以填补她的空白，她也不会和周末在一起的。<br>我这么没理由的相信简单，相信年少的时候纯真的感情。</p>\n<blockquote>\n<p>作者：doldrums<br>链接：<a href=\"https://www.zhihu.com/question/40536672/answer/90306127\" target=\"_blank\" rel=\"external\">https://www.zhihu.com/question/40536672/answer/90306127</a><br>来源：知乎<br>著作权归作者所有，转载请联系作者获得授权。</p>\n</blockquote>\n"},{"title":"零壹随感","url":"http://www.leonma.cn/2016/08/28/零壹随感/","content":"<p><img src=\"http://ockhcbepk.bkt.clouddn.com/binary01.jpg?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"0和1的世界\"></p>\n<blockquote>\n<p>0和1，简单和谐，却能代表一切。</p>\n</blockquote>\n<h1 id=\"0和1的世界\"><a href=\"#0和1的世界\" class=\"headerlink\" title=\"0和1的世界\"></a>0和1的世界</h1><p>我们所生活的这个世界，一人一虫，一草一木，均由万千物质所构成，而物质则是由人类知识范围内所认知的虽小的组成单位——原子而组成。虽然万千物质形态各异，性质更加不同，但组成物质的原子却有着相同的结构。密度惊人的原子核聚集在中心，数量不一的点子像行星围绕着恒心一般在原子核周围有序而往复运动着…… 原子之间通过特殊的作用力使得他们组合成不同的形态构成分子，而分子又相互组合构成了我们所看见的人、虫、草、木时间万物。</p>\n<p>对世间万物的思考把同样的思考带到计算机的世界中，现实生活是这样的，计算机的世界又何尝不是这样？</p>\n<p>我们现在的生活，计算机和网络成了我们日常生活不可或缺的部分。我始终难以想象，像我这种依靠计算机和网络来谋生的人，如果离开了他们，我的生活会是什么样子？也许会穷困潦倒，也或许会比现在生活的更幸福……这是一个我自己也没办法回答的问题。抛开这个问题，计算机和网络，可以说给我们重新定义了一个虚拟的世界，这个世界中的万物均是由0和1的不同组合而构成的。</p>\n<p>拿游戏为例，想象一下，我们在游戏一个角色，其实是计算机程序定义的一个对象，这个对象用面向对象的语言定义出它的属性特征和行为。这就像是不同的分子构成了人的五官和器官。而定义这些对象的语言又会被计算机解析为CPU能够读懂的0和1的二进制组合。就好像组成身体五官和器官的分子是由原子构成的一样。0和1就这样跑在CPU的运算器和解析器中，我们下达的每一个指令，都将被解析成一串串0和1的代码来控制游戏角色进行移动和攻击。而结果又将以高电平输出到我们的显示器上，看到绚丽多彩的画面。</p>\n<p>造物主用分子和原子定义了世界，而人类发现了这个规律，用二进制的0和1定义了一个只有人类才能懂的虚拟世界。</p>\n<h1 id=\"零壹博客\"><a href=\"#零壹博客\" class=\"headerlink\" title=\"零壹博客\"></a>零壹博客</h1><p>我从小就有一种顽疾，叫做“起名困难症”，最害怕遇到的就是给某个东西起名字。但是作为一名码农，起名字是一个关系自己饭碗的事情，我们每天都在起名字。给一个变量起名字，给你个类起名字、给文件起名字、给项目起名字等等……<br>直到有一天，我需要给我的博客起一个名字。那时我纠结了很久，很久，想了些让自己一点也不满意的名字，最终还是放弃了博客的念头。不经意，我看到一篇有关二进制之美的文章，让我不由得联想到二进制的世界和现实世界很像，脑洞大开，决定就用“零壹”来命名我的博客。看似简单，0和1，却是一切的根源。想要看清本质，就需要抓住根源。随即，0的英文ZERO和1的英文ONE首位都有一个”O”，所有可以连写成ZERONE，听起来也很酷。这就是我博客名称的来源，也是自认为起名字最成功的一次。</p>\n"},{"title":"使用Hexo来写作","url":"http://www.leonma.cn/2016/08/27/使用Hexo来写作/","content":"<p><img src=\"http://ockhcbepk.bkt.clouddn.com/hexo_pic.png?watermark/2/text/QOmbtuWjueWNmuWuog==/font/5a6L5L2T/fontsize/700/fill/I0VGRUZFRg==/dissolve/100/gravity/SouthEast/dx/20/dy/20\" alt=\"\"></p>\n<blockquote>\n<p>如果一件事成为一种生活的惯性，那是非常可怕的。就像当你徜徉在Windows的各种炫酷的可视化界面中时，你却失去了类似于Linux命令那样的自由。</p>\n</blockquote>\n<h1 id=\"从Wordpress到Hexo\"><a href=\"#从Wordpress到Hexo\" class=\"headerlink\" title=\"从Wordpress到Hexo\"></a>从Wordpress到Hexo</h1><hr>\n<p>这是我的博客建立起来之后自己动手写的第一篇博客，也是第一次使用Markdown语法进行写作，所以仅以此篇博客开启我的Hexo博客之路（不归之路）。</p>\n<p>其实在这个博客是我的博客的2.0版本。和很多人预料的一样，1.0版本是用Wordpress做的，原因很简单，因为那时候刚刚学会PHP，还不会Node.js。真正接触Node.js正是通过Hexo，所以从某种意义上，Hexo也可以算是启蒙老师。</p>\n<p>真正进入到Hexo中才发现，原来写博客可以做到这么完美。当然，这么说也并不代表我在说Wordpress的坏话，而是我觉得Hexo更适合我的口味，所以也没有再犹豫什么。</p>\n<h1 id=\"Markdown写作体验\"><a href=\"#Markdown写作体验\" class=\"headerlink\" title=\"Markdown写作体验\"></a>Markdown写作体验</h1><hr>\n<p>初次尝试使用Markdown写作，体验还是很不错的。我认为这也是作为一名程序员，应该是用的方式。<br>具体体现在：</p>\n<ul>\n<li>使用简单的代码指令来控制文本输出格式</li>\n<li>自由的形式</li>\n<li>统一的文本格式特别适合博客写作</li>\n</ul>\n<h1 id=\"写作\"><a href=\"#写作\" class=\"headerlink\" title=\"写作\"></a>写作</h1><hr>\n<p>以下内容非本人原创，均摘自<a href=\"https://hexo.io/zh-cn/docs/writing.html\" target=\"_blank\" rel=\"external\">官网文档</a>，特此声明。<br>你可以执行下列命令来创建一篇新文章。<br><code>$ hexo new [layout] &lt;title&gt;</code></p>\n<p>您可以在命令中指定文章的布局（layout），默认为 <strong>post</strong>，可以通过修改 <strong>_config.yml</strong> 中的 <strong>default_layout</strong> 参数来指定默认布局。</p>\n<h2 id=\"布局（Layout）\"><a href=\"#布局（Layout）\" class=\"headerlink\" title=\"布局（Layout）\"></a>布局（Layout）</h2><p>Hexo 有三种默认布局：<strong>post</strong>、<strong>page</strong> 和 <strong>draft</strong>，它们分别对应不同的路径，而您自定义的其他布局和 <strong>post</strong> 相同，都将储存到 <strong>source/_posts</strong> 文件夹。</p>\n<table>\n<thead>\n<tr>\n<th>布局</th>\n<th style=\"text-align:center\">路径</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>post</td>\n<td style=\"text-align:center\">source/_posts</td>\n</tr>\n<tr>\n<td>page</td>\n<td style=\"text-align:center\">source</td>\n</tr>\n<tr>\n<td>draft</td>\n<td style=\"text-align:center\">source/_drafts</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"文件名称\"><a href=\"#文件名称\" class=\"headerlink\" title=\"文件名称\"></a>文件名称</h2><p>Hexo 默认以标题做为文件名称，但您可编辑 new_post_name 参数来改变默认的文件名称，举例来说，设为 :year-:month-:day-:title.md 可让您更方便的通过日期来管理文章。</p>\n<table>\n<thead>\n<tr>\n<th>变量</th>\n<th style=\"text-align:center\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>:title</td>\n<td style=\"text-align:center\">标题（小写，空格将会被替换为短杠）</td>\n</tr>\n<tr>\n<td>:year</td>\n<td style=\"text-align:center\">建立的年份，比如， 2015</td>\n</tr>\n<tr>\n<td>:month</td>\n<td style=\"text-align:center\">建立的月份（有前导零），比如， 04</td>\n</tr>\n<tr>\n<td>:i_month</td>\n<td style=\"text-align:center\">建立的月份（无前导零），比如， 4</td>\n</tr>\n<tr>\n<td>:day</td>\n<td style=\"text-align:center\">建立的日期（有前导零），比如， 07</td>\n</tr>\n<tr>\n<td>:i_day</td>\n<td style=\"text-align:center\">建立的日期（无前导零），比如， 7</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"草稿\"><a href=\"#草稿\" class=\"headerlink\" title=\"草稿\"></a>草稿</h2><p>刚刚提到了 <strong>Hexo</strong> 的一种特殊布局：<strong>draft</strong>，这种布局在建立时会被保存到 <strong>source/_drafts</strong> 文件夹，您可通过 <strong>publish</strong> 命令将草稿移动到 <strong>source/_posts</strong> 文件夹，该命令的使用方式与 <strong>new</strong> 十分类似，您也可在命令中指定 <strong>layout</strong> 来指定布局。<br><code>$ hexo publish [layout] &lt;title&gt;</code></p>\n<p>草稿默认不会显示在页面中，您可在执行时加上 <strong>–draft</strong> 参数，或是把 <strong>render_drafts</strong> 参数设为 true 来预览草稿。</p>\n<h2 id=\"模版（Scaffold）\"><a href=\"#模版（Scaffold）\" class=\"headerlink\" title=\"模版（Scaffold）\"></a>模版（Scaffold）</h2><p>在新建文章时，<strong>Hexo</strong> 会根据 <strong>scaffolds</strong> 文件夹内相对应的文件来建立文件，例如：<br><code>$ hexo new photo &quot;My Gallery&quot;</code></p>\n<p>在执行这行指令时，<strong>Hexo</strong> 会尝试在 <strong>scaffolds</strong> 文件夹中寻找 <strong>photo.md</strong>，并根据其内容建立文章，以下是您可以在模版中使用的变量：</p>\n<table>\n<thead>\n<tr>\n<th>变量</th>\n<th style=\"text-align:center\">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>layout</td>\n<td style=\"text-align:center\">布局</td>\n</tr>\n<tr>\n<td>title</td>\n<td style=\"text-align:center\">标题</td>\n</tr>\n<tr>\n<td>date</td>\n<td style=\"text-align:center\">文件创建日期</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"写在最后\"><a href=\"#写在最后\" class=\"headerlink\" title=\"写在最后\"></a>写在最后</h1><p>以上内容仅供参考。</p>\n"},{"title":"about","url":"http://www.leonma.cn/about/index.html","content":""},{"title":"","url":"http://www.leonma.cn/css/personal-style.css","content":"@font-face {\n  font-family: \"Meiryo\";\n  src: url(\"/fonts/Meiryo.eot\");\n  /* IE9 */\n  src: url(\"/fonts/Meiryo.eot?#iefix\") format(\"embedded-opentype\"), /* IE6-IE8 */\n  url(\"/fonts/Meiryo.woff\") format(\"woff\"), /* chrome, firefox */\n  url(\"/fonts/Meiryo.ttf\") format(\"truetype\"), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */\n  url(\"/fonts/Meiryo.svg#Meiryo\") format(\"svg\");\n  /* iOS 4.1- */\n  font-style: normal;\n  font-weight: normal;\n}\nhtml.page-home {\n//  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-image: url('http://ockhcbepk.bkt.clouddn.com/bp_ios7.jpg');\n  background-color: transparent;\n  background-size: cover;\n  background-position: center center;\n  background-repeat: no-repeat;\n\n  /*background: linear-gradient( #1abc9c, transparent), linear-gradient( 90deg, skyblue, transparent), linear-gradient( -90deg, coral, transparent);*/\n  /*background-blend-mode: screen;*/\n\n  /*background: linear-gradient(to left, #5f2c82, #49a09d);*/\n}\n"},{"title":"project","url":"http://www.leonma.cn/project/index.html","content":""},{"title":"search","url":"http://www.leonma.cn/search/index.html","content":""},{"title":"tag","url":"http://www.leonma.cn/tag/index.html","content":""},{"title":"link","url":"http://www.leonma.cn/link/index.html","content":""},{"title":"category","url":"http://www.leonma.cn/category/index.html","content":""}]